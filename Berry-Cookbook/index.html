<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/Berry-Cookbook/ rel=canonical><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.12"><title>Berry Cookbook - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8J08F8X90S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#berry-cookbook class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Berry Cookbook </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> Firmware Builds </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog Pin </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> ArtNet DMX </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> IPv6 </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting Language </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_18> <label class=md-nav__link for=__nav_2_18 id=__nav_2_18_label tabindex=0> Protocol Bridging <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_18_label aria-expanded=false> <label class=md-nav__title for=__nav_2_18> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> Arduino MCU </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> BLE Gateway </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> LCD/DLP Projector Control </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> Modbus Bridge </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> Thermostat </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> Universal File System </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> Wi-Fi Range Extender </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> ESP32 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> Tasmota32 Features </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> Berry </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> Bluetooth Low Energy </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> I2S Audio </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> LVGL </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> HASPmota </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> Tasmota Application Files </a> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> Touch GPIOs </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> Safeboot Partition Layout </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> Supported Devices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> Tasmohab </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> Web Installer </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#adding-commands-to-tasmota class=md-nav__link> Adding commands to Tasmota </a> <nav class=md-nav aria-label="Adding commands to Tasmota"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#trivial-example class=md-nav__link> Trivial example </a> </li> <li class=md-nav__item> <a href=#general-form-of-the-custom-command-function class=md-nav__link> General form of the custom command function </a> </li> <li class=md-nav__item> <a href=#more-complete-example class=md-nav__link> More complete example </a> </li> <li class=md-nav__item> <a href=#responding-to-commands class=md-nav__link> Responding to commands </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#adding-a-button-to-the-main-menu class=md-nav__link> Adding a button to the Main menu </a> </li> <li class=md-nav__item> <a href=#creating-an-i2c-driver class=md-nav__link> Creating an I2C driver </a> <nav class=md-nav aria-label="Creating an I2C driver"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-by-step-approach class=md-nav__link> Step by step approach </a> </li> <li class=md-nav__item> <a href=#full-example class=md-nav__link> Full example </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lvgl-touchscreen-with-3-relays class=md-nav__link> LVGL Touchscreen with 3 Relays </a> </li> <li class=md-nav__item> <a href=#multi-zone-heating-controller class=md-nav__link> Multi-Zone Heating Controller </a> </li> <li class=md-nav__item> <a href=#ethernet-network-flipper class=md-nav__link> Ethernet Network Flipper </a> </li> <li class=md-nav__item> <a href=#tmp117-driver class=md-nav__link> TMP117 Driver </a> </li> <li class=md-nav__item> <a href=#call-function-at-intervals class=md-nav__link> Call function at intervals </a> </li> <li class=md-nav__item> <a href=#h-bridge-control class=md-nav__link> H-bridge control </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Berry-Cookbook.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1 id=berry-cookbook>Berry Cookbook<a class=headerlink href=#berry-cookbook title="Permanent link">~</a></h1> <h2 id=adding-commands-to-tasmota>Adding commands to Tasmota<a class=headerlink href=#adding-commands-to-tasmota title="Permanent link">~</a></h2> <p>It is very easy to dynamically add a command to Tasmota with Berry.</p> <h3 id=trivial-example>Trivial example<a class=headerlink href=#trivial-example title="Permanent link">~</a></h3> <p>Let's start with the most simple command.</p> <p>Let's define a command <code>BrGC</code> that triggers a garbage collection and returns the memory allocated by Berry. We first define the function:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>br_gc</span><span class=p>()</span>
  <span class=n>var</span> <span class=n>allocated</span> <span class=o>=</span> <span class=n>tasmota</span><span class=o>.</span><span class=n>gc</span><span class=p>()</span>    <span class=c1>#- trigger gc and return allocated memory -#</span>
  <span class=kn>import</span> <span class=nn>string</span>
  <span class=n>tasmota</span><span class=o>.</span><span class=n>resp_cmnd</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s1>&#39;{&quot;BrGc&quot;:</span><span class=si>%i</span><span class=s1>}&#39;</span><span class=p>,</span> <span class=n>allocated</span><span class=p>))</span>
<span class=n>end</span>
</code></pre></div> <p>And register the function:</p> <div class=highlight><pre><span></span><code><span class=n>tasmota</span><span class=o>.</span><span class=n>add_cmd</span><span class=p>(</span><span class=s1>&#39;BrGc&#39;</span><span class=p>,</span> <span class=n>br_gc</span><span class=p>)</span>
</code></pre></div> <p>Then in Tasmota Console:</p> <div class=highlight><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">brgc</span>

<span class="l l-Scalar l-Scalar-Plain">21:04:30.369 CMD</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">brgc</span>
<span class=nt>21:04:30.376 RSL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stat/tasmota_923B34/RESULT = {&quot;BrGc&quot;:5767}</span>
</code></pre></div> <h3 id=general-form-of-the-custom-command-function>General form of the custom command function<a class=headerlink href=#general-form-of-the-custom-command-function title="Permanent link">~</a></h3> <p>The custom command function have the general form below where parameters are optionals:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>function_name</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>idx</span><span class=p>,</span> <span class=n>payload</span><span class=p>,</span> <span class=n>payload_json</span><span class=p>)</span>
  <span class=o>...</span>
<span class=n>end</span>
</code></pre></div> <table> <thead> <tr> <th align=left>Parameter</th> <th align=left>Description</th> </tr> </thead> <tbody> <tr> <td align=left><code>cmd</code></td> <td align=left><code>string</code> name of the command in lower case. Can be used if same function is used for multiple similar commands for example.</td> </tr> <tr> <td align=left><code>idx</code></td> <td align=left>Command's index is the unsigned <code>integer</code> (optionally) added at the end of the command name before the parameters (like <code>Demo1</code>). Default to 1 if not specified.</td> </tr> <tr> <td align=left><code>payload</code></td> <td align=left><code>string</code> of the command line as without any parsing.</td> </tr> <tr> <td align=left><code>payload_json</code></td> <td align=left>if the payload is a valid JSON, it is converted into a Berry <code>map</code> object.</td> </tr> </tbody> </table> <h3 id=more-complete-example>More complete example<a class=headerlink href=#more-complete-example title="Permanent link">~</a></h3> <p>In this example, we will create a new command called <code>LightGold</code> that turns the light on and sets it to color gold #FFD700. This command accepts an optional JSON payload with the argument <code>Dimmer</code> ranging from 0..100.</p> <p>First we define a new Berry function with the logic. This function takes 4 arguments:</p> <ol> <li><code>cmd</code>: the command name (with same case as it was registered). This is useful if you want to share the same code in multiple commands. Here <code>cmd</code> is <code>LightGold</code></li> <li><code>idx</code>: the command index used, default to 1.</li> <li><code>payload</code>: the raw payload of the command as string</li> <li><code>payload_json</code>: the payload parsed as JSON, or <code>nil</code> if the payload is not JSON</li> </ol> <p>Example:</p> <ul> <li>command <code>lightgold</code>: <code>cmd</code>=<code>LightGold</code>, <code>idx</code>=1, <code>payload</code>=<code>""</code>, <code>payload_json</code>=<code>nil</code></li> <li>command <code>LIGHTGOLD2</code>: <code>cmd</code>=<code>LightGold</code>, <code>idx</code>=2, <code>payload</code>=<code>""</code>, <code>payload_json</code>=<code>nil</code></li> <li>command <code>lightgold not sure</code>: <code>cmd</code>=<code>LightGold</code>, <code>idx</code>=1, <code>payload</code>=<code>'not sure'</code>, <code>payload_json</code>=<code>nil</code></li> <li>command <code>lightgold {"value":"some"}</code>: <code>cmd</code>=<code>LightGold</code>, <code>idx</code>=1, <code>payload</code>=<code>'{"value":"some"}'</code>, <code>payload_json</code>=<code>{'value':'some'}</code></li> </ul> <p>In Berry, arguments are always optional, so you don't need to define them if you don't need them.</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>light_gold</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>idx</span><span class=p>,</span> <span class=n>payload</span><span class=p>,</span> <span class=n>payload_json</span><span class=p>)</span>
  <span class=n>var</span> <span class=n>dimmer</span> <span class=o>=</span> <span class=mi>50</span>      <span class=c1>#- default brightness to 50% -#</span>
  <span class=n>var</span> <span class=n>bri</span>

  <span class=c1># parse payload</span>
  <span class=k>if</span> <span class=n>payload_json</span> <span class=o>!=</span> <span class=n>nil</span> <span class=o>&amp;&amp;</span> <span class=n>payload_json</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;Dimmer&quot;</span><span class=p>)</span> <span class=o>!=</span> <span class=n>nil</span>    <span class=c1># does the payload contain a &#39;dimmer&#39; field</span>
    <span class=n>dimmer</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>payload_json</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;Dimmer&quot;</span><span class=p>))</span>
  <span class=n>end</span>

  <span class=c1># set_light expects a brightness in range 0..255</span>
  <span class=n>bri</span> <span class=o>=</span> <span class=n>tasmota</span><span class=o>.</span><span class=n>scale_uint</span><span class=p>(</span><span class=n>dimmer</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>

  <span class=c1># build the payload for set_light</span>
  <span class=n>var</span> <span class=n>light_payload</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;power&#39;</span><span class=p>:</span><span class=n>true</span><span class=p>,</span> <span class=s1>&#39;rgb&#39;</span><span class=p>:</span><span class=s1>&#39;FFD700&#39;</span><span class=p>,</span> <span class=s1>&#39;bri&#39;</span><span class=p>:</span><span class=n>bri</span><span class=p>}</span>

  <span class=c1>#- set the light values -#</span>
  <span class=n>tasmota</span><span class=o>.</span><span class=n>set_light</span><span class=p>(</span><span class=n>light_payload</span><span class=p>)</span>

  <span class=c1># report the command as successful</span>
  <span class=n>tasmota</span><span class=o>.</span><span class=n>resp_cmnd_done</span><span class=p>()</span>
<span class=n>end</span>
</code></pre></div> <p>Finally you need to register the command:</p> <div class=highlight><pre><span></span><code><span class=n>tasmota</span><span class=o>.</span><span class=n>add_cmd</span><span class=p>(</span><span class=s1>&#39;LightGold&#39;</span><span class=p>,</span> <span class=n>light_gold</span><span class=p>)</span>
</code></pre></div> <p>Example (in Tasmota console, not Berry console):</p> <div class=highlight><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">lightgold</span>

<span class="l l-Scalar l-Scalar-Plain">20:53:28.142 CMD</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lightgold</span>
<span class=nt>20:53:28.151 RSL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stat/tasmota_923B34/RESULT = {&quot;POWER&quot;:&quot;ON&quot;}</span>
<span class=nt>20:53:28.153 RSL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stat/tasmota_923B34/POWER = ON</span>
<span class=nt>20:53:28.160 RSL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stat/tasmota_923B34/RESULT = {&quot;LightGold&quot;:&quot;Done&quot;}</span>

<span class="l l-Scalar l-Scalar-Plain">lightgold {&quot;Dimmer&quot;:20}</span>

<span class=nt>20:54:16.837 CMD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lightgold {&quot;Dimmer&quot;:20}</span>
<span class=nt>20:54:16.848 RSL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stat/tasmota_923B34/RESULT = {&quot;LightGold&quot;:&quot;Done&quot;}</span>
</code></pre></div> <h3 id=responding-to-commands>Responding to commands<a class=headerlink href=#responding-to-commands title="Permanent link">~</a></h3> <p>Tasmota expects that you send a response to commands. You can use the following methods:</p> <ul> <li><code>tasmota.resp_cmnd_done()</code>: report command as <code>Done</code> (including translated versions)</li> <li><code>tasmota.resp_cmnd_error()</code>: report command as <code>Error</code></li> <li><code>tasmota.resp_cmnd_failed()</code>: report command as <code>Failed</code></li> <li><code>tasmota.resp_cmnd_str(&lt;msg&gt;)</code>: report an arbitrary string</li> <li><code>tasmota.resp_cmd(&lt;json&gt;)</code>: report a custom JSON message (not prefixed by command name).</li> </ul> <h2 id=adding-a-button-to-the-main-menu>Adding a button to the Main menu<a class=headerlink href=#adding-a-button-to-the-main-menu title="Permanent link">~</a></h2> <p>Adding a button to the e.g. main menu can be achieved by using the message type <code>web_add_main_button()</code>. </p> <p>The method to be performed, when the user clicks the button is achieved by using the <code>web_sensor()</code> method checking for the presence of an argument and a possible value assigned to the argument. The class provides the necessary methods to read the arguments:</p> <ul> <li><code>webserver.has_arg(arg_name:string)</code>: -&gt; boolean, checks if an argument with this name exists</li> <li><code>webserver.arg_size()</code>: -&gt; integer, returns the number of arguments</li> <li><code>webserver.arg(arg_name:string or arg_index:int)</code>: -&gt; string, returns the value of the argument either by name or by position number [0..arg_size()-1]. If an argument has multiple values, you need to iterate using ints to get all values</li> <li><code>webserver.arg_name(arg_index:int)</code> -&gt; string, get the name of argument by index [0..arg_size()-1]</li> </ul> <p>Additionally the webserver class provides a new function of sending information to the Web UI by using the following methods</p> <ul> <li><code>webserver.content_send(content:string)</code></li> <li><code>webserver.content_send_style(content:string)</code></li> </ul> <p>Let's see an example implementation of button methods in a Driver class</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>webserver</span> <span class=c1># import webserver class</span>

<span class=k>class</span> <span class=nc>MyButtonMethods</span> <span class=p>:</span> <span class=n>Driver</span>

  <span class=k>def</span> <span class=nf>myOtherFunction</span><span class=p>(</span><span class=n>myValue</span><span class=p>)</span>
    <span class=c1>#- do something -#</span>
  <span class=n>end</span>

  <span class=c1>#- create a method for adding a button to the main menu -#</span>
  <span class=k>def</span> <span class=nf>web_add_main_button</span><span class=p>()</span>
    <span class=n>webserver</span><span class=o>.</span><span class=n>content_send</span><span class=p>(</span><span class=s2>&quot;&lt;p&gt;&lt;/p&gt;&lt;button onclick=&#39;la(</span><span class=se>\&quot;</span><span class=s2>&amp;m_toggle_main=1</span><span class=se>\&quot;</span><span class=s2>);&#39;&gt;Toggle Main&lt;/button&gt;&quot;</span><span class=p>)</span>
  <span class=n>end</span>

  <span class=c1>#- create a method for adding a button to the configuration menu-#</span>
  <span class=k>def</span> <span class=nf>web_add_config_button</span><span class=p>()</span>
    <span class=c1>#- the onclick function &quot;la&quot; takes the function name and the respective value you want to send as an argument -#</span>
    <span class=n>webserver</span><span class=o>.</span><span class=n>content_send</span><span class=p>(</span><span class=s2>&quot;&lt;p&gt;&lt;/p&gt;&lt;button onclick=&#39;la(</span><span class=se>\&quot;</span><span class=s2>&amp;m_toggle_conf=1</span><span class=se>\&quot;</span><span class=s2>);&#39;&gt;Toggle Conf&lt;/button&gt;&quot;</span><span class=p>)</span>
  <span class=n>end</span>

  <span class=c1>#- As we can add only one sensor method we will have to combine them besides all other sensor readings in one method -#</span>
  <span class=k>def</span> <span class=nf>web_sensor</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>webserver</span><span class=o>.</span><span class=n>has_arg</span><span class=p>(</span><span class=s2>&quot;m_toggle_main&quot;</span><span class=p>)</span>
      <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;button pressed&quot;</span><span class=p>)</span>
    <span class=n>end</span>

    <span class=k>if</span> <span class=n>webserver</span><span class=o>.</span><span class=n>has_arg</span><span class=p>(</span><span class=s2>&quot;m_toggle_conf&quot;</span><span class=p>)</span> <span class=c1># takes a string as argument name and returns a boolean</span>

      <span class=c1># we can even call another function and use the value as a parameter</span>
      <span class=n>var</span> <span class=n>myValue</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>webserver</span><span class=o>.</span><span class=n>arg</span><span class=p>(</span><span class=s2>&quot;m_toggle_conf&quot;</span><span class=p>))</span> <span class=c1># takes a string or integer(index of arguments) to get the value of the argument</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>myOtherFunction</span><span class=p>(</span><span class=n>myValue</span><span class=p>)</span>
    <span class=n>end</span>

    <span class=n>end</span>
  <span class=n>end</span>
<span class=n>d1</span> <span class=o>=</span> <span class=n>MyButtonMethods</span><span class=p>()</span>
<span class=n>tasmota</span><span class=o>.</span><span class=n>add_driver</span><span class=p>(</span><span class=n>d1</span><span class=p>)</span>
</code></pre></div> <h2 id=creating-an-i2c-driver>Creating an I2C driver<a class=headerlink href=#creating-an-i2c-driver title="Permanent link">~</a></h2> <p>Berry Scripting provides all necessary primitives for a complete I2C driver.</p> <h3 id=step-by-step-approach>Step by step approach<a class=headerlink href=#step-by-step-approach title="Permanent link">~</a></h3> <p>We will explore the different steps to write an I2C driver, and will take the MPU6886 as an example. The native driver already exists, and we'll rewrite it in Berry code.</p> <p><strong>Step 1: detect the device</strong></p> <p>I2C device are identified by address, only one device per address is allowed per I2C physical bus. Tasmota32 supports up to 2 I2C buses, using <code>wire1</code> or <code>wire2</code> objects.</p> <p>To simplify device detection, we provide the convenience method <code>tasmota.scan_wire()</code>. The first argument is the device address (0x68 for MPU6886). The optional second argument is the I2C Tasmota index, allowing to selectively disable some device families. See <code>I2CDevice</code> command and page XXX. The index number for MPU6886 is 58.</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>MPU6886</span> <span class=p>:</span> <span class=n>Driver</span>
  <span class=n>var</span> <span class=n>wire</span>     <span class=c1># contains the wire object if the device was detected</span>

  <span class=k>def</span> <span class=nf>init</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=o>=</span> <span class=n>tasmota</span><span class=o>.</span><span class=n>wire_scan</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mi>58</span><span class=p>)</span>
  <span class=n>end</span>
<span class=n>end</span>
</code></pre></div> <p><code>self.wire</code> contains a reference to <code>wire1</code> if the device was detected on I2C bus 1, a reference to <code>wire2</code> if the device was detected on bus 2, or <code>nil</code> if the device was not detected, or if I2C index 58 was disabled through <code>I2CEnable</code>.</p> <p><strong>Step 2: verify the device</strong></p> <p>To make sure the device is actually an MPU6886, we check its signature by reading register 0x75. It should respond 0x19 (see datasheet for MPU6886).</p> <div class=highlight><pre><span></span><code><span class=p>[</span><span class=o>...</span><span class=p>]</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span>
      <span class=n>var</span> <span class=n>v</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x75</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>v</span> <span class=o>!=</span> <span class=mh>0x19</span> <span class=k>return</span> <span class=n>end</span>  <span class=c1>#- wrong device -#</span>
<span class=p>[</span><span class=o>...</span><span class=p>]</span>
</code></pre></div> <p><strong>Step 3: initialize the device</strong></p> <p>We write a series of values in registers to configure the device as expected (see datasheet).</p> <div class=highlight><pre><span></span><code><span class=p>[</span><span class=o>...</span><span class=p>]</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>7</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_PWR_MGMT_1</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_PWR_MGMT_1</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_ACCEL_CONFIG - AFS_8G</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_GYRO_CONFIG - GFS_2000DPS</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_CONFIG</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_SMPLRT_DIV</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_INT_ENABLE</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_ACCEL_CONFIG2</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_USER_CTRL</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_FIFO_EN</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_INT_PIN_CFG</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_INT_ENABLE</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
<span class=p>[</span><span class=o>...</span><span class=p>]</span>
</code></pre></div> <p>We also pre-compute multiplier to convert raw values to actual values:</p> <div class=highlight><pre><span></span><code><span class=p>[</span><span class=o>...</span><span class=p>]</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>gres</span> <span class=o>=</span> <span class=mf>2000.0</span><span class=o>/</span><span class=mf>32768.0</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>ares</span> <span class=o>=</span> <span class=mf>8.0</span><span class=o>/</span><span class=mf>32678.0</span>
      <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I2C: MPU6886 detected on bus &quot;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>bus</span><span class=p>))</span>
<span class=p>[</span><span class=o>...</span><span class=p>]</span>
</code></pre></div> <p><strong>Step 4: read sensor value</strong></p> <p>We will detail here the acceleration senor; gyroscope works similarly and is not further detailed.</p> <p>Reading the x/y/z sensor requires to read 6 bytes as a <code>bytes()</code> object</p> <div class=highlight><pre><span></span><code>    <span class=n>var</span> <span class=n>b</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x3B</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span>
</code></pre></div> <p>Each value is 2 bytes. We use <code>bytes.get(offset,size)</code> to extract 2-bytes values at offsets 0/2/4. The size is <code>-2</code> to indicate that values are encoded in Big Endian instead of Little Endian.</p> <div class=highlight><pre><span></span><code>    <span class=n>var</span> <span class=n>a1</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
</code></pre></div> <p>Finally the read value is unsigned 16 bits, but the sensor value is signed 16 bits. We convert 16 bits unsigned to 16 bits signed.</p> <div class=highlight><pre><span></span><code>    <span class=k>if</span> <span class=n>a1</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a1</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
</code></pre></div> <p>We then repeat for y and z:</p> <div class=highlight><pre><span></span><code>  <span class=k>def</span> <span class=nf>read_accel</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=n>var</span> <span class=n>b</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x3B</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>a1</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a1</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a1</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=n>var</span> <span class=n>a2</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a2</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a2</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=n>var</span> <span class=n>a3</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a3</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a3</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>accel</span> <span class=o>=</span> <span class=p>[</span><span class=n>a1</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>ares</span><span class=p>,</span> <span class=n>a2</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>ares</span><span class=p>,</span> <span class=n>a3</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>ares</span><span class=p>]</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>accel</span>
  <span class=n>end</span>
</code></pre></div> <p><strong>Step 5: read sensor every second</strong></p> <p>Simply override <code>every_second()</code></p> <div class=highlight><pre><span></span><code>  <span class=k>def</span> <span class=nf>every_second</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>read_accel</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>read_gyro</span><span class=p>()</span>
  <span class=n>end</span>
</code></pre></div> <p><strong>Step 6: display sensor value in Web UI</strong></p> <p>You need to override <code>web_sensor()</code> and provide the formatted string. <code>tasmota.web_send_decimal()</code> sends a string to the Web UI, and converts decimal numbers according to the locale settings.</p> <p>Tasmota uses specific markers:</p> <ul> <li><code>{s}</code>: start of line</li> <li><code>{m}</code>: separator between name and value</li> <li><code>{e}</code>: end of line</li> </ul> <div class=highlight><pre><span></span><code>  <span class=c1>#- display sensor value in the web UI -#</span>
  <span class=k>def</span> <span class=nf>web_sensor</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=kn>import</span> <span class=nn>string</span>
    <span class=n>var</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 acc_x</span><span class=si>{m}%.3f</span><span class=s2> G</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 acc_y</span><span class=si>{m}%.3f</span><span class=s2> G</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 acc_z</span><span class=si>{m}%.3f</span><span class=s2> G</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 gyr_x</span><span class=si>{m}%i</span><span class=s2> dps</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 gyr_y</span><span class=si>{m}%i</span><span class=s2> dps</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 gyr_z</span><span class=si>{m}%i</span><span class=s2> dps</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=p>,</span>
              <span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
    <span class=n>tasmota</span><span class=o>.</span><span class=n>web_send_decimal</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
  <span class=n>end</span>
</code></pre></div> <p><strong>Step 7: publish JSON TelePeriod sensor value</strong></p> <p>Similarly to Web UI, publish sensor value as JSON.</p> <div class=highlight><pre><span></span><code>  <span class=c1>#- add sensor value to teleperiod -#</span>
  <span class=k>def</span> <span class=nf>json_append</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=kn>import</span> <span class=nn>string</span>
    <span class=n>var</span> <span class=n>ax</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>ay</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>az</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;,</span><span class=se>\&quot;</span><span class=s2>MPU6886</span><span class=se>\&quot;</span><span class=s2>:{</span><span class=se>\&quot;</span><span class=s2>AX</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>AY</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>AZ</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>GX</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>GY</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>GZ</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>}&quot;</span><span class=p>,</span>
              <span class=n>ax</span><span class=p>,</span> <span class=n>ay</span><span class=p>,</span> <span class=n>az</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
    <span class=n>tasmota</span><span class=o>.</span><span class=n>response_append</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
  <span class=n>end</span>
</code></pre></div> <h3 id=full-example>Full example<a class=headerlink href=#full-example title="Permanent link">~</a></h3> <p>The code can be loaded manually with copy/paste, or stored in flash and loaded at startup in <code>autoexec.be</code> as <code>load("mpu6886.be")</code>. Alternatively it can be loaded with a Tasmota native command or rule:</p> <div class=highlight><pre><span></span><code>Br load(&quot;mpu6886.be&quot;)
</code></pre></div> <p>See code example below for MPU6886:</p> <div class=highlight><pre><span></span><code><span class=c1>#-</span>
 <span class=o>-</span> <span class=n>Example</span> <span class=n>of</span> <span class=n>I2C</span> <span class=n>driver</span> <span class=n>written</span> <span class=ow>in</span> <span class=n>Berry</span>
 <span class=o>-</span>
 <span class=o>-</span> <span class=n>Support</span> <span class=k>for</span> <span class=n>MPU6886</span> <span class=n>device</span> <span class=n>found</span> <span class=ow>in</span> <span class=n>M5Stack</span>
 <span class=o>-</span> <span class=n>Alternative</span> <span class=n>to</span> <span class=n>xsns_85_mpu6886</span><span class=o>.</span><span class=n>ino</span> 
 <span class=o>-</span><span class=c1>#</span>

<span class=k>class</span> <span class=nc>MPU6886</span> <span class=p>:</span> <span class=n>Driver</span>
  <span class=n>var</span> <span class=n>wire</span>          <span class=c1>#- if wire == nil then the module is not initialized -#</span>
  <span class=n>var</span> <span class=n>gres</span><span class=p>,</span> <span class=n>ares</span>
  <span class=n>var</span> <span class=n>accel</span><span class=p>,</span> <span class=n>gyro</span>

  <span class=k>def</span> <span class=nf>init</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=o>=</span> <span class=n>tasmota</span><span class=o>.</span><span class=n>wire_scan</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mi>58</span><span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span>
      <span class=n>var</span> <span class=n>v</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x75</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>v</span> <span class=o>!=</span> <span class=mh>0x19</span> <span class=k>return</span> <span class=n>end</span>  <span class=c1>#- wrong device -#</span>

      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>7</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_PWR_MGMT_1</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_PWR_MGMT_1</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_ACCEL_CONFIG - AFS_8G</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_GYRO_CONFIG - GFS_2000DPS</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_CONFIG</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_SMPLRT_DIV</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_INT_ENABLE</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_ACCEL_CONFIG2</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_USER_CTRL</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_FIFO_EN</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_INT_PIN_CFG</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>    <span class=c1># MPU6886_INT_ENABLE</span>
      <span class=n>tasmota</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>

      <span class=bp>self</span><span class=o>.</span><span class=n>gres</span> <span class=o>=</span> <span class=mf>2000.0</span><span class=o>/</span><span class=mf>32768.0</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>ares</span> <span class=o>=</span> <span class=mf>8.0</span><span class=o>/</span><span class=mf>32678.0</span>
      <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I2C: MPU6886 detected on bus &quot;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>bus</span><span class=p>))</span>
    <span class=n>end</span>
  <span class=n>end</span>

  <span class=c1>#- returns a list of 3 axis, float as g acceleration -#</span>
  <span class=k>def</span> <span class=nf>read_accel</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=n>var</span> <span class=n>b</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x3B</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>a1</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a1</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a1</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=n>var</span> <span class=n>a2</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a2</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a2</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=n>var</span> <span class=n>a3</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a3</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>a3</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>accel</span> <span class=o>=</span> <span class=p>[</span><span class=n>a1</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>ares</span><span class=p>,</span> <span class=n>a2</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>ares</span><span class=p>,</span> <span class=n>a3</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>ares</span><span class=p>]</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>accel</span>
  <span class=n>end</span>

  <span class=c1>#- returns a list of 3 gyroscopes, int as dps (degree per second)  -#</span>
  <span class=k>def</span> <span class=nf>read_gyro</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=n>var</span> <span class=n>b</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wire</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x43</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>g1</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>g1</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>g1</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=n>var</span> <span class=n>g2</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>g2</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>g2</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=n>var</span> <span class=n>g3</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>g3</span> <span class=o>&gt;=</span> <span class=mh>0x8000</span> <span class=n>g3</span> <span class=o>-=</span> <span class=mh>0x10000</span> <span class=n>end</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>g1</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>gres</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g2</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>gres</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g3</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>gres</span><span class=p>)]</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span>
  <span class=n>end</span>

  <span class=c1>#- trigger a read every second -#</span>
  <span class=k>def</span> <span class=nf>every_second</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>read_accel</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>read_gyro</span><span class=p>()</span>
  <span class=n>end</span>

  <span class=c1>#- display sensor value in the web UI -#</span>
  <span class=k>def</span> <span class=nf>web_sensor</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=kn>import</span> <span class=nn>string</span>
    <span class=n>var</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 acc_x</span><span class=si>{m}%.3f</span><span class=s2> G</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 acc_y</span><span class=si>{m}%.3f</span><span class=s2> G</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 acc_z</span><span class=si>{m}%.3f</span><span class=s2> G</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 gyr_x</span><span class=si>{m}%i</span><span class=s2> dps</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 gyr_y</span><span class=si>{m}%i</span><span class=s2> dps</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=o>..</span>
             <span class=s2>&quot;</span><span class=si>{s}</span><span class=s2>MPU6886 gyr_z</span><span class=si>{m}%i</span><span class=s2> dps</span><span class=si>{e}</span><span class=s2>&quot;</span><span class=p>,</span>
              <span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
    <span class=n>tasmota</span><span class=o>.</span><span class=n>web_send_decimal</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
  <span class=n>end</span>

  <span class=c1>#- add sensor value to teleperiod -#</span>
  <span class=k>def</span> <span class=nf>json_append</span><span class=p>()</span>
    <span class=k>if</span> <span class=err>!</span><span class=bp>self</span><span class=o>.</span><span class=n>wire</span> <span class=k>return</span> <span class=n>nil</span> <span class=n>end</span>  <span class=c1>#- exit if not initialized -#</span>
    <span class=kn>import</span> <span class=nn>string</span>
    <span class=n>var</span> <span class=n>ax</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>ay</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>az</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>accel</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
    <span class=n>var</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;,</span><span class=se>\&quot;</span><span class=s2>MPU6886</span><span class=se>\&quot;</span><span class=s2>:{</span><span class=se>\&quot;</span><span class=s2>AX</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>AY</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>AZ</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>GX</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>GY</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>,</span><span class=se>\&quot;</span><span class=s2>GZ</span><span class=se>\&quot;</span><span class=s2>:</span><span class=si>%i</span><span class=s2>}&quot;</span><span class=p>,</span>
              <span class=n>ax</span><span class=p>,</span> <span class=n>ay</span><span class=p>,</span> <span class=n>az</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>gyro</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
    <span class=n>tasmota</span><span class=o>.</span><span class=n>response_append</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
  <span class=n>end</span>

<span class=n>end</span>
<span class=n>mpu6886</span> <span class=o>=</span> <span class=n>MPU6886</span><span class=p>()</span>
<span class=n>tasmota</span><span class=o>.</span><span class=n>add_driver</span><span class=p>(</span><span class=n>mpu6886</span><span class=p>)</span>
</code></pre></div> <h2 id=lvgl-touchscreen-with-3-relays>LVGL Touchscreen with 3 Relays<a class=headerlink href=#lvgl-touchscreen-with-3-relays title="Permanent link">~</a></h2> <div class=highlight><pre><span></span><code><span class=c1>#- start LVGL and init environment -#</span>
<span class=n>lv</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>

<span class=n>hres</span> <span class=o>=</span> <span class=n>lv</span><span class=o>.</span><span class=n>get_hor_res</span><span class=p>()</span>     <span class=c1># should be 240</span>
<span class=n>vres</span> <span class=o>=</span> <span class=n>lv</span><span class=o>.</span><span class=n>get_ver_res</span><span class=p>()</span>     <span class=c1># should be 320</span>

<span class=n>scr</span> <span class=o>=</span> <span class=n>lv</span><span class=o>.</span><span class=n>scr_act</span><span class=p>()</span>          <span class=c1># default screean object</span>
<span class=n>f20</span> <span class=o>=</span> <span class=n>lv</span><span class=o>.</span><span class=n>montserrat_font</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>  <span class=c1># load embedded Montserrat 20</span>
<span class=n>f28</span> <span class=o>=</span> <span class=n>lv</span><span class=o>.</span><span class=n>montserrat_font</span><span class=p>(</span><span class=mi>28</span><span class=p>)</span>  <span class=c1># load embedded Montserrat 28</span>

<span class=c1>#- Backgroun -#</span>
<span class=n>scr</span><span class=o>.</span><span class=n>set_style_local_bg_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0x000066</span><span class=p>))</span>  <span class=c1># backgroun in dark blue #000066</span>

<span class=c1>#- Upper state line -#</span>
<span class=n>stat_line</span> <span class=o>=</span> <span class=n>lv_label</span><span class=p>(</span><span class=n>scr</span><span class=p>)</span>
<span class=k>if</span> <span class=n>f20</span> <span class=o>!=</span> <span class=n>nil</span> <span class=n>stat_line</span><span class=o>.</span><span class=n>set_style_local_text_font</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>f20</span><span class=p>)</span> <span class=n>end</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_long_mode</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>LABEL_LONG_SROLL</span><span class=p>)</span>                                                  <span class=c1># auto scrolling if text does not fit</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_width</span><span class=p>(</span><span class=n>hres</span><span class=p>)</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_align</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>LABEL_ALIGN_LEFT</span><span class=p>)</span>                                                      <span class=c1># align text left</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_style_local_bg_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0x000088</span><span class=p>))</span>    <span class=c1># background #000088</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_style_local_bg_opa</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>OPA_COVER</span><span class=p>)</span>            <span class=c1># 100% background opacity</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_style_local_text_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0xFFFFFF</span><span class=p>))</span>  <span class=c1># text color #FFFFFF</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_text</span><span class=p>(</span><span class=s2>&quot;Tasmota&quot;</span><span class=p>)</span>
<span class=n>stat_line_height</span> <span class=o>=</span> <span class=n>stat_line</span><span class=o>.</span><span class=n>get_height</span><span class=p>()</span>

<span class=c1>#- display wifi strength indicator icon (for professionals ;) -#</span>
<span class=n>stat_line</span><span class=o>.</span><span class=n>set_style_local_pad_right</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>stat_line_height</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
<span class=n>wifi_bars</span> <span class=o>=</span> <span class=n>lv_wifi_bars</span><span class=p>(</span><span class=n>stat_line</span><span class=p>)</span>
<span class=n>wifi_bars</span><span class=o>.</span><span class=n>set_style_local_bg_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>BLACK</span><span class=p>))</span>
<span class=n>wifi_bars</span><span class=o>.</span><span class=n>set_height</span><span class=p>(</span><span class=n>stat_line_height</span><span class=p>)</span>
<span class=n>wifi_bars</span><span class=o>.</span><span class=n>set_width</span><span class=p>(</span><span class=n>stat_line_height</span><span class=p>)</span>
<span class=n>wifi_bars</span><span class=o>.</span><span class=n>set_x</span><span class=p>(</span><span class=n>stat_line</span><span class=o>.</span><span class=n>get_width</span><span class=p>()</span> <span class=o>-</span> <span class=n>stat_line_height</span><span class=p>)</span>

<span class=c1>#- create a style for the buttons -#</span>
<span class=n>btn_style</span> <span class=o>=</span> <span class=n>lv_style</span><span class=p>()</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_radius</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>                                                    <span class=c1># radius of rounded corners</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_bg_opa</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>OPA_COVER</span><span class=p>)</span>                                          <span class=c1># 100% background opacity</span>
<span class=k>if</span> <span class=n>f28</span> <span class=o>!=</span> <span class=n>nil</span> <span class=n>btn_style</span><span class=o>.</span><span class=n>set_text_font</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>f28</span><span class=p>)</span> <span class=n>end</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_bg_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0x33BBFF</span><span class=p>))</span>                                  <span class=c1># background color #1FA3EC (Tasmota Blue)</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_border_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0x0000FF</span><span class=p>))</span>                              <span class=c1># border color #0000FF</span>
<span class=c1>#btn_style.set_bg_color(lv.STATE_FOCUSED, lv_color(0x0000FF))                                  # background color when pressed #0000FF</span>
<span class=c1>#btn_style.set_border_color(lv.STATE_FOCUSED, lv_color(0xFFFFFF))                              # border color when pressed #FFFFFF</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_text_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_DEFAULT</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0x000000</span><span class=p>))</span>                                <span class=c1># text color #FFFFFF</span>
<span class=c1>#- enabled -#</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_bg_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_CHECKED</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0x0000FF</span><span class=p>))</span>                                  <span class=c1># background color #1FA3EC (Tasmota Blue)</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_text_color</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_CHECKED</span><span class=p>,</span> <span class=n>lv_color</span><span class=p>(</span><span class=mh>0xFFFFFF</span><span class=p>))</span>                                <span class=c1># text color #FFFFFF</span>
<span class=n>btn_style</span><span class=o>.</span><span class=n>set_outline_width</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>STATE_FOCUSED</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>                                              <span class=c1># remove focus outline, not needed with touchscreen</span>

<span class=c1>#- register buttons -#</span>
<span class=n>var</span> <span class=n>btns</span> <span class=o>=</span> <span class=p>[]</span>         <span class=c1># relay buttons are added to this list to match with Tasmota relays</span>

<span class=c1>#- simple function to find the index of an element in a list -#</span>
<span class=k>def</span> <span class=nf>findinlist</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
  <span class=k>for</span> <span class=n>i</span><span class=p>:</span><span class=mf>0.</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>l</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>
    <span class=k>if</span> <span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>x</span>
      <span class=k>return</span> <span class=n>i</span>
    <span class=n>end</span>
  <span class=n>end</span>
<span class=n>end</span>

<span class=c1>#- callback function when a button is pressed -#</span>
<span class=c1>#- checks if the button is in the list, and react to EVENT_VALUE_CHANGED event -#</span>
<span class=k>def</span> <span class=nf>btn_event_cb</span><span class=p>(</span><span class=n>o</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
  <span class=n>var</span> <span class=n>btn_idx</span> <span class=o>=</span> <span class=n>findinlist</span><span class=p>(</span><span class=n>btns</span><span class=p>,</span> <span class=n>o</span><span class=p>)</span>
  <span class=k>if</span> <span class=n>btn_idx</span> <span class=o>!=</span> <span class=n>nil</span> <span class=o>&amp;&amp;</span> <span class=n>event</span> <span class=o>==</span> <span class=n>lv</span><span class=o>.</span><span class=n>EVENT_VALUE_CHANGED</span>
    <span class=n>var</span> <span class=n>val</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>get_state</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>lv</span><span class=o>.</span><span class=n>BTN_STATE_CHECKED_RELEASED</span>   <span class=c1># true if checked, false if unchecked</span>
    <span class=n>tasmota</span><span class=o>.</span><span class=n>set_power</span><span class=p>(</span><span class=n>btn_idx</span><span class=p>,</span> <span class=err>!</span><span class=n>val</span><span class=p>)</span>                          <span class=c1># toggle the value</span>
  <span class=n>end</span>
<span class=n>end</span>

<span class=c1>#- create a button object, set style, register callback and add to global list -#</span>
<span class=c1>#- you still need to re-position the button -#</span>
<span class=k>def</span> <span class=nf>create_btn_relay</span><span class=p>(</span><span class=n>label</span><span class=p>)</span>
  <span class=n>var</span> <span class=n>btn</span><span class=p>,</span> <span class=n>btn_label</span>
  <span class=n>btn</span> <span class=o>=</span> <span class=n>lv_btn</span><span class=p>(</span><span class=n>scr</span><span class=p>)</span>
  <span class=n>btn</span><span class=o>.</span><span class=n>set_pos</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
  <span class=n>btn</span><span class=o>.</span><span class=n>set_size</span><span class=p>(</span><span class=n>hres</span> <span class=o>-</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>)</span>
  <span class=n>btn</span><span class=o>.</span><span class=n>add_style</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>btn_style</span><span class=p>)</span>
  <span class=n>btn</span><span class=o>.</span><span class=n>set_checkable</span><span class=p>(</span><span class=n>true</span><span class=p>)</span>                                                                      <span class=c1># enable toggle mode</span>
  <span class=n>btn_label</span> <span class=o>=</span> <span class=n>lv_label</span><span class=p>(</span><span class=n>btn</span><span class=p>)</span>
  <span class=n>btn_label</span><span class=o>.</span><span class=n>set_text</span><span class=p>(</span><span class=n>label</span><span class=p>)</span>
  <span class=n>btn</span><span class=o>.</span><span class=n>set_event_cb</span><span class=p>(</span><span class=n>btn_event_cb</span><span class=p>)</span>                            <span class=c1># set callback to update Tasmota relays</span>
  <span class=n>btns</span><span class=o>.</span><span class=n>push</span><span class=p>(</span><span class=n>btn</span><span class=p>)</span>                                            <span class=c1># append button to the list</span>
  <span class=k>return</span> <span class=n>btn</span>
<span class=n>end</span>

<span class=c1>#- create 3 buttons -#</span>
<span class=n>var</span> <span class=n>btn1</span> <span class=o>=</span> <span class=n>create_btn_relay</span><span class=p>(</span><span class=s2>&quot;Relay 1&quot;</span><span class=p>)</span>
<span class=n>btn1</span><span class=o>.</span><span class=n>set_y</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
<span class=n>var</span> <span class=n>btn2</span> <span class=o>=</span> <span class=n>create_btn_relay</span><span class=p>(</span><span class=s2>&quot;Relay 2&quot;</span><span class=p>)</span>
<span class=n>btn2</span><span class=o>.</span><span class=n>set_y</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
<span class=n>var</span> <span class=n>btn3</span> <span class=o>=</span> <span class=n>create_btn_relay</span><span class=p>(</span><span class=s2>&quot;Relay 3&quot;</span><span class=p>)</span>
<span class=n>btn3</span><span class=o>.</span><span class=n>set_y</span><span class=p>(</span><span class=mi>170</span><span class=p>)</span>

<span class=c1>#- update the buttons values according to internal relays status -#</span>
<span class=k>def</span> <span class=nf>btns_update</span><span class=p>()</span>
  <span class=n>var</span> <span class=n>power_list</span> <span class=o>=</span> <span class=n>tasmota</span><span class=o>.</span><span class=n>get_power</span><span class=p>()</span>                                            <span class=c1># get a list of booleans with status of each relay</span>
  <span class=k>for</span> <span class=n>b</span><span class=p>:</span><span class=n>btns</span>
    <span class=n>var</span> <span class=n>state</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>get_state</span><span class=p>()</span>
    <span class=n>var</span> <span class=n>power_state</span> <span class=o>=</span> <span class=p>(</span><span class=n>size</span><span class=p>(</span><span class=n>power_list</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=err>?</span> <span class=n>power_list</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=p>:</span> <span class=n>false</span>          <span class=c1># avoid exception if less relays than buttons</span>
    <span class=k>if</span> <span class=n>state</span> <span class=o>!=</span> <span class=n>lv</span><span class=o>.</span><span class=n>BTN_STATE_PRESSED</span> <span class=o>&amp;&amp;</span> <span class=n>state</span> <span class=o>!=</span> <span class=n>lv</span><span class=o>.</span><span class=n>BTN_STATE_CHECKED_PRESSED</span>     <span class=c1># update only if the button is not currently being pressed</span>
      <span class=n>b</span><span class=o>.</span><span class=n>set_state</span><span class=p>(</span><span class=n>power_state</span> <span class=err>?</span> <span class=n>lv</span><span class=o>.</span><span class=n>BTN_STATE_CHECKED_RELEASED</span> <span class=p>:</span> <span class=n>lv</span><span class=o>.</span><span class=n>BTN_STATE_RELEASED</span><span class=p>)</span>
    <span class=n>end</span>
  <span class=n>end</span>
<span class=n>end</span>

<span class=c1>#- update every 500ms -#</span>
<span class=k>def</span> <span class=nf>btns_update_loop</span><span class=p>()</span>
  <span class=n>btns_update</span><span class=p>()</span>
  <span class=n>tasmota</span><span class=o>.</span><span class=n>set_timer</span><span class=p>(</span><span class=mi>500</span><span class=p>,</span> <span class=n>btns_update_loop</span><span class=p>)</span>
<span class=n>end</span>
<span class=n>btns_update_loop</span><span class=p>()</span>  <span class=c1># start</span>

<span class=c1># If you change the style after creating the button, you need to update objects:</span>
<span class=k>def</span> <span class=nf>btns_refresh_style</span><span class=p>()</span>
  <span class=k>for</span> <span class=n>b</span><span class=p>:</span><span class=n>btns</span> <span class=n>b</span><span class=o>.</span><span class=n>refresh_style</span><span class=p>(</span><span class=n>lv</span><span class=o>.</span><span class=n>OBJ_PART_MAIN</span><span class=p>,</span> <span class=n>lv</span><span class=o>.</span><span class=n>STYLE_PROP_ALL</span><span class=p>)</span> <span class=n>end</span>
<span class=n>end</span>

<span class=c1># Button states, read and set with:</span>
<span class=c1>#   btn1.get_state()  or  btn1.set_state(lv.BTN_STATE_CHECKED_RELEASED)</span>
<span class=c1># Ex:</span>
<span class=c1>#    btn1.set_state(lv.BTN_STATE_RELEASED)</span>
<span class=c1>#    btn1.set_state(lv.BTN_STATE_CHECKED_RELEASED)</span>

<span class=c1>#- Here are the states for buttons -#</span>
<span class=c1># BTN_STATE_RELEASED</span>
<span class=c1># BTN_STATE_PRESSED</span>
<span class=c1># BTN_STATE_DISABLED</span>
<span class=c1># BTN_STATE_CHECKED_RELEASED</span>
<span class=c1># BTN_STATE_CHECKED_PRESSED</span>
<span class=c1># BTN_STATE_CHECKED_DISABLED</span>
</code></pre></div> <h2 id=multi-zone-heating-controller>Multi-Zone Heating Controller<a class=headerlink href=#multi-zone-heating-controller title="Permanent link">~</a></h2> <p>This project is a multi-zone heating controller written entirely in berry. It demonstrates the use of the persist module for saving/loading data; the webserver module for creating a custom "Manage Heating" user interface; dynamic loading of HTML from the file system; subscribing to a variety of rule triggers (using tasmota.add_rule); the implementation of custom commands (using tasmota.add_cmnd). It also makes good use of time functionaity (via tasmota.rtc, tasmota.time_dump, tasmota.set_timer and tasmota.strftime). The project also includes an LCD I2C driver for running a basic 20x4 display. The entire driver is implemented using just the tasmota.wire_scan method.</p> <p><a href=https://github.com/Beormund/Tasmota32-Multi-Zone-Heating-Controller>https://github.com/Beormund/Tasmota32-Multi-Zone-Heating-Controller</a></p> <h2 id=ethernet-network-flipper>Ethernet Network Flipper<a class=headerlink href=#ethernet-network-flipper title="Permanent link">~</a></h2> <p>Used on board with Ethernet. If both Wi-Fi and Ethernet are active, turn off Wi-Fi. Place code in <code>autoexec.be</code> to execute on boot. You can call the function from Berry console any time with <code>netflip()</code>.</p> <p><div class=highlight><pre><span></span><code>def netflip()
  var eth = tasmota.eth().find(&#39;ip&#39;) != nil   #1
  if tasmota.wifi().find(&#39;ip&#39;) != nil == eth  #2
    tasmota.cmd(&#39;Wifi &#39; .. (eth ? 0 : 1))     #3
  end
end
tasmota.set_timer(30000,netflip)              #4
</code></pre></div> 1. store variable "eth" with Ethernet status - "true" if Ethernet IP exists and "false" if not 2. check if wifi status is true and compare to eth status 3. send command <code>Wifi</code> with parameter depending on eth variable. <code>..</code> is to concatenate a string. See Berry [manualg(https://github.com/berry-lang/berry/wiki/Chapter-3#-operator-1) 4. set a timer to execute the netflip function 30000ms (30 seconds) after loading <code>autoexec.be</code></p> <h2 id=tmp117-driver>TMP117 Driver<a class=headerlink href=#tmp117-driver title="Permanent link">~</a></h2> <p><a href=https://github.com/TomsTek/tasmota-berry-TMP117-driver>TomsTek@GitHub</a></p> <h2 id=call-function-at-intervals>Call function at intervals<a class=headerlink href=#call-function-at-intervals title="Permanent link">~</a></h2> <p>This small helper function allows you to call a function at stable intervals, automatically correcting in case of latency or other deviations. Not suitable for very short intervals; while the delay interval is in milliseconds for consistency with the standard <code>tasmota.set_timer</code>, it would normally be seconds multiplied by 1000, like 60000 for every minute.</p> <div class=highlight><pre><span></span><code>def set_timer_modulo(delay,f,id)
  var now=tasmota.millis()
  tasmota.set_timer((now+delay/4+delay)/delay*delay-now, def() set_timer_modulo(delay,f,id) f() end, id)
end
</code></pre></div> <h2 id=h-bridge-control>H-bridge control<a class=headerlink href=#h-bridge-control title="Permanent link">~</a></h2> <p>An H-bridge is an electronic circuit that switches the polarity of a voltage applied to a load. These circuits are often used in robotics and other applications to allow DC motors to run forwards or backwards.</p> <p>You can typically use 2 PWM channels to pilot a H-bridge, under the condition that both channels are never active at the same time; otherwise you may destroy your device. This means that phasing must be calculated so that one pulse started once the other pulse is inactive, and the sum of both dutys must not exceed 100%.</p> <p>The following Berry function ensures appropriate management of H-bridge:</p> <div class=highlight><pre><span></span><code><span class=c1>#</span>
<span class=c1># H_bridge class in Berry to pilot a H-bridge device</span>
<span class=c1>#</span>

<span class=k>class</span><span class=w> </span><span class=nc>H_bridge</span>
<span class=w>  </span><span class=n>var</span><span class=w> </span><span class=n>gpio1</span><span class=p>,</span><span class=w> </span><span class=n>gpio2</span>
<span class=w>  </span><span class=n>var</span><span class=w> </span><span class=n>max</span>

<span class=w>  </span><span class=c1># init(phy_gpio1, phy_gpio2) - initialize H-bridge with the 2 GPIOs used to control it</span>
<span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>init</span><span class=p>(</span><span class=n>gpio1</span><span class=p>,</span><span class=w> </span><span class=n>gpio2</span><span class=p>)</span>
<span class=w>    </span><span class=nb>self</span><span class=o>.</span><span class=n>gpio1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gpio1</span>
<span class=w>    </span><span class=nb>self</span><span class=o>.</span><span class=n>gpio2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gpio2</span>
<span class=w>    </span><span class=nb>self</span><span class=o>.</span><span class=n>max</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1023</span><span class=w>     </span><span class=c1># max value of duty</span>
<span class=w>  </span><span class=k>end</span>

<span class=w>  </span><span class=c1># set the value of both PWM values</span>
<span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>set</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span><span class=w> </span><span class=n>v2</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>v1</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=n>v1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>end</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>v2</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>end</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>v1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>v2</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=nb>self</span><span class=o>.</span><span class=n>max</span>
<span class=w>      </span><span class=k>raise</span><span class=w> </span><span class=s2>&quot;value_error&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;the sum of duties must not exceed 100%&quot;</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=n>import</span><span class=w> </span><span class=n>gpio</span>
<span class=w>    </span><span class=n>gpio</span><span class=o>.</span><span class=n>set_pwm</span><span class=p>(</span><span class=nb>self</span><span class=o>.</span><span class=n>gpio1</span><span class=p>,</span><span class=w> </span><span class=n>v1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
<span class=w>    </span><span class=n>gpio</span><span class=o>.</span><span class=n>set_pwm</span><span class=p>(</span><span class=nb>self</span><span class=o>.</span><span class=n>gpio2</span><span class=p>,</span><span class=w> </span><span class=n>v2</span><span class=p>,</span><span class=w> </span><span class=n>v1</span><span class=p>)</span><span class=w>    </span><span class=c1># dephase by value v1</span>
<span class=w>  </span><span class=k>end</span>
<span class=k>end</span>
</code></pre></div> <p>Example of use:</p> <div class=highlight><pre><span></span><code><span class=n>var</span><span class=w> </span><span class=n>hbridge</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>H_bridge</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>)</span><span class=w>    </span><span class=c1># use GPIO12 and GPIO13</span>
<span class=n>hbridge</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span><span class=mi>200</span><span class=p>)</span><span class=w>              </span><span class=c1># set values to 102/1023 and 204/1023, i.e. 10% and 20%</span>

<span class=n>hbridge</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span><span class=mi>950</span><span class=p>)</span><span class=w>              </span><span class=c1># set values to 102/1023 and 950/1023, i.e. 10% and 93%</span>
<span class=ss>BRY</span><span class=p>:</span><span class=w> </span><span class=no>Exception</span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;value_error&#39;</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>sum</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>duties</span><span class=w> </span><span class=n>must</span><span class=w> </span><span class=ow>not</span><span class=w> </span><span class=n>exceed</span><span class=w> </span><span class=mi>100</span><span class=o>%</span>
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.4b2c34cd.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>