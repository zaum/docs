<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/Self-signed-Mosquitto/ rel=canonical><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.12"><title>Self signed Mosquitto - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8J08F8X90S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#benefits class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Self signed Mosquitto </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> Firmware Builds </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog Pin </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> ArtNet DMX </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> IPv6 </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting Language </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_18> <label class=md-nav__link for=__nav_2_18 id=__nav_2_18_label tabindex=0> Protocol Bridging <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_18_label aria-expanded=false> <label class=md-nav__title for=__nav_2_18> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> Arduino MCU </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> BLE Gateway </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> LCD/DLP Projector Control </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> Modbus Bridge </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> Thermostat </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> Universal File System </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> Wi-Fi Range Extender </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> ESP32 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> Tasmota32 Features </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> Berry </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> Bluetooth Low Energy </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> I2S Audio </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> LVGL </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> HASPmota </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> Tasmota Application Files </a> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> Touch GPIOs </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> Safeboot Partition Layout </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> Supported Devices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> Tasmohab </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> Web Installer </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#benefits class=md-nav__link> Benefits </a> <nav class=md-nav aria-label=Benefits> <ul class=md-nav__list> <li class=md-nav__item> <a href=#-no-cloud-usage class=md-nav__link> - No cloud usage </a> </li> <li class=md-nav__item> <a href=#-maximum-security class=md-nav__link> - Maximum security </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#caveats class=md-nav__link> Caveats </a> </li> <li class=md-nav__item> <a href=#how-to-configure class=md-nav__link> How to configure? </a> <nav class=md-nav aria-label="How to configure?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linux-and-windows class=md-nav__link> Linux and Windows </a> </li> <li class=md-nav__item> <a href=#1-prepare-your-ca-on-server-machine class=md-nav__link> 1. Prepare your CA (on Server Machine) </a> </li> <li class=md-nav__item> <a href=#2-configure-your-tasmotabuild-on-compiling-machine class=md-nav__link> 2. Configure your Tasmotabuild (on Compiling Machine) </a> </li> <li class=md-nav__item> <a href=#3-build-your-tasmota-binaries-flash-and-configure-your-devices class=md-nav__link> 3. Build your Tasmota Binaries, flash and configure your devices </a> </li> <li class=md-nav__item> <a href=#4-configure-your-network class=md-nav__link> 4. Configure your network </a> </li> <li class=md-nav__item> <a href=#5-install-and-configure-mosquitto-on-your-server class=md-nav__link> 5. Install and configure Mosquitto on your server </a> </li> <li class=md-nav__item> <a href=#6-generate-and-configure-certificates-for-your-devices class=md-nav__link> 6. - Generate and configure certificates for your devices </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#building-bearssl-on-windows-machines class=md-nav__link> Building BearSSL on Windows machines </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Self-signed-Mosquitto.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1>Self signed Mosquitto</h1> <div class="admonition failure"> <p class=admonition-title>This feature is not included in precompiled binaries</p> <p>To use it you must <a href=../Compile-your-build/ >compile your build</a>.</p> </div> <p>The following guide will walk you through the setup of Tasmota with your own instance of Mosquitto Server with Certificate-based TLS encryption and a Self-signed CA (Certificate Authority).</p> <h2 id=benefits>Benefits<a class=headerlink href=#benefits title="Permanent link">~</a></h2> <p>The following setup provides stronger security in communication between your devices and your MQTT server.</p> <h3 id=-no-cloud-usage>- No cloud usage<a class=headerlink href=#-no-cloud-usage title="Permanent link">~</a></h3> <p>Many people might prefer cloud-based solutions, such as <a href=../AWS-IoT/ >AWS IOT</a>. Nonetheless, running local MQTT provides various benefits like no internet requirements, no data sharing with third parties and lower latencies.</p> <h3 id=-maximum-security>- Maximum security<a class=headerlink href=#-maximum-security title="Permanent link">~</a></h3> <p>This setup is designed with 'security first' in mind.</p> <p>Communication is done over TLS 1.2 tunnels, using client certificates to authenticate each device.</p> <p>Strong encryption is particularly valuable considering that ESP8266-based Tasmota devices can only connect using WPA2 with preshared keys. Because WPA2 Personal has known security weaknesses, the MQTT strong TLS configuration is encouraged in this scenario.</p> <h2 id=caveats>Caveats<a class=headerlink href=#caveats title="Permanent link">~</a></h2> <p>Certificate-based MQTT-TLS requires each Tasmota device to have its own distinct Private Key and Certificate (~800 bytes). Although you could imagine to use the same Private Key in all your devices, this is considered as a very bad practice. You are warned!</p> <p>During TLS handshake, a secondary stack of 5.3k is allocated on the heap to allow BearSSL to have enough stack room. Memory is freed at the end of the handshake. Allocating such big chunks of memory can cause issues when heap fragmentation gets too high. If you see memory going below 15KB, you may experience crashes.</p> <h2 id=how-to-configure>How to configure?<a class=headerlink href=#how-to-configure title="Permanent link">~</a></h2> <p>Ideally we will work on three systems: 1. <strong>CA machine</strong>: a secure, possibly air-gap system, where you generate your certificates; 2. <strong>Server Machine</strong>: the machine running your MQTT server. We will assume it is running some Debian-based distribution (i.e. Ubuntu Server), though the steps could be adapted to different OSes; 3. <strong>Compiling Machine</strong>: the machine used to compile your customized Tasmota firmware. This machine might be the same <strong>Server Machine</strong>, though I would not recommend it.</p> <p>!!! failure "Security notice" Private keys, and in particular the CA private key should reside on a secure, possibly air-gapped system. Securing your CA and procedures for managing private keys exceeds the scope of this guide, but we assume you follow best security practices.</p> <p>There are several figures below containing command sequences that need to be executed in a POSIX shell. The intention is that text in the figure windows will be selected and copied, then pasted into a terminal window. These commands will not work if pasted into a Windows command prompt.</p> <h3 id=linux-and-windows>Linux and Windows<a class=headerlink href=#linux-and-windows title="Permanent link">~</a></h3> <p>The description below is written mainly from the perspective of someone using a Linux OS. Information is also provided for those working on a Windows OS, but a Linux command shell (e.g. <code>sh</code> or <code>bash</code>) is assumed for much of the work. Cygwin is a good choice for this purpose. It's not impossible to do perform these tasks in native Windows without a POSIX shell, although that is beyond the scope of this document.</p> <p>A Cygwin installation should include the git package (Devel category) and openssl package (Net category). Additional packages will be required as discussed later if BearSSL is to be installed.</p> <h3 id=1-prepare-your-ca-on-server-machine>1. Prepare your CA (on <strong>Server Machine</strong>)<a class=headerlink href=#1-prepare-your-ca-on-server-machine title="Permanent link">~</a></h3> <p>We will use Easy-RSA for easy management of the CA and certificates. Some modification are required to match our configuration.</p> <h4 id=11-prepare-easy-rsa>1.1. Prepare Easy-RSA :<a class=headerlink href=#11-prepare-easy-rsa title="Permanent link">~</a></h4> <p>Get a copy of Easy-RSA and add a reduced x509 extension definition for Tasmota. Certificates obtained using standard client definitions are too big and results in failure when storing them on Tasmota devices. <div class=highlight><pre><span></span><code>git clone https://github.com/OpenVPN/easy-rsa.git
cd easy-rsa/easyrsa3

# Define reduced x509 extension for Tasmota
cat &lt;&lt;EOF &gt; x509-types/tasmota
# X509 extensions for a Tasmota client
basicConstraints = critical,CA:FALSE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always
keyUsage = critical,digitalSignature
EOF
</code></pre></div> Windows users may have trouble running EasyRSA natively. If that happens, it's also possible to install Cygwin, and work from a Cygwin terminal window. One note of caution: The <code>easyrsa</code> shell script may wind up with the wrong line endings if git is not configured to checkout line endings "as is". When this happens, the shell script will not run in Cygwin, and this problem may be fixed by using the <code>tr</code> program to delete carriage returns in the script file: <div class=highlight><pre><span></span><code>mv easyrsa tmprsa
tr -d &#39;\r&#39; &lt;tmprsa &gt;easyrsa
</code></pre></div></p> <h4 id=12-define-your-certificate-information>1.2. Define your certificate information<a class=headerlink href=#12-define-your-certificate-information title="Permanent link">~</a></h4> <p>The commands below may be copied and pasted into a terminal window, then the resulting file, <code>vars</code> edited as appropriate.</p> <div class=highlight><pre><span></span><code># Define your info
cat &lt;&lt;EOF &gt; vars
# Define X509 DN mode.
# This is used to adjust what elements are included in the Subject field as the DN
# (this is the &quot;Distinguished Name.&quot;)
# Note that in cn_only mode the Organizational fields further below aren&#39;t used.
#
# Choices are:
#   cn_only  - use just a CN value
#   org      - use the &quot;traditional&quot; Country/Province/City/Org/OU/email/CN format

set_var EASYRSA_DN &quot;org&quot;

# Organizational fields (used with &#39;org&#39; mode and ignored in &#39;cn_only&#39; mode.)
# These are the default values for fields which will be placed in the
# certificate.  Don&#39;t leave any of these fields blank, although interactively
# you may omit any specific field by typing the &quot;.&quot; symbol (not valid for
# email.)

set_var EASYRSA_REQ_COUNTRY &quot;UK&quot;
set_var EASYRSA_REQ_PROVINCE &quot;London&quot;
set_var EASYRSA_REQ_CITY &quot;London&quot;
set_var EASYRSA_REQ_ORG &quot;myorg&quot;
set_var EASYRSA_REQ_EMAIL &quot;info@myorg.com&quot;
set_var EASYRSA_REQ_OU &quot;MQTT&quot;

# Choose a size in bits for your keypairs. The recommended value is 2048.  Using
# 2048-bit keys is considered more than sufficient for many years into the
# future. Larger keysizes will slow down TLS negotiation and make key/DH param
# generation take much longer. Values up to 4096 should be accepted by most
# software. Only used when the crypto alg is rsa (see below.)

set_var EASYRSA_KEY_SIZE 2048

# The default crypto mode is rsa; ec can enable elliptic curve support.
# Note that not all software supports ECC, so use care when enabling it.
# Choices for crypto alg are: (each in lower-case)
#  * rsa
#  * ec
#  * ed

set_var EASYRSA_ALGO rsa

# Define the named curve, used in ec &amp; ed modes:

set_var EASYRSA_CURVE prime256v1
# In how many days should the root CA key expire?

set_var EASYRSA_CA_EXPIRE 3650

# In how many days should certificates expire?

set_var EASYRSA_CERT_EXPIRE 1800
# Cryptographic digest to use.
# Do not change this default unless you understand the security implications.
# Valid choices include: md5, sha1, sha256, sha224, sha384, sha512

#set_var EASYRSA_DIGEST &quot;sha256&quot;
EOF
</code></pre></div> <p>This creates a configuration file named <code>vars</code> -- the default file which the <code>easyrsa</code> shell script looks for.</p> <p>If the configuration is to be changed there are two options. First, <code>vars</code> can simply be edited to reflect the new configuration. However, if multiple configurations are often used, it may be easier to use a different file for each configuration, and the configuration specified on the command line. For example, to use a configuration file named <code>vars3</code>, the command would look like this (the config file spec must come before other arguments):</p> <div class=highlight><pre><span></span><code>./easyrsa --vars=./vars3 &lt;remaining arguments&gt;
</code></pre></div> <p>Note that the file is specified as <code>./&lt;filename&gt;</code>, not <code>&lt;filename&gt;</code>. This required because the specified file will be sourced in the EasyRSA shell script, and it's assumed that the current directory is not part of the search path (that would be a security concern).</p> <h4 id=13-initialize-and-generate-the-ca-and-the-server-certificates>1.3. Initialize and generate the CA and the server certificates:<a class=headerlink href=#13-initialize-and-generate-the-ca-and-the-server-certificates title="Permanent link">~</a></h4> <p>When generating the server (aka broker) certificate, it is crucial that the Common Name (CN) be set correctly. Failing to do this will result in Tasmota devices refusing to make TLS connections to the server.</p> <p>Each Tasmota device needs to be configured with the host name of the server. This is done via the <code>MQTT_HOST</code> macro in <code>user_config_override.h</code>, and/or in the device's MQTT Configuration web page. The host name string must meet two requirements: - The Tasmota device must be able to resolve the name, which might require access to a DNS server. - This string must match the Common Name (CN) in the broker's certificate -- exactly.</p> <p>Consider a situation where the device is running on an isolated WiFi network with no access to a DNS server. In this case, it may be necessary to specify the MQTT Host as a numeric IP address (e.g. <code>192.168.2.3</code>). For this example, the CN in the host's certificate must be the string <code>192.168.2.3</code>.</p> <p>To generate the root CA and server certificates, issue these commands. This example assumes the server's hostname and server certificate CN is <code>mqtt.myorg.com</code>.</p> <div class=highlight><pre><span></span><code># Reset PKI
./easyrsa init-pki
# Build CA following instructions
./easyrsa build-ca
# Request server certificate following instructions
./easyrsa gen-req mqtt.myorg.com
# Sign certificate for server
./easyrsa sign-req server mqtt.myorg.com
</code></pre></div> <h4 id=14-change-key-types-ec-is-required-for-tasmota-devices>1.4. Change key types (EC is required for tasmota devices)<a class=headerlink href=#14-change-key-types-ec-is-required-for-tasmota-devices title="Permanent link">~</a></h4> <p>This example shows editing of the <code>vars</code> file, although a second configuration file could be created for EC keys as explained previously.</p> <div class=highlight><pre><span></span><code>sed -i &#39;/^set_var\ EASYRSA_ALGO/ s/rsa/ec/&#39; vars
</code></pre></div> <h4 id=15-copy-the-following-files-to-the-server-machine>1.5. Copy the following files to the <strong>Server Machine</strong><a class=headerlink href=#15-copy-the-following-files-to-the-server-machine title="Permanent link">~</a></h4> <div class=highlight><pre><span></span><code>./pki/ca.crt --&gt; CA certificate file
./pki/issued/mqtt.myorg.com.crt --&gt; Server certificate file
./pki/private/mqtt.myorg.com.key --&gt; Server private Key file
</code></pre></div> <h4 id=16-optional-step-for-full-certificate-validation>1.6. (Optional step for full certificate validation)<a class=headerlink href=#16-optional-step-for-full-certificate-validation title="Permanent link">~</a></h4> <ul> <li>Copy <code>./pki/ca.crt</code>to your <strong>Compiling Machine</strong></li> <li>Install and build BearSSL (see below for help with building BearSSL on Windows machines). <div class=highlight><pre><span></span><code>git clone https://www.bearssl.org/git/BearSSL
cd BearSSL
make tools
</code></pre></div></li> <li>Convert the root certificate into a format suitable for inclusion in the Tasmota build. This be will easier if the <code>brssl</code> (<code>brssl.exe</code> in Cygwin) executable is copied into the the <code>easyrsa3</code> directory first. Then, these two commands may be executed from the <code>easyrsa3</code> directory verbatim to generate the required header files.</li> </ul> <div class=highlight><pre><span></span><code>./brssl ta pki/ca.crt | sed -e &#39;s/TA0/PROGMEM TA0/&#39; -e &#39;/br_x509/,+999 d&#39; &gt; local_ca_data.h
./brssl ta pki/ca.crt | sed -e &#39;1,/br_x509/ d&#39; -e &#39;/};/,+999 d&#39; &gt;local_ca_descriptor.h
</code></pre></div> <h3 id=2-configure-your-tasmotabuild-on-compiling-machine>2. Configure your Tasmotabuild (on <strong>Compiling Machine</strong>)<a class=headerlink href=#2-configure-your-tasmotabuild-on-compiling-machine title="Permanent link">~</a></h3> <p>Refer to your preferred way to custom compile Tasmota. Modify the default configuration following one of 2.1 or 2.2 solutions (Easier or Advanced):</p> <h4 id=21-easier-using-fingerprint-validation>2.1. Easier: Using fingerprint validation<a class=headerlink href=#21-easier-using-fingerprint-validation title="Permanent link">~</a></h4> <p>Add the following to <code>user_config_override.h</code>:</p> <div class=highlight><pre><span></span><code>#ifndef USE_MQTT_TLS
#define USE_MQTT_TLS
//  #define USE_MQTT_TLS_CA_CERT               // Force full CA validation instead of fingerprints, slower, but simpler to use.  (+2.2k code, +1.9k mem during connection handshake)
#define USE_MQTT_AWS_IOT                       // This includes the LetsEncrypt CA in tasmota_ca.ino for verifying server certificates
#define USE_MQTT_TLS_FORCE_EC_CIPHER           // Force Elliptic Curve cipher (higher security) required by some servers (automatically enabled with USE_MQTT_AWS_IOT) (+11.4k code, +0.4k mem)
#define MQTT_FINGERPRINT1      &quot;00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00&quot;  // [MqttFingerprint1] (auto-learn)
#define MQTT_FINGERPRINT2      &quot;DA 39 A3 EE 5E 6B 4B 0D 32 55 BF EF 95 60 18 90 AF D8 07 09&quot;  // [MqttFingerprint2] (invalid)
#endif
</code></pre></div> <h4 id=22-advanced-using-full-certificate-validation>2.2. Advanced: Using Full certificate validation<a class=headerlink href=#22-advanced-using-full-certificate-validation title="Permanent link">~</a></h4> <p>Add the following to <code>user_config_override.h</code>:</p> <p><div class=highlight><pre><span></span><code>#ifndef USE_MQTT_TLS
#define USE_MQTT_TLS
#define USE_MQTT_TLS_CA_CERT                   // Force full CA validation instead of fingerprints, slower, but simpler to use.  (+2.2k code, +1.9k mem during connection handshake)
#define USE_MQTT_AWS_IOT                       // This will include LetsEncrypt CA, as well as our CA, in tasmota_ca.ino for verifying server certificates
#define USE_MQTT_TLS_FORCE_EC_CIPHER           // Force Elliptic Curve cipher (higher security) required by some servers (automatically enabled with USE_MQTT_AWS_IOT) (+11.4k code, +0.4k mem)
#define INCLUDE_LOCAL_CERT
#endif
</code></pre></div> Copy or move the files created in step 1.6 above (<code>local_ca_data.h</code> and <code>local_ca_descriptor.h</code>) to the <code>$TASMOTAROOT/tasmota/include</code> directory. If desired, the two built-in certificates for Let's Encrypt and Amazon AWS may be omitted from the build by defining these macros in <code>user_config_override.h</code>:</p> <div class=highlight><pre><span></span><code>#define OMIT_LETS_ENCRYPT_CERT
#define OMIT_AWS_CERT
</code></pre></div> <h3 id=3-build-your-tasmota-binaries-flash-and-configure-your-devices>3. Build your Tasmota Binaries, flash and configure your devices<a class=headerlink href=#3-build-your-tasmota-binaries-flash-and-configure-your-devices title="Permanent link">~</a></h3> <p>Initially at least, build the binaries with the web server enabled. Pull up the web page on each device and check the configuration. In particular check the following settings.</p> <ul> <li>WiFi Host Name</li> <li>MQTT Host -- must be resolvable, and match the Common Name on the server's certificate</li> <li>MQTT Port -- this often does not come up as defined in the configuration file, and must be changed to 8883</li> <li>MQTT Topic</li> </ul> <h3 id=4-configure-your-network>4. Configure your network<a class=headerlink href=#4-configure-your-network title="Permanent link">~</a></h3> <p>The Common Name (CN) in the server's certificate will either be a resolvable name (like <code>mqtt.myorg.com</code>), or the IP address string for the server (e.g. <code>192.168.2.3</code>). The host name assigned to the server must match this CN, unless an IP address string is used in the server certificate CN, in which case the host name can be anything. These next two items are only necessary where the CN is not an IP address string.</p> <ul> <li>Configure your router to resolve the Tasmota device's MQTT Host Name (e.g. <code>mqtt.myorg.com</code>) to your <strong>Server Machine</strong>.</li> <li>Configure your <strong>Server Machine</strong> hostname to the same name (e.g. <code>mqtt.myorg.com</code>).</li> </ul> <p>In all cases, check these Tasmota guidelines about <a href=../Securing-your-IoT-from-hacking/ >Securing your IoT</a>.</p> <h3 id=5-install-and-configure-mosquitto-on-your-server>5. Install and configure Mosquitto on your server<a class=headerlink href=#5-install-and-configure-mosquitto-on-your-server title="Permanent link">~</a></h3> <p>Install Mosquitto</p> <h4 id=linux>Linux<a class=headerlink href=#linux title="Permanent link">~</a></h4> <div class=highlight><pre><span></span><code>sudo apt-get install Mosquitto
</code></pre></div> <h4 id=windows>Windows<a class=headerlink href=#windows title="Permanent link">~</a></h4> <p>Download and run the Windows installer from <code>https://www.mosquitto.org/</code>. Mosquitto may be installed either as a program or service. The main difference is in how mosquitto is started. As a program, it must be started by a user every time, but as a service it can be automatically started by the OS during boot.</p> <h4 id=51-configuration>5.1 Configuration<a class=headerlink href=#51-configuration title="Permanent link">~</a></h4> <p>Copy the files from <strong>CA Machine</strong> to the following locations on a Linux server machine:</p> <div class=highlight><pre><span></span><code>/etc/mosquitto/ca_certificates/ca.crt
/etc/mosquitto/certs/mqtt.myorg.com.crt
/etc/mosquitto/certs/mqtt.myorg.com.key
</code></pre></div> <p>and to here on a Windows server machine (requires Administrative privileges):</p> <p><div class=highlight><pre><span></span><code>C:\Program Files\mosquitto\ca.crt
C:\Program Files\mosquitto\mqtt.myorg.com.crt
C:\Program Files\mosquitto\mqtt.myorg.com.key
</code></pre></div> On Windows, if preferred, one or two subdirectories within the mosquitto installation directory can be created to hold the certificates. That might make it easier to restrict access to a private key in plain text form.</p> <p>There are two options for configuring the server's private key. It can be converted to plain text form (<code>.pem</code>) as shown below, or left encrypted (<code>.key</code>). If left encrypted, the password will need to be entered by hand every time the server is started. This will not be feasible if mosquitto is to be run as a service. Security risks can be minimzed by setting tight permissions on the files, as shown below.</p> <p>Convert the private key to plain text format like this:</p> <p><code>openssl rsa -in mqtt.myorg.com.key -out mqtt.myorg.com.pem</code></p> <h4 id=file-permissions-linux>File Permissions: Linux<a class=headerlink href=#file-permissions-linux title="Permanent link">~</a></h4> <p>Ensure the files have owner <code>mosquitto:mosquitto</code> and permissions <code>-r--------</code>. Also ensure <code>ca_certificates</code> and <code>certs</code> directories have owner <code>mosquitto:mosquitto</code> and permissions <code>dr-x------</code>.</p> <h4 id=file-permissions-windows>File Permissions: Windows<a class=headerlink href=#file-permissions-windows title="Permanent link">~</a></h4> <p>It should be possible to configure permissions so that only the <code>SYSTEM</code> user can read the private key file, and when mosquitto is run as a service, it runs under the <code>SYSTEM</code> account. How to do this is currently beyond the scope of this guide.</p> <h4 id=53-configure-and-start-the-server>5.3 Configure and start the server<a class=headerlink href=#53-configure-and-start-the-server title="Permanent link">~</a></h4> <p>Edit <code>/etc/mosquitto/conf.d/default.conf</code> as following: <div class=highlight><pre><span></span><code>protocol mqtt
allow_anonymous false
listener 8884
socket_domain ipv4
# Certs and Keys
cafile /etc/mosquitto/ca_certificates/ca.crt
certfile /etc/mosquitto/certs/mqtt.myorg.com.crt
keyfile /etc/mosquitto/certs/mqtt.myorg.com.pem
require_certificate true
use_identity_as_username true
</code></pre></div></p> <p>On a Windows machine, the configuration file is <code>C:\Program Files\mosquitto\mosquitto.conf</code>, and the paths to the certificate and key files should be set accordingly using standard Windows path syntax.</p> <p>To start Mosquitto on Linux:</p> <div class=highlight><pre><span></span><code>sudo service mosquitto Start
</code></pre></div> <p>To start Mosquitto on Windows, either use the services snap-in (<code>services.msc</code>), or from an Administrator command prompt:</p> <div class=highlight><pre><span></span><code>net start mosquitto
</code></pre></div> <h3 id=6-generate-and-configure-certificates-for-your-devices>6. - Generate and configure certificates for your devices<a class=headerlink href=#6-generate-and-configure-certificates-for-your-devices title="Permanent link">~</a></h3> <p>!!! failure "Repeated step" Repeat the following 6.x steps once for every device, changing tasmota_name for each device. You will be prompted for a private key password for each device. After entering the new password (twice for verification), you will also be prompted for the private key password of the root CA certificate.</p> <h4 id=61-generate-the-client-certificates>6.1 Generate the client certificates<a class=headerlink href=#61-generate-the-client-certificates title="Permanent link">~</a></h4> <div class=highlight><pre><span></span><code>export TAS=tasmota_name
# Request tasmota certs (will ask for password)
./easyrsa gen-req $TAS
# Sign certificate for Tasmota
./easyrsa sign-req tasmota $TAS
</code></pre></div> <h4 id=62-convert-certificate-keys-to-tasmota-compatible-format>6.2 Convert certificate keys to Tasmota compatible format<a class=headerlink href=#62-convert-certificate-keys-to-tasmota-compatible-format title="Permanent link">~</a></h4> <p>The new certificate must be converted to Tasmota commands which can be entered into the device's web console. Credentials are composed of two distinct parts:</p> <ul> <li>Private Key - this is the secret that will allow your device to prove its identity, and consists of 32 bytes (256 bits). Consider this as sensitive as a password.</li> <li>Public Key - this allows others to encrypt messages which can only be decrypted with the Private Key, and contains 256 bytes (2048 bits).</li> </ul> <p>Both of these must be loaded into flash in the Tasmota device. This is done by entering <code>TLSKey</code> commands in the device's web console. </p> <p>This step must be performed on the machine where the device certificates were created, from within the <code>easyrsa3</code> directory. The following commands will generate a shell script, <code>gen-tlskeys</code>, which will perform the necessary work.</p> <div class=highlight><pre><span></span><code>cat &gt;gen-tlskeys &lt;&lt;&#39;EOF&#39;
# Decrypt private key (will ask for a password), then extract TLSKey1 (private) and TLSKey2 (public) values
if [ &quot;$#&quot; -ne 1 ] ; then
    echo &quot;Usage: gen-tasmota-cert &lt;device-certificate-name&gt;&quot;
    exit 1
fi
if [ ! -f pki/private/$1.key ] ; then
    echo &quot;Could not find private key file pki/private/$1.key&quot;
    exit 1
fi
if [ ! -f pki/issued/$1.crt ] ; then
    echo &quot;Could not find public key file pki/issued/$1.crt&quot;
    exit 1
fi
openssl ec -in ./pki/private/$1.key -outform PEM | \
openssl ec -inform PEM -outform DER | openssl asn1parse -inform DER | \
head -3 | tail -1 | awk -F&#39;:&#39; &#39;{ print $4 }&#39; | xxd -r -p | base64 | \
echo -e &quot;----\n\nCopy the following commands and paste them into the device&#39;s web console\n\n---\n\nTLSKey1 $(&lt;/dev/stdin)&quot; &amp;&amp; \
openssl x509 -in ./pki/issued/$1.crt -inform PEM -outform DER | \
openssl base64 -e -in - -A|echo -e &quot;\n\nTlskey2 $(&lt;/dev/stdin)&quot;
EOF
chmod 755 gen-tlskeys
</code></pre></div> <p>Now, for each device, simply enter this command. As above, the variable (<code>$TAS</code>) is set to the name of the device's certificate. Output will consist of two Tasmota device commands printed to the terminal window; these must be copied and pasted into the device's web console.</p> <div class=highlight><pre><span></span><code>./gen-tlskeys $TAS
</code></pre></div> <p>The <code>TLSKey1</code> command contains the device's private key in plain text (unencrypted) format, so don't keep it around any longer than necessary.</p> <h4 id=63-access-your-devices-web-console-and-configure-the-keys>6.3 Access your device's web console and configure the keys.<a class=headerlink href=#63-access-your-devices-web-console-and-configure-the-keys title="Permanent link">~</a></h4> <p>Run the <code>TLSKey1</code> and <code>TLSKey2</code> commands as obtained in the previous output. Open each of the files, copy the text and paste it into the web console.</p> <h4 id=64-verify-the-device-is-connecting-as-expected>6.4 Verify the device is connecting as expected.<a class=headerlink href=#64-verify-the-device-is-connecting-as-expected title="Permanent link">~</a></h4> <h2 id=building-bearssl-on-windows-machines>Building BearSSL on Windows machines<a class=headerlink href=#building-bearssl-on-windows-machines title="Permanent link">~</a></h2> <p>This can be a challenging task, and a method to accomplish this through Cygwin is described here. </p> <p>Here are the issues that need to be fixed before BearSSL will build under Cygwin. Many of them are related to the differences between Windows and Linux when it comes to programming socket I/O. - Commands for compiling and linking are <code>gcc</code>, not <code>cc</code> - Additional compiler flags are required to compile and link socket I/O code - A Windows socket library (<code>libws2_32</code>) must be included in the link edit step when building the brssl executable - A local implementation of a missing function (<code>inet_ntop</code>) must be added to the build</p> <p>The current git master branch of BearSSL is required -- the 0.6 version available as a gzipped tar archive will not work. An up-to-date version of gcc in Cygwin is also required -- old versions may experience an internal compiler error when building BearSSL.</p> <p>Start by installing Cygwin, selecting the <code>gcc</code> and <code>make</code> packages in the <code>Devel</code> category, and the <code>openssl</code> package in the <code>Net</code> category.</p> <p>Open a Cygwin terminal window and change to the directory where BearSSL source was cloned. To access a Windows letter drive such as <code>F:\somepath</code> in Cygwin, use the path <code>/cygdrive/f/somepath</code>. </p> <p>All of the necessary patches are easily made by copying and pasting this set of commands into the Cygwin terminal window. This will create files needed to patch the BearSSL build. First, change to the top level BearSSL directory in the Cytwin window. After selecting the text in the window below, click in the Cygwin window and hit Control-Insert to paste, or right-click in the window and select Paste from the drop-down menu. You may need to hit Enter after doing this.</p> <div class=highlight><pre><span></span><code>cat &gt;edit-Unix-mk.sed &lt;&lt;&#39;EOF&#39;
1 a \# Modified for building on Cygwin systems
/^CC.*=.*cc/ c \CC = gcc
/^LDDLL.*=.*cc/ c \LDDLL = gcc
/^LD.*=.*cc/ c \LD = gcc
/^CFLAGS.*=/ s/-fPIC/-DWINVER=0x0501 -DEWOULDBLOCK=EAGAIN/
/^LDOUT.*=/ a \BRSSL_EXT_LIBS = -lws2_32
EOF

cat &gt;extraTargets &lt;&lt;&#39;EOF&#39;

$(OBJDIR)$Pinet_ntop$O: tools$Pinet_ntop.c $(HEADERSTOOLS)
    $(CC) $(CFLAGS) $(INCFLAGS) $(CCOUT)$(OBJDIR)$Pinet_ntop$O tools$Pinet_ntop.c

$(BRSSL): $(BEARSSLLIB) $(OBJBRSSL)
    $(LD) $(LDFLAGS) $(LDOUT)$(BRSSL) $(OBJBRSSL) $(BEARSSLLIB) $(BRSSL_EXT_LIBS)
EOF

cat &gt;tools/inet_ntop.c &lt;&lt;&#39;EOF&#39;
#ifdef _WIN32
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdint.h&gt;
#include &lt;errno.h&gt;
#include &lt;signal.h&gt;
#include &lt;winsock2.h&gt;
#include &lt;ws2tcpip.h&gt;
const char *inet_ntop(int af, const void *src, char *dst, int cnt)
{
        if (af == AF_INET)
        {
                struct sockaddr_in in;
                memset(&amp;in, 0, sizeof(in));
                in.sin_family = AF_INET;
                memcpy(&amp;in.sin_addr, src, sizeof(struct in_addr));
                getnameinfo((struct sockaddr *)&amp;in, sizeof(struct
sockaddr_in), dst, cnt, NULL, 0, NI_NUMERICHOST);
                return dst;
        }
        else if (af == AF_INET6)
        {
                struct sockaddr_in6 in;
                memset(&amp;in, 0, sizeof(in));
                in.sin6_family = AF_INET6;
                memcpy(&amp;in.sin6_addr, src, sizeof(struct in_addr6));
                getnameinfo((struct sockaddr *)&amp;in, sizeof(struct
sockaddr_in6), dst, cnt, NULL, 0, NI_NUMERICHOST);
                return dst;
        }
        return NULL;
}
#endif
EOF

cat &gt;patch-bearssl &lt;&lt;&#39;EOF&#39;
sed -f edit-Unix-mk.sed conf/Unix.mk &gt;conf/Cygwin.mk
sed -e &#39;/^OBJBRSSL = / a \ $(OBJDIR)$Pinet_ntop$O \\&#39; mk/Rules.mk &gt;Rules.tmp
cat Rules.tmp extraTargets &gt;mk/Rules.mk
rm -f Rules.tmp
cp -f tools/brssl.h brssl.tmp
sed -e &#39;/^#include.*bearssl\.h/ a \const char *inet_ntop(int,const void*,char*,int);&#39; brssl.tmp &gt;tools/brssl.h
rm -f brssl.tmp
EOF
chmod 755 patch-bearssl
</code></pre></div> <p>Check to make sure that the file <code>extraTargets</code> contains a leading tab character, not spaces on the <code>$(CC)</code> and <code>$(LD)</code> lines. Executing the following commands should get the job done:</p> <div class=highlight><pre><span></span><code>./patch-bearssl
make tools CONF=Cygwin
</code></pre></div> <p>The resulting <code>brssl.exe</code> file will be found in the <code>build</code> directory, and should be copied to the top level EasyRSA directory.</p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.4b2c34cd.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>