<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/Sensor-API/ rel=canonical><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.12"><title>Sensor API - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8J08F8X90S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#important-things-to-consider class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Sensor API </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> Firmware Builds </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog Pin </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> ArtNet DMX </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> IPv6 </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting Language </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_18> <label class=md-nav__link for=__nav_2_18 id=__nav_2_18_label tabindex=0> Protocol Bridging <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_18_label aria-expanded=false> <label class=md-nav__title for=__nav_2_18> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> Arduino MCU </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> BLE Gateway </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> LCD/DLP Projector Control </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> Modbus Bridge </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> Thermostat </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> Universal File System </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> Wi-Fi Range Extender </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> ESP32 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> Tasmota32 Features </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> Berry </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> Bluetooth Low Energy </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> I2S Audio </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> LVGL </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> HASPmota </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> Tasmota Application Files </a> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> Touch GPIOs </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> Safeboot Partition Layout </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> Supported Devices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> Tasmohab </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> Web Installer </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#important-things-to-consider class=md-nav__link> Important things to consider </a> </li> <li class=md-nav__item> <a href=#managing-a-forked-branch class=md-nav__link> Managing a Forked Branch </a> </li> <li class=md-nav__item> <a href=#directoryfile-structure class=md-nav__link> Directory/file structure </a> </li> <li class=md-nav__item> <a href=#api-structure class=md-nav__link> API structure </a> <nav class=md-nav aria-label="API structure"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-processor-directives class=md-nav__link> Pre-processor directives </a> </li> <li class=md-nav__item> <a href=#callback-function class=md-nav__link> Callback function </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#callback-ids class=md-nav__link> Callback IDs </a> </li> <li class=md-nav__item> <a href=#useful-functions class=md-nav__link> Useful functions </a> <nav class=md-nav aria-label="Useful functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mqtt class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> Logging </a> </li> <li class=md-nav__item> <a href=#i2c-interface class=md-nav__link> I2C Interface </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-pre-processor-directives class=md-nav__link> Useful pre-processor directives </a> </li> <li class=md-nav__item> <a href=#keeping-esp8266-code-compact class=md-nav__link> Keeping ESP8266 code compact </a> <nav class=md-nav aria-label="Keeping ESP8266 code compact"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#about-esp8266 class=md-nav__link> About ESP8266 </a> </li> <li class=md-nav__item> <a href=#first-example class=md-nav__link> First example </a> </li> <li class=md-nav__item> <a href=#uint8_t-or-uint32_t class=md-nav__link> uint8_t or uint32_t ? </a> </li> <li class=md-nav__item> <a href=#loops class=md-nav__link> Loops </a> </li> <li class=md-nav__item> <a href=#floats-not-doubles class=md-nav__link> Floats, not doubles! </a> </li> <li class=md-nav__item> <a href=#string-concatenation class=md-nav__link> String concatenation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#extension-to-vsnprintf class=md-nav__link> Extension to (v)snprintf() </a> <nav class=md-nav aria-label="Extension to (v)snprintf()"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-use class=md-nav__link> How to use </a> </li> <li class=md-nav__item> <a href=#code-size-reduction class=md-nav__link> Code size reduction </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Sensor-API.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1>Sensor API</h1> <p>Tasmota sensor API documentation for sensor driver development.</p> <h2 id=important-things-to-consider>Important things to consider<a class=headerlink href=#important-things-to-consider title="Permanent link">~</a></h2> <ul> <li>There are several I<sup>2</sup>C sensor examples you can take from the development codebase when writing your own and you are encouraged to do this as it is a quick and easy way to see how things fit together.</li> <li>The Tasmota firmware is essentially intended for ESP8266/ESP8285 Wi-Fi SoC based devices and commits to the main development branch will be subject to review based on whether or not what you intend to develop or add to the existing code is relevant to the general ESP device users.</li> <li>That being said, there is a lot of development going into the firmware which extends the functionality of standard off the shelf Sonoff devices. The firmware in itself is also useful for boards such as the WeMos ESP82xx boards. More technically inclined individuals who use generic ESP82xx modules in their own circuits to provide more access to pins and the ability to add more sensors and hardware external to the device or the generic ESP82xx module circuits can also take advantage of Tasmota.</li> <li>The resources on the ESP82xx are finite. Most devices ship with 1MByte SPI flash which means for the generic device users, the code generally needs to be less than 502KBytes to ensure that OTA (Over The Air) flash functionality (which is the main reason why people use this firmware) remains available. RAM is also limited to an absolute maximum of 80KBytes. This memory is divided into heap (used by global variables and Strings) and stack (used by local variables) where stack space is just 4KBytes.</li> <li>Given the above resource constraints it's important to keep your code as small as possible, as fast running as possible, and use as little RAM as possible.</li> <li>You need to think about these resource constraints all the time whilst doing any development you wish to add to the firmware functionality - Face the fact that microcontroller development isn't as close a relative to standard computer programming as you'd expect.</li> <li>You will be adding code to an existing framework which requires you to adhere to some simple but strict rules such as not having any infinite loops like you would have in your generic Arduino code and try to avoid using the delay() functions when writing your code as this will cause the entire firmware to be subjected to the delays you have added - Infinite loops will cause the firmware to lock up completely!</li> <li>If your sensor has configuration options please make these available by using the <code>SensorXX</code> framework which is already incorporated in the base code - This may not stop you from using a web-based configuration interface but since web-based configuration takes up a lot of code space in flash it is very important to make this optional by means of a compiler directive or a #define in the configuration file and as such something you need to keep in mind during your development and debugging - The more progressively optional additional features are in your driver the smaller the basic codebase can be for minimalist implementations.</li> <li>Whilst developing drivers for devices that use the I<sup>2</sup>C bus always consider other devices already supported in the codebase which may use the same address range. This could mean you need to find a unique way of differentiating your device detection from other devices on the same address range (e.g. querying a model-specific register) and/or disabling by #undef existing devices if yours is selected with a #define statement and in such cases always provide a warning to the user during compile time using the #warning pragma such as including <code>#warning **** Turned off conflicting drivers SHT and VEML6070 ****</code> in your code.</li> <li>DO NOT ADD WEB INTERFACE FOR SENSOR CONFIGURATION if your sensor requires additional user configuration. The reason for this is the additional program memory required but most importantly the amount of RAM required to even create minimal user interfaces. Running out of RAM during runtime will lead to abnormal behaviour of your driver and/or other drivers or the entire firmware! See sensors such as the MCP23008/MCP23017 driver on more information on how to implement <code>SensorXX</code> commands instead!</li> <li>While developing you might want to enable additional debugging provided by file <code>xdrv_99_debug.ino</code> using <code>#define USE_DEBUG_DRIVER</code> which provides some commands for managing configuration settings and CPU timing. In addition you can enable define <code>PROFILE_XSNS_SENSOR_EVERY_SECOND</code> to profile your drivers duration.</li> <li>Do not assume others will know immediately how to use your addition and know that you will need to write a Wiki for it in the end.</li> </ul> <h2 id=managing-a-forked-branch>Managing a Forked Branch<a class=headerlink href=#managing-a-forked-branch title="Permanent link">~</a></h2> <p>If you plan to submit a PR bigger than a simple change in one file, here is a short intro about how to do a clean PR.</p> <ul> <li>fork the Tasmota repository in Github</li> <li><code>git clone https://github.com/&lt;github_user&gt;/Tasmota.git</code> and work on your local copy</li> <li><code>git remote add upstream https://github.com/arendst/Tasmota.git</code></li> <li><code>git checkout development</code></li> <li><code>git checkout -b &lt;temp_branch&gt;</code> to create a working branch where you can push commits</li> <li><code>git push --set-upstream origin &lt;temp_branch&gt;</code></li> <li>work on your local version and push as many commits as you want</li> </ul> <p>When you think it is ready to merge and submit a PR:</p> <ul> <li><code>git checkout development</code> to go back to the main branch</li> <li><code>git pull upstream development</code> to update all the latest changes</li> <li><code>git push</code> to update your fork</li> <li><code>git checkout -b &lt;pr_branch&gt;</code> to create a new branch for the final PR</li> <li><code>git push --set-upstream origin &lt;pr_branch&gt;</code></li> <li>Merge the edits but be sure to remove the history of your local commits</li> <li><code>git merge --squash &lt;temp_branch&gt;</code></li> <li><code>git commit -m "Message"</code></li> </ul> <p>Now you have a clean single commit from which you can create the PR on the Tasmota Github.</p> <h2 id=directoryfile-structure>Directory/file structure<a class=headerlink href=#directoryfile-structure title="Permanent link">~</a></h2> <p>Sensor libraries are located in the <code>lib/</code> directory. Sensor drivers are located in the <code>tasmota/</code> directory. The filename of the sensor driver is <code>xsns_&lt;driver_ID&gt;_&lt;driver_name&gt;.ino</code>, e.g. <code>xsns_05_ds18b20.ino</code> where <code>&lt;driver_ID&gt;</code> is a <em>unique</em> number between 01 and 90 and <code>&lt;driver_name&gt;</code> is a human-readable name of the driver.</p> <p>Using generic libraries from external sources for sensors should be avoided as far as possible as they usually include code for other platforms and are not always written in an optimized way.</p> <h2 id=api-structure>API structure<a class=headerlink href=#api-structure title="Permanent link">~</a></h2> <h3 id=pre-processor-directives>Pre-processor directives<a class=headerlink href=#pre-processor-directives title="Permanent link">~</a></h3> <p>Conditional compiling of a sensor driver is achieved by adding a pre-processor directive of the scheme <code>USE_&lt;driver_name&gt;</code> in <code>my_user_config.h</code>. Accordingly the driver code has to be wrapped in <code>#ifdef USE_&lt;driver_name&gt; ... #endif // USE_&lt;driver_name&gt;</code>. Any Sensor driver must contain a pre-processor directive defining the driver ID by the scheme <code>#define XSNS_&lt;driver_ID&gt;</code>.</p> <h3 id=callback-function>Callback function<a class=headerlink href=#callback-function title="Permanent link">~</a></h3> <p>Any sensor driver needs a callback function following the scheme <div class=highlight><pre><span></span><code><span class=c1>// Conditional compilation of driver</span>
<span class=cp>#ifdef USE_&lt;driver_name&gt;</span>

<span class=c1>// Define driver ID</span>
<span class=cp>#define XSNS_&lt;driver_ID&gt;  &lt;driver_ID&gt;</span>

<span class=cm>/**</span>
<span class=cm> * The callback function Xsns&lt;driver_ID&gt;() interfaces Tasmota with the sensor driver.</span>
<span class=cm> *</span>
<span class=cm> * It provides the Tasmota callback IDs.</span>
<span class=cm> *</span>
<span class=cm> * @param   byte    callback_id  Tasmota function ID.</span>
<span class=cm> * @return  boolean              Return value.</span>
<span class=cm> * @pre     None.</span>
<span class=cm> * @post    None.</span>
<span class=cm> *</span>
<span class=cm> */</span>
<span class=n>boolean</span><span class=w> </span><span class=n>Xsns</span><span class=o>&lt;</span><span class=n>driverID</span><span class=o>&gt;</span><span class=p>(</span><span class=n>byte</span><span class=w> </span><span class=n>callback_id</span><span class=p>)</span><span class=w> </span><span class=p>{</span>

<span class=w>  </span><span class=c1>// Set return value to `false`</span>
<span class=w>  </span><span class=n>boolean</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// Check if I2C interface mode</span>
<span class=c1>// if(i2c_flg) {</span>

<span class=w>  </span><span class=c1>// Check which callback ID is called by Tasmota</span>
<span class=w>  </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>callback_id</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_INIT</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_EVERY_50_MSECOND</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_EVERY_SECOND</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_JSON_APPEND</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=cp>#ifdef USE_WEBSERVER</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_WEB_APPEND</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=cp>#endif </span><span class=c1>// USE_WEBSERVER</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_SAVE_BEFORE_RESTART</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_COMMAND</span><span class=p>:</span>
<span class=w>      </span><span class=k>break</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=c1>// } // if(i2c_flg)</span>

<span class=w>  </span><span class=c1>// Return boolean result</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
<span class=cp>#endif </span><span class=c1>// USE_&lt;driver_name&gt;</span>
</code></pre></div></p> <h2 id=callback-ids>Callback IDs<a class=headerlink href=#callback-ids title="Permanent link">~</a></h2> <p><code>FUNC_INIT</code></p> <p>This callback ID is called when sensor drivers should be initialized.</p> <p><code>FUNC_EVERY_50_MSECOND</code></p> <p>This callback ID is called every 50 milliseconds, e.g. for near real-time operation</p> <p><code>FUNC_EVERY_SECOND</code></p> <p>This callback ID is called every second.</p> <p>It can be useful for anything that you need to do on a per second basis and is commonly used as an entry point to detect a driver or initialize an externally driven device such as a sensor, relay board or other forms of input/output required by your driver.</p> <p>You would normally want to make sure you've detected and initialised before it is used by <code>JSON_APPEND</code>, etc. so that it's ready to serve data.</p> <p>The generally accepted way to use this would be to detect your sensor and once this is done set a sensor value accordingly so that the function does not use unnecessary resources during future calls, for example: <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=nf>MySensorDetect</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>MySensorDetected</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
<span class=w>  </span><span class=cm>/*</span>
<span class=cm>   * Perform the code which needs to be completed to</span>
<span class=cm>   * detect your sensor and then set MySensorDetected to</span>
<span class=cm>   * a non-zero value which will prevent this section</span>
<span class=cm>   * of your code to re-run every time the function is</span>
<span class=cm>   * called.</span>
<span class=cm>   * </span>
<span class=cm>   * Under normal circumstances you&#39;d not need to do</span>
<span class=cm>   * re-detect or initialise your sensor once it has been</span>
<span class=cm>   * done</span>
<span class=cm>   */</span>
<span class=p>}</span>
</code></pre></div></p> <p>Setting a flag that the driver was successful in detecting the attached chip/board via I<sup>2</sup>C or SPI will prevent it from continuously trying to initialize an already initialized device.</p> <p>When writing your function responsible for detecting an externally connected I<sup>2</sup>C device try to create a method by which you read or write to specific registers that would be applicable to that specific I<sup>2</sup>C device only as to confirm a positive detect for the device. If this is not done extensively it will lead to some drivers getting false detects for a different device type simply because it shares the same I<sup>2</sup>C address.</p> <p>Unless your driver is specifically going to use the entire array of addresses provisioned by the manufacturer please consider using a <code>#define USE_MYCHIPNAME_ADDR</code> in the <code>my_user_config.h</code> so that the user may specify the address on which to expect the device. This is of course only applicable to drivers that are not enabled by default in any of the pre-built binaries.</p> <p><strong>I<sup>2</sup>C address auto-detection example</strong> <div class=highlight><pre><span></span><code><span class=cp>#define MPR121_I2C_ADDR_1ST  0x5A    </span><span class=cm>/** 1st I2C address of sensor model **/</span>
<span class=cp>#define MPR121_I2C_ADDR_NUM  4       </span><span class=cm>/** Number of sensors/I2C addresses **/</span>
<span class=cp>#define MPR121_I2C_ID_REG    0x5D    </span><span class=cm>/** Sensor model specific ID register **/</span>
<span class=cp>#define MPR121_I2C_ID_VAL    0x24    </span><span class=cm>/** Sensor model specific ID register value **/</span>

<span class=cm>/* Sensor data struct type declaration/default definition */</span>
<span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>connected</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span><span class=w>     </span><span class=cm>/** Status if sensor is connected at I2C address */</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>running</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span><span class=w>     </span><span class=cm>/** Running state of sensor */</span>
<span class=w>        </span><span class=p>.</span>
<span class=w>        </span><span class=p>.</span>
<span class=w>        </span><span class=p>.</span>
<span class=p>}</span><span class=w> </span><span class=n>mpr121</span><span class=p>;</span>

<span class=c1>// Declare array of sensor data structs</span>
<span class=n>mpr121</span><span class=w> </span><span class=n>mpr121</span><span class=p>[</span><span class=n>MPR121_I2C_ADDR_NUM</span><span class=p>];</span>

<span class=c1>// Sensor specific init function</span>
<span class=kt>void</span><span class=w> </span><span class=nf>mpr121_init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>anyConnected</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// Loop through I2C addresses</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>MPR121_I2C_ADDR_NUM</span><span class=p>);</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>

<span class=w>        </span><span class=c1>// Check if sensor is connected on I2C address</span>
<span class=w>        </span><span class=n>mpr121</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>connected</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>MPR121_I2C_ID_VAL</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>I2cRead8</span><span class=p>(</span><span class=n>MPR121_I2C_ADDR_1ST</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>MPR121_I2C_ID_REG</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>mpr121</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>connected</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>anyConnected</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>

<span class=w>            </span><span class=c1>// Log sensor found</span>
<span class=w>            </span><span class=n>snprintf_P</span><span class=p>(</span><span class=n>log_data</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>log_data</span><span class=p>),</span><span class=w> </span><span class=n>PSTR</span><span class=p>(</span><span class=n>D_LOG_I2C</span><span class=w> </span><span class=s>&quot;MPR121-%d &quot;</span><span class=w> </span><span class=n>D_FOUND_AT</span><span class=w> </span><span class=s>&quot; 0x%X&quot;</span><span class=p>),</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>MPR121_I2C_ADDR_1ST</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>            </span><span class=n>AddLog</span><span class=p>(</span><span class=n>LOG_LEVEL_INFO</span><span class=p>);</span>

<span class=w>            </span><span class=c1>// Initialize sensor</span>
<span class=w>            </span><span class=p>.</span>
<span class=w>            </span><span class=p>.</span>
<span class=w>            </span><span class=p>.</span>

<span class=w>            </span><span class=c1>// Set running to true</span>
<span class=w>            </span><span class=n>mpr121</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>running</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>anyConnected</span><span class=p>){</span>
<span class=w>        </span><span class=n>snprintf_P</span><span class=p>(</span><span class=n>log_data</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>log_data</span><span class=p>),</span><span class=w> </span><span class=n>PSTR</span><span class=p>(</span><span class=n>D_LOG_I2C</span><span class=w> </span><span class=s>&quot;MPR121: No sensors found&quot;</span><span class=p>));</span>
<span class=w>        </span><span class=n>AddLog</span><span class=p>(</span><span class=n>LOG_LEVEL_INFO</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></p> <p><strong>Four advanced methods to use <code>FUNC_EVERY_SECOND</code> (Food for thought) :</strong></p> <ul> <li>If a sensor needs an action which takes a long time, like more than 100mS, the action will be started here for a future follow-up. Using the uptime variable for testing like (uptime &amp;1) will happen every 2 seconds. An example is the DS18B20 driver where readings (conversions they call it) can take up to 800mS from the initial request.</li> <li>If a sensor needed the previous action it is now time to gather the information and store it in a safe place to be used by <code>FUNC_JSON_APPEND</code> and/or <code>FUNC_WEB_APPEND</code>. Using the else function of the previous test (uptime &amp;1) will happen every 2 seconds too but just 1 second later than the previous action.</li> <li>If a sensor does not respond for 10 times the sensor detection flag could be reset which will stop further processing until the sensor is re-detected. This is currently not being used actively as some users complain about disappearing sensors for whatever reason - Could be hardware related but easier to make Tasmota a little more flexible.</li> <li>Making re-detection of a sensor possible by executing this once every 100 seconds (94 == (uptime %100)) a re-attached sensor can be detected without a restart of Tasmota. The 94 given in this example should be different for every sensor driver to make sure not all sensors start detection at the same time. Using the drivers index number should be a good starting point.</li> </ul> <p><code>FUNC_PREP_BEFORE_TELEPERIOD</code></p> <p>NOTE: This callback ID is deprecated as sensors should prepare for more regular updates due to "realtime" rule execution. Use <code>FUNC_EVERY_SECOND</code> instead. See examples used in xsns_05_ds18x20.ino and xsns_09_bmp.ino where updated sensor data is stored in preparation to calls to FUNC_JSON_APPEND and FUNC_WEB_APPEND.</p> <p><code>FUNC_JSON_APPEND</code></p> <p>This callback ID is called when <a href=../Commands/#teleperiod><code>TelePeriod</code></a> is due to append telemetry data to the MQTT JSON string or at approximately every 2 seconds when a rule is checked, e.g. <div class=highlight><pre><span></span><code><span class=n>snprintf_P</span><span class=p>(</span><span class=n>mqtt_data</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>mqtt_data</span><span class=p>),</span><span class=w> </span><span class=n>PSTR</span><span class=p>(</span><span class=s>&quot;{</span><span class=se>\&quot;</span><span class=s>MPR121%c</span><span class=se>\&quot;</span><span class=s>:{</span><span class=se>\&quot;</span><span class=s>Button%i</span><span class=se>\&quot;</span><span class=s>:%i}}&quot;</span><span class=p>),</span><span class=w> </span><span class=n>pS</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>j</span><span class=p>,</span><span class=w> </span><span class=n>BITC</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>));</span>
</code></pre></div></p> <p><code>FUNC_WEB_APPEND</code></p> <p>This callback ID is called every <webrefresh> millisecond when HTML code should be added to the Tasmota web-interface main page, e.g., <div class=highlight><pre><span></span><code><span class=n>snprintf_P</span><span class=p>(</span><span class=n>mqtt_data</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>mqtt_data</span><span class=p>),</span><span class=w> </span><span class=n>PSTR</span><span class=p>(</span><span class=s>&quot;%s{s}MPR121%c Button%d{m}%d{e}&quot;</span><span class=p>),</span><span class=w> </span><span class=n>mqtt_data</span><span class=p>,</span><span class=w> </span><span class=n>pS</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>j</span><span class=p>,</span><span class=w> </span><span class=n>BITC</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>));</span>
</code></pre></div> It should be wrapped in <code>#ifdef USE_WEBSERVER ... #endif // USE_WEBSERVER</code></p> <p><code>FUNC_SAVE_BEFORE_RESTART</code></p> <p>This callback ID is called to allow a sensor to prepare for saving configuration changes. To be used to save volatile data just before a restart. Variables can be appended to <code>struct SYSCFG {} Settings</code> in file <code>tasmota/settings.h</code>.</p> <p><code>FUNC_COMMAND</code></p> <p>This callback ID is called when a sensor specific command <code>Sensor&lt;xx&gt;</code> or <code>Driver&lt;xx&gt;</code> is executed where xx is the sensor index. <div class=highlight><pre><span></span><code><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=no>FUNC_COMMAND</span><span class=p>:</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>XSNS_</span><span class=o>&lt;</span><span class=n>driver_ID</span><span class=o>&gt;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>XdrvMailbox</span><span class=p>.</span><span class=n>index</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>               </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;</span><span class=n>driver_name</span><span class=o>&gt;</span><span class=n>Command</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>};</span><span class=w>  </span><span class=c1>// Return true on success</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// Data struct of FUNC_COMMAND ID</span>
<span class=k>struct</span><span class=w> </span><span class=nc>XDRVMAILBOX</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kt>uint16_t</span><span class=w>      </span><span class=n>valid</span><span class=p>;</span><span class=w>      </span><span class=c1>// ???</span>
<span class=w>  </span><span class=kt>uint16_t</span><span class=w>      </span><span class=n>index</span><span class=p>;</span><span class=w>      </span><span class=c1>// Sensor index</span>
<span class=w>  </span><span class=kt>uint16_t</span><span class=w>      </span><span class=n>data_len</span><span class=p>;</span><span class=w>   </span><span class=c1>// Length of command string</span>
<span class=w>  </span><span class=kt>uint16_t</span><span class=w>      </span><span class=n>payload16</span><span class=p>;</span><span class=w>  </span><span class=c1>// 16 bit unsigned int of payload if it could be converted, otherwise 0</span>
<span class=w>  </span><span class=kt>int16_t</span><span class=w>       </span><span class=n>payload</span><span class=p>;</span><span class=w>    </span><span class=c1>// 16 bit signed int of payload if it could be converted, otherwise 0</span>
<span class=w>  </span><span class=kt>uint8_t</span><span class=w>       </span><span class=n>grpflg</span><span class=p>;</span><span class=w>     </span><span class=c1>// ???</span>
<span class=w>  </span><span class=kt>uint8_t</span><span class=w>       </span><span class=n>notused</span><span class=p>;</span><span class=w>    </span><span class=c1>// ???</span>
<span class=w>  </span><span class=kt>char</span><span class=w>         </span><span class=o>*</span><span class=n>topic</span><span class=p>;</span><span class=w>      </span><span class=c1>// Command topic</span>
<span class=w>  </span><span class=kt>char</span><span class=w>         </span><span class=o>*</span><span class=n>data</span><span class=p>;</span><span class=w>       </span><span class=c1>// Command string/value - length of which is defined by data_len</span>
<span class=p>}</span><span class=w> </span><span class=n>XdrvMailbox</span><span class=p>;</span>
</code></pre></div></p> <p>If your driver needs to accept multiple parameters for <code>SensorXX</code> and/or <code>DriverXX</code> please consider using comma delimited formatting and use the already written <code>subStr()</code> function declared in <code>support.ino</code> to parse through the parameters you need.</p> <p>An example of those could be <div class=highlight><pre><span></span><code><span class=n>SensorXX</span><span class=w> </span><span class=n>reset</span><span class=w> </span><span class=c1>// The reset parameter may be intercepted using:</span>
<span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>strcmp</span><span class=p>(</span><span class=n>subStr</span><span class=p>(</span><span class=n>sub_string</span><span class=p>,</span><span class=w> </span><span class=n>XdrvMailbox</span><span class=p>.</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=s>&quot;,&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=s>&quot;RESET&quot;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// Note 1 used for param number</span>
<span class=w>    </span><span class=n>MyDriverName_Reset</span><span class=p>();</span><span class=w> </span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>serviced</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> Or in the case of multiple parameters <div class=highlight><pre><span></span><code><span class=n>SensorXX</span><span class=w> </span><span class=n>mode</span><span class=p>,</span><span class=mi>1</span>
<span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>strcmp</span><span class=p>(</span><span class=n>subStr</span><span class=p>(</span><span class=n>sub_string</span><span class=p>,</span><span class=w> </span><span class=n>XdrvMailbox</span><span class=p>.</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=s>&quot;,&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=s>&quot;MODE&quot;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// Note 1 used for param number</span>
<span class=w>  </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>atoi</span><span class=p>(</span><span class=n>subStr</span><span class=p>(</span><span class=n>sub_string</span><span class=p>,</span><span class=w> </span><span class=n>XdrvMailbox</span><span class=p>.</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=s>&quot;,&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>  </span><span class=c1>// Note 2 used for param number</span>
<span class=p>}</span>
</code></pre></div></p> <h2 id=useful-functions>Useful functions<a class=headerlink href=#useful-functions title="Permanent link">~</a></h2> <h3 id=mqtt>MQTT<a class=headerlink href=#mqtt title="Permanent link">~</a></h3> <hr> <p><div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=n>MqttPublishPrefixTopic_P</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>prefix</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>subtopic</span><span class=p>,</span><span class=w> </span><span class=n>boolean</span><span class=w> </span><span class=n>retained</span><span class=p>)</span>
</code></pre></div> This function publishes MQTT messages immediately, e.g., <div class=highlight><pre><span></span><code><span class=n>snprintf_P</span><span class=p>(</span><span class=n>mqtt_data</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>mqtt_data</span><span class=p>),</span><span class=w> </span><span class=n>PSTR</span><span class=p>(</span><span class=s>&quot;{</span><span class=se>\&quot;</span><span class=s>MPR121%c</span><span class=se>\&quot;</span><span class=s>:{</span><span class=se>\&quot;</span><span class=s>Button%i</span><span class=se>\&quot;</span><span class=s>:%i}}&quot;</span><span class=p>),</span><span class=w> </span><span class=n>pS</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>j</span><span class=p>,</span><span class=w> </span><span class=n>BITC</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>));</span>
<span class=n>MqttPublishPrefixTopic_P</span><span class=p>(</span><span class=n>RESULT_OR_STAT</span><span class=p>,</span><span class=w> </span><span class=n>mqtt_data</span><span class=p>);</span>
</code></pre></div></p> <h3 id=logging>Logging<a class=headerlink href=#logging title="Permanent link">~</a></h3> <p><div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=n>AddLog</span><span class=p>(</span><span class=n>byte</span><span class=w> </span><span class=n>loglevel</span><span class=p>)</span>
</code></pre></div> This function adds log messages stored in <code>log_data</code> to the local logging system, e.g. <div class=highlight><pre><span></span><code><span class=n>snprintf_P</span><span class=p>(</span><span class=n>log_data</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>log_data</span><span class=p>),</span><span class=w> </span><span class=n>PSTR</span><span class=p>(</span><span class=n>D_LOG_I2C</span><span class=w> </span><span class=s>&quot;MPR121(%c) &quot;</span><span class=w> </span><span class=n>D_FOUND_AT</span><span class=w> </span><span class=s>&quot; 0x%X&quot;</span><span class=p>),</span><span class=w> </span><span class=n>pS</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>pS</span><span class=o>-&gt;</span><span class=n>i2c_addr</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
<span class=n>AddLog</span><span class=p>(</span><span class=n>LOG_LEVEL_INFO</span><span class=p>);</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=n>AddLogSerial</span><span class=p>(</span><span class=n>byte</span><span class=w> </span><span class=n>loglevel</span><span class=p>)</span>
</code></pre></div> This function adds a log message to the local logging system dumping the serial buffer as hex information, e.g. <div class=highlight><pre><span></span><code><span class=n>AddLogSerial</span><span class=p>(</span><span class=n>LOG_LEVEL_INFO</span><span class=p>);</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=n>AddLogMissed</span><span class=p>(</span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>sensor</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>misses</span><span class=p>)</span>
</code></pre></div> This function adds a log message to the local logging system about missed sensor reads.</p> <h3 id=i2c-interface>I<sup>2</sup>C Interface<a class=headerlink href=#i2c-interface title="Permanent link">~</a></h3> <p><div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidRead8</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidRead16</span><span class=p>(</span><span class=kt>uint16_t</span><span class=w> </span><span class=o>*</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidReadS16</span><span class=p>(</span><span class=kt>int16_t</span><span class=w> </span><span class=o>*</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidRead16LE</span><span class=p>(</span><span class=kt>uint16_t</span><span class=w> </span><span class=o>*</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidReadS16_LE</span><span class=p>(</span><span class=kt>int16_t</span><span class=w> </span><span class=o>*</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidRead24</span><span class=p>(</span><span class=kt>int32_t</span><span class=w> </span><span class=o>*</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cValidRead</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>size</span><span class=p>)</span>
</code></pre></div> These functions return <code>true</code> if 1, 2, 3 or <code>size</code> bytes can be read from the I<sup>2</sup>C address <code>addr</code> and register <code>reg</code> into <code>*data</code>. Functions with a <code>S</code> read signed data types while functions without a <code>S</code> read unsigned data types. Functions with LE read little-endian byte order while functions without LE read machine byte order.</p> <p><div class=highlight><pre><span></span><code><span class=kt>uint8_t</span><span class=w> </span><span class=n>I2cRead8</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>uint16_t</span><span class=w> </span><span class=n>I2cRead16</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>int16_t</span><span class=w> </span><span class=n>I2cReadS16</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>uint16_t</span><span class=w> </span><span class=n>I2cRead16LE</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>int16_t</span><span class=w> </span><span class=n>I2cReadS16_LE</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>int32_t</span><span class=w> </span><span class=n>I2cRead24</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>)</span>
</code></pre></div> These functions return 1, 2 or 3 bytes from the I<sup>2</sup>C address <code>addr</code> and register <code>reg</code>. Functions with a <code>S</code> read signed data types while functions without a <code>S</code> read unsigned data types. Functions with LE read little endian byte order while functions without LE read machine byte order.</p> <p><div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cWrite8</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>val</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cWrite16</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>,</span><span class=w> </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>val</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cWrite</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>,</span><span class=w> </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>val</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>size</span><span class=p>)</span>
</code></pre></div> These functions return true after successfully writing 1, 2 or <code>size</code> bytes to the I<sup>2</sup>C address <code>addr</code> and register <code>reg</code>.</p> <p><div class=highlight><pre><span></span><code><span class=kt>int8_t</span><span class=w> </span><span class=n>I2cReadBuffer</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=n>reg_data</span><span class=p>,</span><span class=w> </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>len</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kt>int8_t</span><span class=w> </span><span class=n>I2cWriteBuffer</span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>reg</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=n>reg_data</span><span class=p>,</span><span class=w> </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>len</span><span class=p>)</span>
</code></pre></div> These functions copy <code>len</code> bytes from/to <code>*reg_data</code> starting at I<sup>2</sup>C address <code>addr</code> and register <code>reg</code>.</p> <p><div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=n>I2cScan</span><span class=p>(</span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>devs</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>devs_len</span><span class=p>)</span>
</code></pre></div> This functions writes a list of I<sup>2</sup>C addresses in use into the string <code>*dev</code> with maximum length <code>devs_len</code>.</p> <p><div class=highlight><pre><span></span><code><span class=kt>bool</span><span class=w> </span><span class=n>I2cDevice</span><span class=p>(</span><span class=n>byte</span><span class=w> </span><span class=n>addr</span><span class=p>)</span>
</code></pre></div> This functions checks if the I<sup>2</sup>C address <code>addr</code> is in use.</p> <h2 id=useful-pre-processor-directives>Useful pre-processor directives<a class=headerlink href=#useful-pre-processor-directives title="Permanent link">~</a></h2> <p><code>PSTR("string")</code></p> <p>This pre-processor directive saves RAM by storing strings in flash instead of RAM.</p> <p><div class=highlight><pre><span></span><code><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=n>MyTextStaticVariable</span><span class=p>[]</span><span class=w> </span><span class=n>PROGMEM</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;string&quot;</span><span class=p>;</span>
</code></pre></div> This pre-processor directive saves RAM by storing strings in flash instead of RAM.</p> <p>You may then reference them directly (if the type matches the parameter required) or force it to 4 byte alignment by using the variable as <code>FPSTR(MyTextStaticVariable)</code></p> <h2 id=keeping-esp8266-code-compact>Keeping ESP8266 code compact<a class=headerlink href=#keeping-esp8266-code-compact title="Permanent link">~</a></h2> <p>Below are various tips and tricks to keep ESP8266 code compact and save both Flash and Memory. Flash code is limited to 1024k but keep in mind that to allow OTA upgrade, you need Flash memory to contain two firmwares at the same time. To go beyond 512k, you typically use <code>tasmota-minimal</code> as an intermediate firmware. <code>tasmota-minimal</code> takes roughly 360k, so it's safe not to go <code>uint32_t</code> beyond 620k of Flash. Memory is even more limited: 80k. With Arduino Core and basic Tasmota, there are 25k-30k left of heap space. Heap memory is very precious, running out of memory will generally cause a crash.</p> <h3 id=about-esp8266>About ESP8266<a class=headerlink href=#about-esp8266 title="Permanent link">~</a></h3> <p>ESP8266 is based on <a href=https://0x04.net/~mwk/doc/xtensa.pdf>Xtensa instruction set</a>. Xtensa is a 32 bits RISC processor core, containing 16 x 32 bits registers. ESP8266 supports integer operations, including 32x32 multiplication. It does not contain an FPU for floating point operations, nor integer divisions.</p> <p>Contrary to classical RISC processors, all instructions are 24 bits wide instead of 32 bits. To increase code compactness, some instructions have a 16 bits version used whenever possible by gcc.</p> <p>If you want to see what assembly is generated by gcc, in file <code>platform.ini</code>, at the section used to compile (ex: <code>[core_2_6_1]</code>) in section <code>build_flags</code> add:</p> <p><code>-save-temps=obj -fverbose-asm</code></p> <p>Gcc will store <code>&lt;file&gt;.s</code> in the same folder as the <code>.o</code> file, typically in <code>.pioenvs/</code>.</p> <h3 id=first-example>First example<a class=headerlink href=#first-example title="Permanent link">~</a></h3> <p>Let's take a basic function:</p> <div class=highlight><pre><span></span><code><span class=kt>uint32_t</span><span class=w> </span><span class=nf>Example</span><span class=p>(</span><span class=kt>uint32_t</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>b</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Below is the generated assembly. Function names are mangled using standard C++, i.e. their name derive from their arguments and return types:</p> <div class=highlight><pre><span></span><code><span class=nl>_Z7Examplejj:</span>
<span class=w>    </span><span class=nf>add.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w>  </span><span class=c1>#, a, b</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>As you can see, this is the simplest function we can think of. Register A2 holds the first argument and is used for return value. A3 holds the second argument.</p> <h3 id=uint8_t-or-uint32_t>uint8_t or uint32_t ?<a class=headerlink href=#uint8_t-or-uint32_t title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=kt>uint32_t</span><span class=w> </span><span class=nf>Example</span><span class=p>(</span><span class=kt>uint32_t</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>b</span><span class=p>;</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>c</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly:</p> <div class=highlight><pre><span></span><code><span class=nl>_Z7Examplejj:</span>
<span class=w>    </span><span class=nf>add.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w>  </span><span class=c1># tmp52, a, b</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>    </span><span class=c1>#, tmp52</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>Whenever gcc needs to convert from <code>uin32_t</code> to <code>uint8_t</code>, it uses an extra instruction <code>extui &lt;reg&gt;, &lt;reg&gt;, 0, 8</code>.</p> <p>Whenever you allocate <code>uint8_t</code> as a local variable, it will anyways allocate 32 bits on the stack.</p> <p>In conclusion you can easily use <code>uint32_t</code> in many places in the code. The main reason to force <code>uint8_t</code> are:</p> <ul> <li>in structures, to save memory. This is the only place where <code>uint8_t</code> will take 1 byte and the compiler will try to pack as much as 4 <code>uint8_t</code> in 32 bits</li> <li>when you want to ensure that the value can never exceed 255. Beware though that the compiler will just chunk the last 8 bits of a 32 bits value and will not report any overflow.</li> </ul> <h3 id=loops>Loops<a class=headerlink href=#loops title="Permanent link">~</a></h3> <p>Should you use <code>uint8_t</code> or <code>uint32_t</code> for loops?</p> <p>Let's try:</p> <div class=highlight><pre><span></span><code><span class=kt>uint32_t</span><span class=w> </span><span class=nf>Example</span><span class=p>(</span><span class=kt>uint32_t</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>a</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>b</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>uint32_t</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>a</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>b</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>a</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly:</p> <div class=highlight><pre><span></span><code><span class=nl>_Z7Examplejj:</span>
<span class=w>    </span><span class=nf>movi.n</span><span class=w>  </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=c1># ivtmp$7334,                     &lt;- loop 1</span>
<span class=nl>.L2031:</span>
<span class=w>    </span><span class=nf>add.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w>  </span><span class=c1># a, a, ivtmp$7334</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w>   </span><span class=c1># ivtmp$7334, ivtmp$7334,</span>
<span class=w>    </span><span class=nf>bnei</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=no>.L2031</span><span class=w>  </span><span class=c1># ivtmp$7334,,</span>
<span class=w>    </span><span class=nf>movi.n</span><span class=w>  </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=c1># j,                              &lt;- loop 2</span>
<span class=nl>.L2033:</span>
<span class=w>    </span><span class=nf>add.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w>  </span><span class=c1># a, a, j</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w>   </span><span class=c1># j, j,</span>
<span class=w>    </span><span class=nf>bnei</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=no>.L2033</span><span class=w>  </span><span class=c1># j,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>As you can see here, both loops generate the same assembly for fixed size loops.</p> <p>Let's now see for variable size loops.</p> <div class=highlight><pre><span></span><code><span class=kt>uint32_t</span><span class=w> </span><span class=nf>Example</span><span class=p>(</span><span class=kt>uint32_t</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>uint8_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>b</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>a</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>uint32_t</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>b</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>a</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>j</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>a</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly:</p> <div class=highlight><pre><span></span><code><span class=nl>_Z7Examplejj:</span>
<span class=w>    </span><span class=nf>movi.n</span><span class=w>  </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=c1># i,                     &lt;- loop 1</span>
<span class=w>    </span><span class=nf>j</span><span class=w>   </span><span class=no>.L2030</span><span class=w>  </span><span class=c1>#</span>
<span class=nl>.L2031:</span>
<span class=w>    </span><span class=nf>add.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=w>  </span><span class=c1># a, a, i</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w>   </span><span class=c1># tmp48, i,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>    </span><span class=c1># i, tmp48       &lt;- extra 32 to 8 bits conversion</span>
<span class=nl>.L2030:</span>
<span class=w>    </span><span class=nf>bltu</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.L2031</span><span class=w>  </span><span class=c1># i, b,</span>
<span class=w>    </span><span class=nf>movi.n</span><span class=w>  </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=c1># j,                     &lt;- loop 2</span>
<span class=w>    </span><span class=nf>j</span><span class=w>   </span><span class=no>.L2032</span><span class=w>  </span><span class=c1>#</span>
<span class=nl>.L2033:</span>
<span class=w>    </span><span class=nf>add.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=w>  </span><span class=c1># a, a, j</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w>   </span><span class=c1># j, j,</span>
<span class=nl>.L2032:</span>
<span class=w>    </span><span class=nf>bne</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.L2033</span><span class=w>  </span><span class=c1># j, b,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>In the first loop, the register a4 needs to be converted from 32 bits to 8 bits in each iteration.</p> <p>Again, there is no definitive rule, but keep in mind that using <code>uint8_t</code> can sometimes increase code size compared to <code>uint32_t</code>.</p> <h3 id=floats-not-doubles>Floats, not doubles!<a class=headerlink href=#floats-not-doubles title="Permanent link">~</a></h3> <p>ESP8266 does not have a FPU (Floating Point Unit), all floating point operations are emulated in software and provided in <code>libm.a</code>. The linker removes any unused functions, so we need to limit the number of floating point function calls.</p> <p><strong>Rule 1</strong>: use ints where you can, avoid floating point operations.</p> <p><strong>Rule 2</strong>: if you really need floating point, always use <code>float</code>, never <strong>ever</strong> use <code>double</code>.</p> <p>Let's now see why.</p> <p><code>float</code>fits in 32 bits, with a mantissa of 20 bits, exponent of TODO. The mantissa is 20 bits wide, which provides enough precision for most of our needs.</p> <p><code>float</code> is 32 bits wide and fits in a single register, whereas <code>double</code> is 64 bits and requires 2 registers.</p> <div class=highlight><pre><span></span><code><span class=kt>float</span><span class=w> </span><span class=nf>Examplef</span><span class=p>(</span><span class=kt>float</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>sinf</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>b</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>0.4f</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>3.5f</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly:</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1012</span><span class=p>,</span><span class=w> </span><span class=mi>0x3ecccccd</span><span class=w>      </span><span class=err>&lt;</span><span class=p>-</span><span class=w> </span><span class=mi>0</span><span class=no>.4f</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1013</span><span class=p>,</span><span class=w> </span><span class=mi>0x40600000</span><span class=w>      </span><span class=err>&lt;</span><span class=p>-</span><span class=w> </span><span class=mi>3</span><span class=no>.5f</span>
<span class=nl>_Z8Examplefff:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-16</span><span class=w> </span><span class=c1>#,,       &lt;- reserve 16 bytes on stack</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,        &lt;- save a0 (return address) on stack</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=c1>#,        &lt;- save a12 on stack, to free for local var</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1>#,        &lt;- save a13 on stack, to free for local var</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w> </span><span class=c1># b, b            &lt;- a3 holds &#39;b&#39;, save to a13</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>sinf</span><span class=w>    </span><span class=c1>#                 &lt;- calc sin of a2 (a)</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1012</span><span class=w> </span><span class=c1>#,        &lt;- load 0.4f in a3</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1># D.171139,       &lt;- save result &#39;sin(a)&#39; to a12</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#, b              &lt;- move a13 (second arg: b) to a2</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__addsf3</span><span class=w>    </span><span class=c1>#         &lt;- add floats a2 and a3, result to a2</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w>  </span><span class=c1># D.171139,       &lt;- copy result to a3</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#, D.171139       &lt;- load a2 with a12: sin(a)</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__mulsf3</span><span class=w>    </span><span class=c1>#         &lt;- multiply &#39;sin(a)*(b+0.4f)&#39;</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1013</span><span class=w> </span><span class=c1>#,        &lt;- load a3 with 3.5f</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__subsf3</span><span class=w>    </span><span class=c1>#         &lt;- subtract</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,        &lt;- restore a0 (return address)</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=c1>#,        &lt;- restore a12</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1>#,        &lt;- restore a13</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1>#,,       &lt;- free stack</span>
<span class=w>    </span><span class=nf>ret.n</span><span class=w>                             </span><span class=err>&lt;</span><span class=p>-</span><span class=w> </span><span class=no>return</span>
</code></pre></div> <p>Now with <code>double</code>:</p> <div class=highlight><pre><span></span><code><span class=kt>double</span><span class=w> </span><span class=nf>Exampled</span><span class=p>(</span><span class=kt>double</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>sin</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>b</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>0.4</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>3.5</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly:</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1014</span><span class=p>,</span><span class=w> </span><span class=mi>0x9999999a</span><span class=p>,</span><span class=w> </span><span class=mi>0x3fd99999</span><span class=w>     </span><span class=err>&lt;</span><span class=p>-</span><span class=w> </span><span class=mi>0</span><span class=no>.4</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1015</span><span class=p>,</span><span class=w> </span><span class=mi>0x00000000</span><span class=p>,</span><span class=w> </span><span class=mi>0x400c0000</span><span class=w>     </span><span class=err>&lt;</span><span class=p>-</span><span class=w> </span><span class=mi>3</span><span class=no>.5</span>
<span class=nl>_Z8Exampleddd:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-32</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>28</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>24</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a15</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a15</span><span class=p>,</span><span class=w> </span><span class=no>a5</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>sin</span><span class=w> </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>.LC1014</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>.LC1014</span><span class=err>+</span><span class=mi>4</span><span class=w>   </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a14</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a15</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__adddf3</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__muldf3</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>.LC1015</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>.LC1015</span><span class=err>+</span><span class=mi>4</span><span class=w>   </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__subdf3</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>28</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>24</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a15</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>32</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>As you can see the <code>double</code> needs to move many more registers around. Examplef (float) is 84 bytes, Exampled (double) is 119 bytes (+42% code size). Actually it's even worse, <code>sin</code> is larger than float version <code>sinf</code>.</p> <p>Also, never forget to explicitly tag literals as float: always put <code>1.5f</code> and not <code>1.5</code>. Let's see the impact:</p> <div class=highlight><pre><span></span><code><span class=kt>float</span><span class=w> </span><span class=nf>Examplef2</span><span class=p>(</span><span class=kt>float</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>sinf</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>b</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>0.4</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>3.5</span><span class=p>;</span><span class=w>    </span><span class=c1>// same as above with double literals</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly:</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1014</span><span class=p>,</span><span class=w> </span><span class=mi>0x9999999a</span><span class=p>,</span><span class=w> </span><span class=mi>0x3fd99999</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1015</span><span class=p>,</span><span class=w> </span><span class=mi>0x00000000</span><span class=p>,</span><span class=w> </span><span class=mi>0x400c0000</span>
<span class=w>    </span><span class=na>.align</span><span class=w>  </span><span class=mi>4</span>
<span class=w>    </span><span class=na>.global</span><span class=w> </span><span class=no>_Z9Examplef2ff</span>
<span class=w>    </span><span class=na>.type</span><span class=w>   </span><span class=no>_Z9Examplef2ff</span><span class=p>,</span><span class=w> </span><span class=na>@function</span>
<span class=nl>_Z9Examplef2ff:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-16</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w> </span><span class=c1># b, b</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>sinf</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__extendsfdf2</span><span class=w>   </span><span class=c1>#        &lt;- extend float to double</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a14</span><span class=w> </span><span class=c1>#, b</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__extendsfdf2</span><span class=w>   </span><span class=c1>#        &lt;- extend float to double</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>.LC1014</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>.LC1014</span><span class=err>+</span><span class=mi>4</span><span class=w>   </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__adddf3</span><span class=w>    </span><span class=c1>#        &lt;- add double</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__muldf3</span><span class=w>    </span><span class=c1>#        &lt;- multiply double</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>.LC1015</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>.LC1015</span><span class=err>+</span><span class=mi>4</span><span class=w>   </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__subdf3</span><span class=w>    </span><span class=c1>#        &lt;- subtract double</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__truncdfsf2</span><span class=w>    </span><span class=c1>#        &lt;- truncate double to float</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>The last example takes 143 bytes, which is even worse than the <code>double</code> version, because of conversions from <code>float</code> to <code>double</code> and back. Internally, if you don't force <code>float</code> literals, gcc will make all intermediate compute in <code>double</code> and convert to <code>float</code> in the end. This is usually what is wanted: compute with maximum precision and truncate at the last moment. But for ESP8266 we want the opposite: most compact code.</p> <h3 id=string-concatenation>String concatenation<a class=headerlink href=#string-concatenation title="Permanent link">~</a></h3> <p>Let's start with an easy example:</p> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=nf>ExampleStringConcat</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=s>&quot;suffix&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly (25 bytes):</p> <div class=highlight><pre><span></span><code><span class=nl>.LC1024:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;suffix&quot;</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1025</span><span class=p>,</span><span class=w> </span><span class=no>.LC1024</span>
<span class=nl>_Z19ExampleStringConcatR6String:</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1025</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-16</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatEPKc</span><span class=w>   </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>If you need to add more complex strings, do not concatenate using native c++ concat:</p> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=nf>ExampleStringConcat2</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;]&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly (122 bytes!):</p> <div class=highlight><pre><span></span><code><span class=nl>.LC231:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;,&quot;</span>
<span class=nl>.LC1026:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;[&quot;</span>
<span class=nl>.LC1029:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;]&quot;</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1027</span><span class=p>,</span><span class=w> </span><span class=no>.LC1026</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1028</span><span class=p>,</span><span class=w> </span><span class=no>.LC231</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1030</span><span class=p>,</span><span class=w> </span><span class=no>.LC1029</span>
<span class=nl>_Z20ExampleStringConcat2R6Stringhh:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-64</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>   </span><span class=c1># a, a</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1027</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>56</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1># s, s</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>60</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>   </span><span class=c1># b, b</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6StringC2EPKc</span><span class=w>    </span><span class=c1># .    &lt;- allocate String</span>
<span class=w>    </span><span class=nf>movi.n</span><span class=w>  </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0xa</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>24</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#, a</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6StringC1Ehh</span><span class=w> </span><span class=c1>#              &lt;- allocate String</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>24</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZplRK15StringSumHelperRK6String</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1028</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZplRK15StringSumHelperPKc</span><span class=w>  </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>movi.n</span><span class=w>  </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0xa</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1># D.171315,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a14</span><span class=w> </span><span class=c1>#, b</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6StringC1Ehh</span><span class=w> </span><span class=c1>#              &lt;- allocate String</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#, D.171315</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZplRK15StringSumHelperRK6String</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1030</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZplRK15StringSumHelperPKc</span><span class=w>  </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w>  </span><span class=c1># D.171315,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#, s</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatERKS_</span><span class=w>  </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6StringD1Ev</span><span class=w>  </span><span class=c1>#              &lt;- destructor</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>24</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6StringD1Ev</span><span class=w>  </span><span class=c1>#              &lt;- destructor</span>
<span class=w>    </span><span class=nf>addi.n</span><span class=w>  </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6StringD2Ev</span><span class=w>  </span><span class=c1>#          &lt;- destructor</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>60</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>56</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>64</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>Instead use native <code>String</code> concat:</p> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=nf>ExampleStringConcat3</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=p>;</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>a</span><span class=p>;</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=s>&quot;,&quot;</span><span class=p>;</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>b</span><span class=p>;</span>
<span class=w>  </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=s>&quot;]&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly (69 bytes, -43%):</p> <div class=highlight><pre><span></span><code><span class=nl>.LC231:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;,&quot;</span>
<span class=nl>.LC1026:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;[&quot;</span>
<span class=nl>.LC1029:</span>
<span class=w>    </span><span class=na>.string</span><span class=w> </span><span class=s>&quot;]&quot;</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1031</span><span class=p>,</span><span class=w> </span><span class=no>.LC1026</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1032</span><span class=p>,</span><span class=w> </span><span class=no>.LC231</span>
<span class=w>    </span><span class=na>.literal</span><span class=w> </span><span class=no>.LC1033</span><span class=p>,</span><span class=w> </span><span class=no>.LC1029</span>
<span class=nl>_Z20ExampleStringConcat3R6Stringhh:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-16</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>   </span><span class=c1># a, a</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1031</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1># s, s</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>   </span><span class=c1># b, b</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatEPKc</span><span class=w>   </span><span class=c1>#       &lt;- native char* add</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#, a</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#, s</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatEh</span><span class=w> </span><span class=c1>#       &lt;- native int add</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1032</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#, s</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatEPKc</span><span class=w>   </span><span class=c1>#       &lt;- native char* add</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a14</span><span class=w> </span><span class=c1>#, b</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#, s</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatEh</span><span class=w> </span><span class=c1>#       &lt;- native int add</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>.LC1033</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=w> </span><span class=c1>#, s</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_ZN6String6concatEPKc</span><span class=w>   </span><span class=c1>#       &lt;- native char* add</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <h2 id=extension-to-vsnprintf>Extension to <code>(v)snprintf()</code><a class=headerlink href=#extension-to-vsnprintf title="Permanent link">~</a></h2> <p>Tasmota code uses extensively <code>snprintf()</code> to build Web UI, MQTT messages and logs.</p> <p>However there are some limitations. First we use a stripped down version of <code>(v)snprintf()</code> to save a big amount of code size; and types like <code>float</code> or <code>uint64</code> or not supported. Second Arduino core often uses high level objects like <code>IPAddress</code> that are not natively supported by <code>snprintf()</code>.</p> <p>GCC libc normally includes a way to extend <code>printf</code> to new data types, but again the reduced lib in Arduino does not provide such a standard extension mechanism.</p> <p>We have now build an extension mechanism to <code>snprintf()</code> to allow for simpler code and less flash space.</p> <h3 id=how-to-use>How to use<a class=headerlink href=#how-to-use title="Permanent link">~</a></h3> <p>All extensions are using <code>%_&lt;x&gt;</code> where <code>&lt;x&gt;</code> is one of the following:</p> <p><strong>Warning</strong>: most high-level values must be passed <strong>by address</strong></p> <ul> <li><code>%_X</code>: support for <code>uint64_t</code>.</li> </ul> <p>Example:</p> <div class=highlight><pre><span></span><code>uint64_t u64 = 0x1122334455667788LL;
ext_snprintf(PSTR(&quot;Int64 = 0x%_X&quot;), &amp;u64);
</code></pre></div> <ul> <li><code>%_I</code>: support for IPv4 ip address in the form of <code>uint32_t</code>. Note: it is passed by value, not by address.</li> </ul> <p>Example:</p> <div class=highlight><pre><span></span><code>uint32_t ip = 0x10203040;
ext_snprintf(PSTR(&quot;IP = 0x%_I&quot;), ip);
</code></pre></div> <ul> <li><code>%_f</code> or <code>%*_f</code> or <code>%&lt;number&gt;_f</code>: support for <code>float</code>. Note: <code>float</code> must be passed <strong>by address</strong> (otherwise it is silently converted to double and creates alignment issues on the stack).</li> </ul> <p>When using <code>%*_f</code>, the first argument specifies the number <code>d</code> of decimal for the <code>float</code>, as a signed int. <code>d</code> can also be directly coded in the format ex: <code>%2_f</code> of <code>%-2_f</code>.</p> <p>If <code>d &gt; 0</code> we output exactly <code>d</code> decimals (even zeros), if <code>d &lt; 0</code> we output <code>d</code> decimals but remove any trailing zeros. Default value is <code>-2</code> (2 decimals).</p> <p>Example:</p> <div class=highlight><pre><span></span><code>char s[128];
float fl = 3.14;
ext_snprintf(s, sizeof(s), PSTR(&quot;f1=%*_f f2=%*_f f3=%4_f f4=%-4_f&quot;), 4, &amp;fl, -4, &amp;fl, &amp;fl, &amp;fl);
// outputs:
// &quot;f1=3.1400 f2=3.14 f3=3.1400 f4=3.14&quot;
</code></pre></div> <ul> <li><code>%*_H</code>: prints an array of bytes as Hex (uppercase). The first argument is the length in bytes of the array (if zero or negative, it outputs an empty string). The second argument is the pointer to the array of bytes. The pointer can be null if the length is zero or negative. The pointer can be in PROGMEM. Note: <code>%_H</code> will output an empty string because it is missing the length.</li> </ul> <p>Example:</p> <div class=highlight><pre><span></span><code>char s[16];
const uint8_t b[] PROGMEM = { 0x00, 0x01, 0x80, 0xFF };
ext_snprintf(s, sizeof(s), PSTR(&quot;Hex=%*_H&quot;), sizeof(b), b);
// outputs:
// &quot;Hex=000180FF&quot;
</code></pre></div> <ul> <li><code>%_B</code>: this is equivalent to <code>%*_H</code> but directly takes an <code>SBuffer()</code> object.</li> </ul> <p>Example:</p> <div class=highlight><pre><span></span><code>char s[16];
SBuffer b(8);    // statically allocate 8 bytes
b.add8(0x5A);
b.add8(0xA5);

ext_snprintf(s, sizeof(s), PSTR(&quot;Hex=%_B&quot;), &amp;b);
// outputs:
// &quot;Hex=5AA5&quot;
</code></pre></div> <h3 id=code-size-reduction>Code size reduction<a class=headerlink href=#code-size-reduction title="Permanent link">~</a></h3> <h4 id=floats>Floats<a class=headerlink href=#floats title="Permanent link">~</a></h4> <p>It is not needed to call explicitly <code>dtostrfd()</code> anymore:</p> <p>Before:</p> <div class=highlight><pre><span></span><code>int ResponseAppendTHD(float f_temperature, float f_humidity)
{
  char temperature[FLOATSZ];
  dtostrfd(f_temperature, Settings.flag2.temperature_resolution, temperature);
  char humidity[FLOATSZ];
  dtostrfd(f_humidity, Settings.flag2.humidity_resolution, humidity);
  char dewpoint[FLOATSZ];
  dtostrfd(CalcTempHumToDew(f_temperature, f_humidity), Settings.flag2.temperature_resolution, dewpoint);

  return ResponseAppend_P(PSTR(&quot;\&quot;&quot; D_JSON_TEMPERATURE &quot;\&quot;:%s,\&quot;&quot; D_JSON_HUMIDITY &quot;\&quot;:%s,\&quot;&quot; D_JSON_DEWPOINT &quot;\&quot;:%s&quot;), temperature, humidity, dewpoint);
}
</code></pre></div> <p>Assembly (117 bytes):</p> <div class=highlight><pre><span></span><code><span class=nl>_Z17ResponseAppendTHDff:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-64</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>60</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>56</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>a3</span><span class=w> </span><span class=c1># f_humidity, f_humidity</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=w> </span><span class=c1># f_temperature, f_temperature</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__extendsfdf2</span><span class=w>   </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>.LC658</span><span class=w> </span><span class=c1>#, tmp57</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>32</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>addmi</span><span class=w>   </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=mi>0x500</span><span class=w> </span><span class=c1># tmp60, tmp57,</span>
<span class=w>    </span><span class=nf>l32i</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=mi>188</span><span class=w>    </span><span class=c1># Settings, Settings</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=w>   </span><span class=c1>#, Settings,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z8dtostrfddhPc</span><span class=w> </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#, f_humidity</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__extendsfdf2</span><span class=w>   </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32i</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=mi>188</span><span class=w>    </span><span class=c1># Settings, Settings</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>28</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=w>   </span><span class=c1>#, Settings,,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z8dtostrfddhPc</span><span class=w> </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a13</span><span class=w> </span><span class=c1>#, f_humidity</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a14</span><span class=w> </span><span class=c1>#, f_temperature</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z16CalcTempHumToDewff</span><span class=w>  </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>__extendsfdf2</span><span class=w>   </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32i</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=mi>188</span><span class=w>    </span><span class=c1># Settings, Settings</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=w>   </span><span class=c1>#, Settings,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z8dtostrfddhPc</span><span class=w> </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>.LC659</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>32</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z16ResponseAppend_PPKcz</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>60</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a12</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>56</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a13</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a14</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>64</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> <p>After:</p> <div class=highlight><pre><span></span><code><span class=kt>int</span><span class=w> </span><span class=nf>ResponseAppendTHD</span><span class=p>(</span><span class=kt>float</span><span class=w> </span><span class=n>f_temperature</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>f_humidity</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kt>float</span><span class=w> </span><span class=n>dewpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CalcTempHumToDew</span><span class=p>(</span><span class=n>f_temperature</span><span class=p>,</span><span class=w> </span><span class=n>f_humidity</span><span class=p>);</span>

<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>ResponseAppend_P</span><span class=p>(</span><span class=n>PSTR</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\&quot;</span><span class=s>&quot;</span><span class=w> </span><span class=n>D_JSON_TEMPERATURE</span><span class=w> </span><span class=s>&quot;</span><span class=se>\&quot;</span><span class=s>:%*_f,</span><span class=se>\&quot;</span><span class=s>&quot;</span><span class=w> </span><span class=n>D_JSON_HUMIDITY</span><span class=w> </span><span class=s>&quot;</span><span class=se>\&quot;</span><span class=s>:%*_f,</span><span class=se>\&quot;</span><span class=s>&quot;</span><span class=w> </span><span class=n>D_JSON_DEWPOINT</span><span class=w> </span><span class=s>&quot;</span><span class=se>\&quot;</span><span class=s>:%*_f&quot;</span><span class=p>),</span>
<span class=w>                          </span><span class=n>Settings</span><span class=p>.</span><span class=n>flag2</span><span class=p>.</span><span class=n>temperature_resolution</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>f_temperature</span><span class=p>,</span>
<span class=w>                          </span><span class=n>Settings</span><span class=p>.</span><span class=n>flag2</span><span class=p>.</span><span class=n>humidity_resolution</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>f_humidity</span><span class=p>,</span>
<span class=w>                          </span><span class=n>Settings</span><span class=p>.</span><span class=n>flag2</span><span class=p>.</span><span class=n>temperature_resolution</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>dewpoint</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>Assembly (61 bytes):</p> <div class=highlight><pre><span></span><code><span class=nl>_Z17ResponseAppendTHDff:</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>-64</span><span class=w> </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>60</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>36</span><span class=w>  </span><span class=c1># f_humidity, f_humidity</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>32</span><span class=w>  </span><span class=c1># f_temperature, f_temperature</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z16CalcTempHumToDewff</span><span class=w>  </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1># dewpoint,</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>.LC658</span><span class=w>  </span><span class=c1>#, tmp51</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a4</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>32</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>addmi</span><span class=w>   </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=mi>0x500</span><span class=w>   </span><span class=c1># tmp54, tmp51,</span>
<span class=w>    </span><span class=nf>l32i</span><span class=w>    </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=mi>188</span><span class=w> </span><span class=c1># Settings, Settings</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=w>  </span><span class=c1># tmp68,,</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a7</span><span class=p>,</span><span class=w> </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=w>   </span><span class=c1># D.156427, Settings,</span>
<span class=w>    </span><span class=nf>s32i.n</span><span class=w>  </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w>   </span><span class=c1>#, tmp68</span>
<span class=w>    </span><span class=nf>l32r</span><span class=w>    </span><span class=no>a2</span><span class=p>,</span><span class=w> </span><span class=no>.LC659</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>a6</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>36</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>mov.n</span><span class=w>   </span><span class=no>a3</span><span class=p>,</span><span class=w> </span><span class=no>a7</span><span class=w>  </span><span class=c1>#, D.156427</span>
<span class=w>    </span><span class=nf>extui</span><span class=w>   </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=no>a5</span><span class=p>,</span><span class=w> </span><span class=mi>28</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=w>   </span><span class=c1>#, Settings,,</span>
<span class=w>    </span><span class=nf>call0</span><span class=w>   </span><span class=no>_Z16ResponseAppend_PPKcz</span><span class=w>    </span><span class=c1>#</span>
<span class=w>    </span><span class=nf>l32i.n</span><span class=w>  </span><span class=no>a0</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>60</span><span class=w>  </span><span class=c1>#,</span>
<span class=w>    </span><span class=nf>addi</span><span class=w>    </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=no>sp</span><span class=p>,</span><span class=w> </span><span class=mi>64</span><span class=w>  </span><span class=c1>#,,</span>
<span class=w>    </span><span class=nf>ret.n</span>
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.4b2c34cd.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>