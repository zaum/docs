<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Control over heating and cooling as a true HVAC unit"><link href=https://tasmota.github.io/docs/Thermostat/ rel=canonical><link href=../Smart-Meter-Interface/ rel=prev><link href=../Timers/ rel=next><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.12"><title>Thermostat - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8J08F8X90S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#typical-setup-heating-floor-system class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Thermostat </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class="md-tabs__link md-tabs__link--active"> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> Firmware Builds </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog Pin </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> ArtNet DMX </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> IPv6 </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting Language </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_18> <label class=md-nav__link for=__nav_2_18 id=__nav_2_18_label tabindex=0> Protocol Bridging <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_18_label aria-expanded=false> <label class=md-nav__title for=__nav_2_18> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> Arduino MCU </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> BLE Gateway </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> LCD/DLP Projector Control </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> Modbus Bridge </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Thermostat <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Thermostat </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#typical-setup-heating-floor-system class=md-nav__link> Typical setup: Heating floor system </a> <nav class=md-nav aria-label="Typical setup: Heating floor system"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-of-tasmota-switch-to-bypass-an-existing-wall-thermostat class=md-nav__link> Use of tasmota switch to bypass an existing wall thermostat </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-for-standalone-application-or-bypass-of-existing-wall-thermostat class=md-nav__link> Configuration for standalone application or bypass of existing wall thermostat </a> </li> <li class=md-nav__item> <a href=#temperature-input-setpoint class=md-nav__link> Temperature input / setpoint </a> <nav class=md-nav aria-label="Temperature input / setpoint"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-temperature-sensor class=md-nav__link> Local temperature sensor </a> </li> <li class=md-nav__item> <a href=#mqtt-temperature-value-and-setpoint class=md-nav__link> MQTT temperature value and setpoint </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#customization-of-the-controller-for-best-results class=md-nav__link> Customization of the controller for best results </a> <nav class=md-nav aria-label="Customization of the controller for best results"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enable-the-thermostat-driver class=md-nav__link> Enable the thermostat driver </a> </li> <li class=md-nav__item> <a href=#set-the-controller-in-degrees-celsius-or-fahrenheit class=md-nav__link> Set the controller in degrees Celsius or Fahrenheit </a> </li> <li class=md-nav__item> <a href=#set-the-control-strategy class=md-nav__link> Set the control strategy </a> </li> <li class=md-nav__item> <a href=#pi-controller-main-parameters class=md-nav__link> PI controller main parameters </a> </li> <li class=md-nav__item> <a href=#ramp-up-controller-main-parameters class=md-nav__link> Ramp-Up controller main parameters </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#thermostat-persistent-storage-for-configuration class=md-nav__link> Thermostat persistent storage for configuration </a> </li> <li class=md-nav__item> <a href=#detecting-an-opened-window-by-temperature-drop class=md-nav__link> Detecting an opened window by temperature drop </a> </li> <li class=md-nav__item> <a href=#advanced-features class=md-nav__link> Advanced features </a> <nav class=md-nav aria-label="Advanced features"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-controller class=md-nav__link> Multi-controller </a> </li> <li class=md-nav__item> <a href=#alternative-outputs-pwm-duty-cycle class=md-nav__link> Alternative outputs: PWM duty cycle </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#future-improvements class=md-nav__link> Future improvements </a> <nav class=md-nav aria-label="Future improvements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cooling class=md-nav__link> Cooling </a> </li> <li class=md-nav__item> <a href=#self-learning-process-of-the-ramp-up-controller-to-reduce-overshoot class=md-nav__link> Self learning process of the "Ramp-Up" controller to reduce overshoot </a> </li> <li class=md-nav__item> <a href=#pi-autotune class=md-nav__link> PI Autotune </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> Universal File System </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> Wi-Fi Range Extender </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> ESP32 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> Tasmota32 Features </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> Berry </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> Bluetooth Low Energy </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> I2S Audio </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> LVGL </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> HASPmota </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> Tasmota Application Files </a> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> Touch GPIOs </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> Safeboot Partition Layout </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> Supported Devices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> Tasmohab </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> Web Installer </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#typical-setup-heating-floor-system class=md-nav__link> Typical setup: Heating floor system </a> <nav class=md-nav aria-label="Typical setup: Heating floor system"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-of-tasmota-switch-to-bypass-an-existing-wall-thermostat class=md-nav__link> Use of tasmota switch to bypass an existing wall thermostat </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-for-standalone-application-or-bypass-of-existing-wall-thermostat class=md-nav__link> Configuration for standalone application or bypass of existing wall thermostat </a> </li> <li class=md-nav__item> <a href=#temperature-input-setpoint class=md-nav__link> Temperature input / setpoint </a> <nav class=md-nav aria-label="Temperature input / setpoint"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-temperature-sensor class=md-nav__link> Local temperature sensor </a> </li> <li class=md-nav__item> <a href=#mqtt-temperature-value-and-setpoint class=md-nav__link> MQTT temperature value and setpoint </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#customization-of-the-controller-for-best-results class=md-nav__link> Customization of the controller for best results </a> <nav class=md-nav aria-label="Customization of the controller for best results"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enable-the-thermostat-driver class=md-nav__link> Enable the thermostat driver </a> </li> <li class=md-nav__item> <a href=#set-the-controller-in-degrees-celsius-or-fahrenheit class=md-nav__link> Set the controller in degrees Celsius or Fahrenheit </a> </li> <li class=md-nav__item> <a href=#set-the-control-strategy class=md-nav__link> Set the control strategy </a> </li> <li class=md-nav__item> <a href=#pi-controller-main-parameters class=md-nav__link> PI controller main parameters </a> </li> <li class=md-nav__item> <a href=#ramp-up-controller-main-parameters class=md-nav__link> Ramp-Up controller main parameters </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#thermostat-persistent-storage-for-configuration class=md-nav__link> Thermostat persistent storage for configuration </a> </li> <li class=md-nav__item> <a href=#detecting-an-opened-window-by-temperature-drop class=md-nav__link> Detecting an opened window by temperature drop </a> </li> <li class=md-nav__item> <a href=#advanced-features class=md-nav__link> Advanced features </a> <nav class=md-nav aria-label="Advanced features"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-controller class=md-nav__link> Multi-controller </a> </li> <li class=md-nav__item> <a href=#alternative-outputs-pwm-duty-cycle class=md-nav__link> Alternative outputs: PWM duty cycle </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#future-improvements class=md-nav__link> Future improvements </a> <nav class=md-nav aria-label="Future improvements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cooling class=md-nav__link> Cooling </a> </li> <li class=md-nav__item> <a href=#self-learning-process-of-the-ramp-up-controller-to-reduce-overshoot class=md-nav__link> Self learning process of the "Ramp-Up" controller to reduce overshoot </a> </li> <li class=md-nav__item> <a href=#pi-autotune class=md-nav__link> PI Autotune </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Thermostat.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1>Thermostat</h1> <details class=failure> <summary>This feature is not included in precompiled binaries</summary> <p>When <a href=../Compile-your-build/ >compiling your build</a> add the following to <code>user_config_override.h</code>: <div class=highlight><pre><span></span><code><span class=cp>#define USE_THERMOSTAT                           </span><span class=c1>// Add support for Thermostat</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_CONTROLLER_OUTPUTS         1         </span><span class=c1>// Number of outputs to be controlled independently</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_SENSOR_NAME                &quot;DS18B20&quot; </span><span class=c1>// Name of the local sensor to be used</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_SENSOR_NUMBER              1         </span><span class=c1>// Number of local sensors to be used</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_RELAY_NUMBER               1         </span><span class=c1>// Default output relay number for the first controller (+i for following ones)</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_SWITCH_NUMBER              1         </span><span class=c1>// Default input switch number for the first controller (+i for following ones)</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_ALLOW_RAMPUP          300       </span><span class=c1>// Default time after last target update to allow ramp-up controller phase in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_RAMPUP_MAX            960       </span><span class=c1>// Default time maximum ramp-up controller duration in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_RAMPUP_CYCLE          30        </span><span class=c1>// Default time ramp-up cycle in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_SENS_LOST             30        </span><span class=c1>// Maximum time w/o sensor update to set it as lost in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_SENS_NUMBER           1         </span><span class=c1>// Default temperature sensor number</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_MANUAL_TO_AUTO        60        </span><span class=c1>// Default time without input switch active to change from manual to automatic in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_RESET                 12000     </span><span class=c1>// Default reset time of the PI controller in seconds</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_PI_CYCLE              30        </span><span class=c1>// Default cycle time for the thermostat controller in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_MAX_ACTION            20        </span><span class=c1>// Default maximum thermostat time per cycle in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_MIN_ACTION            4         </span><span class=c1>// Default minimum thermostat time per cycle in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_MIN_TURNOFF_ACTION    3         </span><span class=c1>// Default minimum turnoff time in minutes, below it the thermostat will be held on</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_PROP_BAND                  4         </span><span class=c1>// Default proportional band of the PI controller in degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_RESET_ANTI_WINDUP     8         </span><span class=c1>// Default range where reset antiwindup is disabled, in tenths of degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_HYSTERESIS            1         </span><span class=c1>// Default range hysteresis for temperature PI controller, in tenths of degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_FROST_PROTECT         40        </span><span class=c1>// Default minimum temperature for frost protection, in tenths of degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_RAMPUP_DELTA_IN       4         </span><span class=c1>// Default minimum delta temperature to target to get into rampup mode, in tenths of degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_RAMPUP_DELTA_OUT      2         </span><span class=c1>// Default minimum delta temperature to target to get out of the rampup mode, in tenths of degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_PI_RAMPUP_ACC_E       200       </span><span class=c1>// Default accumulated error when switching from ramp-up controller to PI in hundredths of degrees celsius</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_OUTPUT_DELAY          180       </span><span class=c1>// Default output delay between state change and real actuation event (f.i. valve open/closed)</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_INIT                  180       </span><span class=c1>// Default init target temperature for the thermostat controller</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_MAX_OUTPUT_INCONSIST  3         </span><span class=c1>// Default maximum time where the input and the output shall differ (for diagnostic) in minutes</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_MAX_AUTOTUNE          21600     </span><span class=c1>// Maximum time for the PI autotune function to complete in seconds</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_DUTYCYCLE_AUTOTUNE         35        </span><span class=c1>// Default duty cycle (in % over PI cycle time) for the step response of the autotune PI function</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_PEAKNUMBER_AUTOTUNE        8         </span><span class=c1>// Default number of peak temperatures (max or min) to be used for the autotune PI function</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TEMP_BAND_NO_PEAK_DET      1         </span><span class=c1>// Default temperature band in thenths of degrees celsius within no peak will be detected</span>
<span class=w>    </span><span class=cp>#define THERMOSTAT_TIME_STD_DEV_PEAK_DET_OK   10        </span><span class=c1>// Default standard deviation in minutes of the oscillation periods within the peak detection is successful    </span>
</code></pre></div></p> </details> <div class="admonition info"> <p class=admonition-title>Control over heating and cooling as a true HVAC unit</p> </div> <p>Thermostat driver allows a Tasmota device, provided it receives the temperature input via MQTT or a locally connected sensor, to follow control heating/cooling strategies to reach the desired setpoint. The thermostat offers similar functions as feature rich commercial ones as the models found below:</p> <p><img alt=Pinout src=../_media/thermostat/Feature_rich_thermostat.png></p> <h2 id=typical-setup-heating-floor-system>Typical setup: Heating floor system<a class=headerlink href=#typical-setup-heating-floor-system title="Permanent link">~</a></h2> <p>A typical setup for heating room systems can be found in the picture below. A conventional room thermostat is connected to a heating floor valve actuator, both running at AC voltage (f.e. 220V). The thermostat is connected to neutral as well as to the phase, the actuator to the same neutral connection of the thermostat and to its actuation signal. The actuation signal will switch between the neutral voltage (actuation Off) and the phase voltage (actuation On).</p> <p>The conventional room thermostats offer nowadays either 2 point control with hysteresis or a more advanced PI (Proportional-Integral) control. The result of the PI control is typically transformed into a PWM signal with a pre-defined period and a variable duty cycle.</p> <p><img alt=Pinout src=../_media/thermostat/conventional_thermostat.png></p> <h3 id=use-of-tasmota-switch-to-bypass-an-existing-wall-thermostat>Use of tasmota switch to bypass an existing wall thermostat<a class=headerlink href=#use-of-tasmota-switch-to-bypass-an-existing-wall-thermostat title="Permanent link">~</a></h3> <p>A tasmota switch can be installed in a way that it bypasses the existing wall thermostat. The advantage of this setup is that the thermostat driver offers the possibility to follow the output of the existing wall thermostat or acting autonomously. This setup allows a seamless integration with existing wall thermostats and gives the user the freedom to still use them.</p> <p>Below you can find an example of a Shelly switch bypassing a wall thermostat:</p> <p><img alt=Pinout src=../_media/thermostat/bypass_thermostat.png></p> <h2 id=configuration-for-standalone-application-or-bypass-of-existing-wall-thermostat>Configuration for standalone application or bypass of existing wall thermostat<a class=headerlink href=#configuration-for-standalone-application-or-bypass-of-existing-wall-thermostat title="Permanent link">~</a></h2> <p>The driver by default does not consider the input switch states even if available and it's therefore suitable for standalone use. If the application requires to follow the command of the input once active (see bypass setup explained in previous section). This bypass function is specially useful to allow the user to use the device bypassed, in case of a wall thermostat, to allow this thermostat to be used if desired. To enable this bypass function, the following command is to be sent to the tasmota device:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/INPUTSWITCHUSE 1
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Some devices (such as the Sonoff 4CH Pro R2) even if having input buttons to manually switch the state of the output, report always its inputs in active state no matter if the button is pressed or not. For these devices the parameter above needs to be set to 0, otherwise the thermostat driver will activate the output continuously and stay permanently in manual mode.</p> </div> <p>Once active, the thermostat, in case of its input being active, will switch to manual mode and set as output the same state of its input. The thermostat will switch back from manual to automatic mode after a defined time where the input is inactive. The following parameter can be set to modify the time window in minutes to switch back to automatic in case the input is inactive:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMEMANUALTOAUTOSET 60
</code></pre></div> <p>The default value for the time window to switch from manual to automatic is 60 minutes.</p> <h2 id=temperature-input-setpoint>Temperature input / setpoint<a class=headerlink href=#temperature-input-setpoint title="Permanent link">~</a></h2> <h3 id=local-temperature-sensor>Local temperature sensor<a class=headerlink href=#local-temperature-sensor title="Permanent link">~</a></h3> <p>The tasmota driver can receive the temperature either via the related MQTT command or via a local temperature sensor (see example of a DS18B20 temperature sensor and a shelly temperature sensor addon below).</p> <p><img alt=Pinout src=../_media/thermostat/sensors.png></p> <p>The default temperature input is MQTT. The following command can be used to select the local sensor as default input:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/SENSORINPUTSET 1
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The default local temperature sensor is a DS18B20. In case a different Tasmota supported sensor is used, the following define in <code>my_user_config.h</code> is to be changed (or redefined in <code>user_config_override.h</code>) and a user specific tasmota software needs to be compiled:</p> </div> <div class=highlight><pre><span></span><code>#define THERMOSTAT_SENSOR_NAME                &quot;DS18B20&quot; // Name of the local sensor to be used
</code></pre></div> <h3 id=mqtt-temperature-value-and-setpoint>MQTT temperature value and setpoint<a class=headerlink href=#mqtt-temperature-value-and-setpoint title="Permanent link">~</a></h3> <p>The following commands can be used to provide the driver with the temperature value of the room and the desired setpoint:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TEMPTARGETSET 22.5
</code></pre></div> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TEMPMEASUREDSET 21.8
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Examples for room temperature of 21.8°C and temperature setpoint of 22.5°C</p> </div> <p>There are several ways to send the MQTT room temperature. For the development and testing of this driver, a Raspberry Pi with Domoticz and a Z-Wave stick has been used to gather all room temperatures from Z-Wave sensors and send them to the respective Tasmota room thermostats.</p> <h2 id=customization-of-the-controller-for-best-results>Customization of the controller for best results<a class=headerlink href=#customization-of-the-controller-for-best-results title="Permanent link">~</a></h2> <p>The thermostat controller includes a default parameter set that targets a typical floor heating application for mid-sized rooms (&lt; 20m2) with one heating circuit. The controller is however highly configurable via MQTT. The following sections will guide the user to adapt the main parameters to improve the performance of the thermostat controller via customization.</p> <h3 id=enable-the-thermostat-driver>Enable the thermostat driver<a class=headerlink href=#enable-the-thermostat-driver title="Permanent link">~</a></h3> <p>The thermostat driver is by default disabled. To enable it the following command can be used:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/THERMOSTATMODESET 1
</code></pre></div> <h3 id=set-the-controller-in-degrees-celsius-or-fahrenheit>Set the controller in degrees Celsius or Fahrenheit<a class=headerlink href=#set-the-controller-in-degrees-celsius-or-fahrenheit title="Permanent link">~</a></h3> <p>The default temperature format is degrees Celsius. The format can be easily switched to degrees Fahrenheit via MQTT command, see below:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TEMPFORMATSET 1
</code></pre></div> <h3 id=set-the-control-strategy>Set the control strategy<a class=headerlink href=#set-the-control-strategy title="Permanent link">~</a></h3> <p>The control strategy by default is a Hybrid one. The hybrid control strategy mixes a so called "Ramp-Up" strategy (invention during the development of this driver, initially as a LUA script and ported to Tasmota later) and a PI one. The "Ramp-Up" strategy is typically used to reach as fast as possible the setpoint for big deltas between desired temperature and setpoint, the PI on the other hand for most part of the normal thermostat operation.</p> <p>The control strategy can be however modified, if the Hybrid one is not desired, the PI or "Ramp-Up" mode, can be forced. For that purpose the following command can be used:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/CONTROLLERMODESET 1
</code></pre></div> <p>The value 1 forces the PI operation and the value 2 the "Ramp-Up" one.</p> <h3 id=pi-controller-main-parameters>PI controller main parameters<a class=headerlink href=#pi-controller-main-parameters title="Permanent link">~</a></h3> <h4 id=cycle-time>Cycle time<a class=headerlink href=#cycle-time title="Permanent link">~</a></h4> <p>Depending on the heating system, the cycle time (PMW period) can be adapted. Very slow systems (high time constants) such as heating floor systems might need higher values (default value is 30 minutes), faster systems might need smaller cycle times. Below the command to adapt the cycle time can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMEPICYCLESET 30
</code></pre></div> <h4 id=proportional-band>Proportional Band<a class=headerlink href=#proportional-band title="Permanent link">~</a></h4> <p>Depending on the dimensioning of your heating system, the proportional band of the controller might be increased (if it takes too long to reach setpoint) or reduced (very high overshoot). The default proportional gain is 4, which means that the duty cycle due to the proportional part of the PI controller will be 100% for temperature deltas between setpoint and room temperature equal or bigger than 4°C. Below the command to adapt the proportional band can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/PROPBANDSET 1
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>With the command above, the PI controller will output a proportional time equivalent to 100% of the duty cycle for delta temperatures between setpoint and room temp. above 1°C (f.e. for big rooms with weak dimensioned heating circuit).</p> </div> <h4 id=reset-time>Reset Time<a class=headerlink href=#reset-time title="Permanent link">~</a></h4> <p>The reset time is the time the PI controller takes to overcome steady-state errors. The default value for the reset time is 1800 seconds. This value can be for instance increased in case a stronger integral reaction of the controller is desired. Below the command to adapt the proportional band can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMERESETSET 1800
</code></pre></div> <h4 id=temperature-for-the-anti-windup-reset>Temperature for the anti-windup reset<a class=headerlink href=#temperature-for-the-anti-windup-reset title="Permanent link">~</a></h4> <p>To avoid the accumulated error and therefore integral component of the PI controller to grow too much and produce a high overshoot, a temperature delta can be defined within the integrator will work. Outside this range the accumulated error and integral part will be set to 0. The default value for the integrator to work is 0.8°C. Below the command to adapt the anti-windup temperature can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TEMPANTIWINDUPRESETSET 0.8
</code></pre></div> <h4 id=temperature-hysteresis>Temperature hysteresis<a class=headerlink href=#temperature-hysteresis title="Permanent link">~</a></h4> <p>A temperature hysteresis can be set to avoid any PI controller actions within a certain value around the setpoint. The default value for the hysteresis is 0.1°C. In well configured controller this value should be as low as possible to avoid unwanted temperature oscillations which reduce efficiency and therefore increase costs. Below the command to adapt the anti-windup temperature can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TEMPHYSTSET 0.1
</code></pre></div> <h4 id=maximum-action-of-the-controller>Maximum action of the controller<a class=headerlink href=#maximum-action-of-the-controller title="Permanent link">~</a></h4> <p>The maximum On time (Duty Cycle) in minutes within a cycle can be set by this parameter. The default value is 20 minutes. This represents for the default cycle time of 30 minutes 2 thirds of the complete cycle. In case the controller takes too long to reach the setpoint, this value can be increased to values closer to the cycle time. Below the command to adapt the maximum action time can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMEMAXACTIONSET 20
</code></pre></div> <h4 id=minimum-action-of-the-controller>Minimum action of the controller<a class=headerlink href=#minimum-action-of-the-controller title="Permanent link">~</a></h4> <p>The minimum On time (Duty Cycle) in minutes within a cycle can be set by this parameter. The default value is 4 minutes. Below the command to adapt the minimum action time can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMEMINACTIONSET 4
</code></pre></div> <div class="admonition note"> <p class=admonition-title>It is very important to adapt this value to your heating system to obtain accurate temperature control</p> </div> <p>If the value is very low, in case of floor heating systems for instance, the heating actuators might not have enough time to open the valves and the temperature will drop (depending on the actuator open/close time could take from 1 to 3 minutes) if it is too high, there will be unwanted oscillations around the setpoint. One way to configure this value in heating mode is to manually tune it in worst case conditions (highest typically desired room temperature and lower winter temperature outside) checking that the proportional action generated by the controller is sufficient to raise slightly the temperature. If the temperature still goes down after the pulse plus delay time of the system and rises just once the accumulated error triggers integral actions then the value set is too low.</p> <h3 id=ramp-up-controller-main-parameters>Ramp-Up controller main parameters<a class=headerlink href=#ramp-up-controller-main-parameters title="Permanent link">~</a></h3> <h4 id=temperature-delta-to-get-into-ramp-up-mode>Temperature delta to get into "Ramp-Up" mode<a class=headerlink href=#temperature-delta-to-get-into-ramp-up-mode title="Permanent link">~</a></h4> <p>When the controller is configured in Hybrid mode (default), the control strategy will be a mix-up between "Ramp-Up" (for big deltas between room temperature and setpoint) and PI (around the setpoint). The following parameter can be set to define at above which delta temperature between measured and setpoint the "Ramp-Up" controller shall be active:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TEMPRUPDELTINSET 30
</code></pre></div> <p>The default value is 0.4°C.</p> <h4 id=time-passed-after-latest-setpoint-change-to-get-into-ramp-up-mode>Time passed after latest setpoint change to get into "Ramp-Up" mode<a class=headerlink href=#time-passed-after-latest-setpoint-change-to-get-into-ramp-up-mode title="Permanent link">~</a></h4> <p>When the controller is configured in Hybrid mode (default), the activation of the "Ramp-Up" mode will not just depend on the defined temperature delta between measured and setpoint, but as well on the time in minutes passed since the last setpoint change occurred. This strategy matches the purpose of the "Ramp-Up" controller, which was developed to reach the desired temperature as fast as possible in very specific scenarios, f.e. after a night keeping the room temperature low. In hybrid mode, the controller active most part of the time should be the PI one. The following parameter can be used to define the time to allow switching to "Ramp-Up" in minutes.</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMEALLOWRAMPUPSET 300
</code></pre></div> <p>The default value is 300 minutes.</p> <h4 id=cycle-time_1>Cycle time<a class=headerlink href=#cycle-time_1 title="Permanent link">~</a></h4> <p>Depending on the heating system, the cycle time (PMW period) can be adapted. Very slow systems (high time constants) such as heating floor systems might need higher values (default value is 30 minutes), faster systems might need smaller cycle times. Below the command to adapt the cycle time can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMERAMPUPCYCLESET 30
</code></pre></div> <h4 id=maximum-ramp-up-time>Maximum Ramp-Up time<a class=headerlink href=#maximum-ramp-up-time title="Permanent link">~</a></h4> <p>The maximum time the ramp-up phase of the controller shall be active can be configured. The default value is 960 minutes. Below the command to adapt this time can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/TIMERAMPUPMAXSET 960
</code></pre></div> <h2 id=thermostat-persistent-storage-for-configuration>Thermostat persistent storage for configuration<a class=headerlink href=#thermostat-persistent-storage-for-configuration title="Permanent link">~</a></h2> <p>The thermostat driver stores all configured parameters over MQTT exclusively in RAM, it does not use flash due to the amount of the parameters. This means that at every restart the default parameters will be set again. To avoid this behavior rules can be set-up to reconfigure desired parameters at every restart. See below an example:</p> <div class=highlight><pre><span></span><code>ON Power1#boot DO Backlog sensorinputset 1;controllermodeset 2;thermostatmodeset 1;temptargetset %mem1% ENDON
ON mqtt#connected DO Publish2 stat/TestTopic/targetTempValue {&quot;Temp&quot;:%mem1%} ENDON
ON mem1#state DO Backlog temptargetset %value%;Publish2 stat/TestTopic/targetTempValue {&quot;Temp&quot;:%mem1%} ENDON
</code></pre></div> <h2 id=detecting-an-opened-window-by-temperature-drop>Detecting an opened window by temperature drop<a class=headerlink href=#detecting-an-opened-window-by-temperature-drop title="Permanent link">~</a></h2> <p>When opening windows, temperature will drop significantly faster than is normal. During that period, heating is usually not desired. Following rules will detect a .3C drop in 1min and send the thermostat into a 15min timeout. Replace <code>HTU21</code> with your sensor's name, if your <code>Teleperiod</code> is &lt; 1min, consider using <code>Tele-HTU21#Temperature</code>.</p> <div class=highlight><pre><span></span><code>ON Event#windowstop DO Backlog EnableOutputSet 0; Power 0; RuleTimer1 900 ENDON
ON Rules#Timer=1 DO EnableOutputSet 1 ENDON
ON HTU21#Temperature DO Var1 %value% ENDON
ON Time#Minute DO Backlog Var3 %Var2%; Sub3 .3; Var2 %Var1% ENDON
ON Var2#State&lt;=%Var3% DO Event windowstop ENDON
</code></pre></div> <h2 id=advanced-features>Advanced features<a class=headerlink href=#advanced-features title="Permanent link">~</a></h2> <h3 id=multi-controller>Multi-controller<a class=headerlink href=#multi-controller title="Permanent link">~</a></h3> <p>The tasmota driver can be compiled to be used in devices with more than one output, allowing independent controllers for each one of the outputs. This feature has been successfully tested with a Sonoff 4CH PRO R2.</p> <p><img alt=Pinout src=../_media/thermostat/multi_thermostat.png></p> <p>To increase the number of controller outputs, modify the value of the thermostat controller outputs in <code>my_user_config.h</code> or redefine it in <code>user_config_override.h</code> and compile a customized tasmota software.</p> <div class=highlight><pre><span></span><code>#define THERMOSTAT_CONTROLLER_OUTPUTS         1         // Number of outputs to be controlled independently
</code></pre></div> <h3 id=alternative-outputs-pwm-duty-cycle>Alternative outputs: PWM duty cycle<a class=headerlink href=#alternative-outputs-pwm-duty-cycle title="Permanent link">~</a></h3> <p>The driver provides the possibility to read the duty cycle in % (0-100) of the actuated relay. Below the command to read the duty cycle can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/CTRDUTYCYCLEREAD
</code></pre></div> <p>The physical switch of the output can as well be disabled via command. Below the command to disable it can be found:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/ENABLEOUTPUTSET 0
</code></pre></div> <h2 id=future-improvements>Future improvements<a class=headerlink href=#future-improvements title="Permanent link">~</a></h2> <h3 id=cooling>Cooling<a class=headerlink href=#cooling title="Permanent link">~</a></h3> <p>The controller offers the possibility to switch from heating to cooling. Due to lack of cooling setup at the time of the development of the driver, this feature has however not been properly tested. Testers for cooling are therefore welcomed.</p> <p>The following MQTT command can be used to switch from heating (default) to cooling:</p> <div class=highlight><pre><span></span><code>cmnd/Tasmota_Name/CLIMATEMODESET 1
</code></pre></div> <h3 id=self-learning-process-of-the-ramp-up-controller-to-reduce-overshoot>Self learning process of the "Ramp-Up" controller to reduce overshoot<a class=headerlink href=#self-learning-process-of-the-ramp-up-controller-to-reduce-overshoot title="Permanent link">~</a></h3> <p>The "Ramp-Up" controller evaluates the time constant of the system and predicts when to switch off the actuator to reach the desired temperature as fast as possible. This controller offers the best speed to reach the Setpoint. This controller will be improved by a learning process to evaluate how accurate the target value has been reached and therefore minimize gradually the overshoot. This feature will improve the behavior of the current controller which depending on the application and thermal capacity of the system might produce some overshoot. By default the controller set is the Hybrid one, enabling "Ramp-Up" for big temperature deltas between Setpoint and measured temperature and PI for smaller ones. If you are not satisfied with the performance of this controller in your system, you can disable it by MQTT and force the use of the PI controller exclusively (see Controller configuration section above).</p> <h3 id=pi-autotune>PI Autotune<a class=headerlink href=#pi-autotune title="Permanent link">~</a></h3> <p>A PI autotune feature following the Zigler-Nichols closed loop algorithm has been implemented. This feature is untested and will be further developed soon. To enable it for testing purposes add the following define in <code>user_config_override.h</code> and compile a customized tasmota software.</p> <div class=highlight><pre><span></span><code>#define USE_PI_AUTOTUNING // (Ziegler-Nichols closed loop method)
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.4b2c34cd.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>