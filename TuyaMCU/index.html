<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/TuyaMCU/ rel=canonical><link href=../TLS/ rel=prev><link href=../UFS/ rel=next><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.12"><title>TuyaMCU - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8J08F8X90S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tuyamcu-command class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TuyaMCU </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class="md-tabs__link md-tabs__link--active"> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> Firmware Builds </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog Pin </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> ArtNet DMX </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> IPv6 </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting Language </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_18> <label class=md-nav__link for=__nav_2_18 id=__nav_2_18_label tabindex=0> Protocol Bridging <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_18_label aria-expanded=false> <label class=md-nav__title for=__nav_2_18> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> Arduino MCU </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> BLE Gateway </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> LCD/DLP Projector Control </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> Modbus Bridge </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> Thermostat </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> TuyaMCU <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> TuyaMCU </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#dpid class=md-nav__link> dpId </a> </li> <li class=md-nav__item> <a href=#fnid class=md-nav__link> fnId </a> </li> <li class=md-nav__item> <a href=#tuyasend-command class=md-nav__link> TuyaSend Command </a> </li> <li class=md-nav__item> <a href=#tuyareceived class=md-nav__link> TuyaReceived </a> </li> <li class=md-nav__item> <a href=#device-configurations class=md-nav__link> Device Configurations </a> <nav class=md-nav aria-label="Device Configurations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dimmer class=md-nav__link> Dimmer </a> </li> <li class=md-nav__item> <a href=#dual-dimmer class=md-nav__link> Dual Dimmer </a> </li> <li class=md-nav__item> <a href=#lights class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=#enums class=md-nav__link> Enums </a> </li> <li class=md-nav__item> <a href=#sensors class=md-nav__link> Sensors </a> </li> <li class=md-nav__item> <a href=#timers class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=#covers class=md-nav__link> Covers </a> </li> <li class=md-nav__item> <a href=#switches class=md-nav__link> Switches </a> </li> <li class=md-nav__item> <a href=#power-metering class=md-nav__link> Power Metering </a> </li> <li class=md-nav__item> <a href=#battery-powered-sensors class=md-nav__link> Battery Powered Sensors </a> </li> <li class=md-nav__item> <a href=#specific-devices class=md-nav__link> Specific Devices </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuya-protocols class=md-nav__link> Tuya Protocols </a> </li> <li class=md-nav__item> <a href=#basic-protocols class=md-nav__link> Basic protocols </a> </li> <li class=md-nav__item> <a href=#functional-protocols class=md-nav__link> Functional protocols </a> </li> <li class=md-nav__item> <a href=#anatomy-of-tuya-protocol class=md-nav__link> Anatomy of Tuya Protocol </a> </li> <li class=md-nav__item> <a href=#dpid-function-tables class=md-nav__link> dpId Function Tables </a> <nav class=md-nav aria-label="dpId Function Tables"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#switches-or-plugspower-strips class=md-nav__link> Switches or Plugs/Power Strips </a> </li> <li class=md-nav__item> <a href=#aromatherapy-machine-oil-diffuser class=md-nav__link> Aromatherapy Machine (Oil Diffuser) </a> </li> <li class=md-nav__item> <a href=#curtain-motor class=md-nav__link> Curtain Motor </a> </li> <li class=md-nav__item> <a href=#power-monitoring-plug class=md-nav__link> Power Monitoring Plug </a> </li> <li class=md-nav__item> <a href=#dehumidifier class=md-nav__link> Dehumidifier </a> </li> <li class=md-nav__item> <a href=#lighting class=md-nav__link> Lighting </a> </li> <li class=md-nav__item> <a href=#contact-sensor class=md-nav__link> Contact Sensor </a> </li> <li class=md-nav__item> <a href=#air-purifier class=md-nav__link> Air purifier </a> </li> <li class=md-nav__item> <a href=#heater class=md-nav__link> Heater </a> </li> <li class=md-nav__item> <a href=#smart-fan class=md-nav__link> Smart fan </a> </li> <li class=md-nav__item> <a href=#kettle class=md-nav__link> Kettle </a> </li> <li class=md-nav__item> <a href=#becathermostat class=md-nav__link> BecaThermostat </a> </li> <li class=md-nav__item> <a href=#inkbird-itc-308-wifi class=md-nav__link> Inkbird ITC-308-Wifi </a> </li> <li class=md-nav__item> <a href=#inkbird-ihc-200-wifi class=md-nav__link> Inkbird IHC-200-Wifi </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-reading class=md-nav__link> Further Reading </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> Universal File System </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> Wi-Fi Range Extender </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> ESP32 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> Tasmota32 Features </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> Berry </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> Bluetooth Low Energy </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> I2S Audio </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> LVGL </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> HASPmota </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> Tasmota Application Files </a> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> Touch GPIOs </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> Safeboot Partition Layout </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> Supported Devices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> Tasmohab </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> Web Installer </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#dpid class=md-nav__link> dpId </a> </li> <li class=md-nav__item> <a href=#fnid class=md-nav__link> fnId </a> </li> <li class=md-nav__item> <a href=#tuyasend-command class=md-nav__link> TuyaSend Command </a> </li> <li class=md-nav__item> <a href=#tuyareceived class=md-nav__link> TuyaReceived </a> </li> <li class=md-nav__item> <a href=#device-configurations class=md-nav__link> Device Configurations </a> <nav class=md-nav aria-label="Device Configurations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dimmer class=md-nav__link> Dimmer </a> </li> <li class=md-nav__item> <a href=#dual-dimmer class=md-nav__link> Dual Dimmer </a> </li> <li class=md-nav__item> <a href=#lights class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=#enums class=md-nav__link> Enums </a> </li> <li class=md-nav__item> <a href=#sensors class=md-nav__link> Sensors </a> </li> <li class=md-nav__item> <a href=#timers class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=#covers class=md-nav__link> Covers </a> </li> <li class=md-nav__item> <a href=#switches class=md-nav__link> Switches </a> </li> <li class=md-nav__item> <a href=#power-metering class=md-nav__link> Power Metering </a> </li> <li class=md-nav__item> <a href=#battery-powered-sensors class=md-nav__link> Battery Powered Sensors </a> </li> <li class=md-nav__item> <a href=#specific-devices class=md-nav__link> Specific Devices </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuya-protocols class=md-nav__link> Tuya Protocols </a> </li> <li class=md-nav__item> <a href=#basic-protocols class=md-nav__link> Basic protocols </a> </li> <li class=md-nav__item> <a href=#functional-protocols class=md-nav__link> Functional protocols </a> </li> <li class=md-nav__item> <a href=#anatomy-of-tuya-protocol class=md-nav__link> Anatomy of Tuya Protocol </a> </li> <li class=md-nav__item> <a href=#dpid-function-tables class=md-nav__link> dpId Function Tables </a> <nav class=md-nav aria-label="dpId Function Tables"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#switches-or-plugspower-strips class=md-nav__link> Switches or Plugs/Power Strips </a> </li> <li class=md-nav__item> <a href=#aromatherapy-machine-oil-diffuser class=md-nav__link> Aromatherapy Machine (Oil Diffuser) </a> </li> <li class=md-nav__item> <a href=#curtain-motor class=md-nav__link> Curtain Motor </a> </li> <li class=md-nav__item> <a href=#power-monitoring-plug class=md-nav__link> Power Monitoring Plug </a> </li> <li class=md-nav__item> <a href=#dehumidifier class=md-nav__link> Dehumidifier </a> </li> <li class=md-nav__item> <a href=#lighting class=md-nav__link> Lighting </a> </li> <li class=md-nav__item> <a href=#contact-sensor class=md-nav__link> Contact Sensor </a> </li> <li class=md-nav__item> <a href=#air-purifier class=md-nav__link> Air purifier </a> </li> <li class=md-nav__item> <a href=#heater class=md-nav__link> Heater </a> </li> <li class=md-nav__item> <a href=#smart-fan class=md-nav__link> Smart fan </a> </li> <li class=md-nav__item> <a href=#kettle class=md-nav__link> Kettle </a> </li> <li class=md-nav__item> <a href=#becathermostat class=md-nav__link> BecaThermostat </a> </li> <li class=md-nav__item> <a href=#inkbird-itc-308-wifi class=md-nav__link> Inkbird ITC-308-Wifi </a> </li> <li class=md-nav__item> <a href=#inkbird-ihc-200-wifi class=md-nav__link> Inkbird IHC-200-Wifi </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-reading class=md-nav__link> Further Reading </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/TuyaMCU.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <div class="admonition info"> <p class=admonition-title>TuyaMCU - Module (54) is configured for devices with a Tuya Wi-Fi module and a secondary MCU. </p> </div> <p>Originally, in those devices, the Wi-Fi module takes care of network and software features. Meanwhile, the MCU controls the hardware based on commands received from the Wi-Fi module or built-in controls (buttons, switches, remotes and similar) and reports the status back to the Wi-Fi module. </p> <p>TuyaMCU module facilitates communication between Tasmota and the MCU using <a href=#tuya-protocols>Tuya Serial Port Communication Protocol</a>:</p> <ul> <li><code>TuyaMCU</code> command maps device functions to Tasmota components </li> <li><code>TuyaSend&lt;x&gt;</code> command calculates and sends complex serial commands using only two parameters</li> <li><code>TuyaReceived</code> MCU response interpreted and publishes as status message and a JSON payload to an MQTT topic </li> </ul> <h1 id=tuyamcu-command>TuyaMCU Command<a class=headerlink href=#tuyamcu-command title="Permanent link">~</a></h1> <p>Command <a href=../Commands/#tuyamcu><code>TuyaMCU</code></a> is used to map Tasmota components to Tuya device dpId's. </p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Used only if your device is defined as module <code>TuyaMCU (54)</code>.</p> </div> <p>Command value consists of two comma separated parameters: fnId and dpId. <div class=highlight><pre><span></span><code>TuyaMCU &lt;fnId&gt;,&lt;dpId&gt;
</code></pre></div> where <code>&lt;fnId&gt;</code> is a Tasmota component and <code>&lt;dpId&gt;</code> is the dpId to map the function to.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaMCU 11,1</code> maps Relay1 (fnId 11) to dpId 1.</p> </div> <p>If any existing entry with same <code>fnId</code> or <code>dpId</code> is already present, it will be updated to the new value. </p> <p>Entry is removed when <code>fnId</code> or <code>dpId</code> is <code>0</code>. </p> <p>When no parameters are provided <code>TuyaMCU</code> prints the current mapped values. </p> <h2 id=dpid>dpId<a class=headerlink href=#dpid title="Permanent link">~</a></h2> <p>All the device functions controlled by the MCU are identified by a dpId. <br> Whenever a command is sent to the MCU, this dpId determines which component needs to be controlled and the applies when the status is received from MCU. </p> <p><strong>There is no way to autodetect dpId's and their functions.</strong></p> <p>To assist in the process of determining what dpId does what, there is a <a href=https://github.com/sillyfrog/Tasmota-Tuya-Helper>bookmarklet available</a> that can be used on the console screen. This will send the <code>weblog</code> and other required commands automatically, and present the TuyaMCU information in a single table allowing for easier testing.</p> <p>Use this procedure to determine which dpId's are available:</p> <ol> <li>Go to <code>Configure</code> -&gt; <code>Console</code> option in Tasmota web interface.</li> <li>Use command <code>weblog 4</code> to enable verbose logging in web interface.</li> <li>Observe the log. After every 9-10 seconds you should see Tuya specific messages labelled as <code>TYA:</code>.</li> </ol> <div class=highlight><pre><span></span><code>{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000501010001000F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0101000100&quot;,&quot;DpType1Id1&quot;:0,&quot;1&quot;:{&quot;DpId&quot;:1,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=11 is set for dpId=1
TYA: RX Relay-1 --&gt; MCU State: Off Current State:Off
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005020100010010&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0201000100&quot;,&quot;DpType1Id2&quot;:0,&quot;2&quot;:{&quot;DpId&quot;:2,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=0 is set for dpId=2
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005030100010011&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0301000100&quot;,&quot;DpType1Id3&quot;:0,&quot;3&quot;:{&quot;DpId&quot;:3,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=0 is set for dpId=3
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005040100010012&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0401000100&quot;,&quot;DpType1Id4&quot;:0,&quot;4&quot;:{&quot;DpId&quot;:4,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=0 is set for dpId=4
</code></pre></div> <ol> <li>Observe all lines printed as <code>TYA: FnId=0 is set for dpId=XXX</code> and note all dpId values. </li> </ol> <p>Now that you have a list of usable dpId's you need to determine what their functions are:</p> <ol> <li>Consulting our <a href=#dpid-function-tables>list of commonly used</a> dpId's and existing device configurations</li> <li>Observing Tasmota logs while activating features of the device (with a remote or on device controls) and correlating log messages and looking at the DpIdType and DpIdData values (eg: boolean vs value)</li> <li>Extrapolating possible function of the dpId based on Data Type and Function Command, then testing using <code>TuyaSend&lt;x&gt;</code></li> </ol> <h2 id=fnid>fnId<a class=headerlink href=#fnid title="Permanent link">~</a></h2> <p>Identifier used in <code>TuyaMCU</code> command to map a dpId to a Tasmota component.</p> <table> <thead> <tr> <th>Component</th> <th>FnId</th> <th>Note</th> </tr> </thead> <tbody> <tr> <td>Switch1 to Switch4</td> <td>1 to 4</td> <td>Map only to dpId with on / off function</td> </tr> <tr> <td>Relay1 to Relay8</td> <td>11 to 18</td> <td>Map only to dpId with on / off function</td> </tr> <tr> <td>Lights</td> <td>21 to 28</td> <td>21 for Dimmer<br>22 for Dimmer2<br>23 for CCT Light<br>24 for RGB light<br>25 for white light<br>26 for light mode set (0 = white and 1 = color)<br>27 to report the state of Dimmer1<br>28 to report the state of Dimmer2</td> </tr> <tr> <td>Power Monitoring</td> <td>31 to 33</td> <td>31 for Power (in deci Watt)<br>32 for Current (in milli Amps)<br>33 for Voltage (in deci Volt)</td> </tr> <tr> <td>Relay1i to Relay8i</td> <td>41 to 48</td> <td>Map only to dpId with on / off function</td> </tr> <tr> <td>Battery powered sensor mode</td> <td>51</td> <td>Battery powered devices use a slightly different protocol</td> </tr> <tr> <td>Enum dpId</td> <td>61 to 64</td> <td>Range for each enum is 0 to 31</td> </tr> <tr> <td>Sensors</td> <td>71 to 79</td> <td>Range of sensors (temperature, humidity, co2, gas, etc)</td> </tr> <tr> <td>Timers</td> <td>81 to 84</td> <td>Manage integer based timers</td> </tr> <tr> <td>Extra functions</td> <td>97 to 99</td> <td>97 for motor direction<br>98 for error logging (report only)<br>99 as a dummy function</td> </tr> </tbody> </table> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This component is under active development which means the function list may expand in the future.</p> </div> <p>Since the majority of devices have a power on/off functions on dpId 1 it's mapped to fnId 11 (Relay1) by default. If you don't need it, map it to fnId 99 with <code>TuyaMcu 99,1</code></p> <div class="admonition danger"> <p class=admonition-title>Danger</p> <p>Mapping a relay or switch to a dpId that is not a simple on/off function (data Type 1) might result in unwanted power toggling (i.e. dpId sends value of 4 which toggles the relay to Power 4 aka blink mode)</p> </div> <h2 id=tuyasend-command>TuyaSend Command<a class=headerlink href=#tuyasend-command title="Permanent link">~</a></h2> <p>Command <code>TuyaSend</code> is used to send commands to dpId's. It is required for dpId's that shouldn't be mapped to a fnId. </p> <p>With this command it is possible to control every function of the dpId that is controllable, providing you know its data type and data length. With them provided, the rest of the protocol command is calculated.</p> <p>Command's value consists of two comma separated parameters: dpId and data. </p> <p><code>TuyaSend&lt;x&gt; dpId,data</code></p> <h4 id=tuyasend0><code>TuyaSend0</code><a class=headerlink href=#tuyasend0 title="Permanent link">~</a></h4> <p>Used without payload to query states of dpID's.</p> <h4 id=tuyasend1><code>TuyaSend1</code><a class=headerlink href=#tuyasend1 title="Permanent link">~</a></h4> <p>Sends boolean (Type 1) data (<code>0/1</code>) to dpId (Max data length 1 byte)</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaSend1 1,0</code> sends value <code>0</code> to dpId=1 switching the device off</p> </div> <h4 id=tuyasend2><code>TuyaSend2</code><a class=headerlink href=#tuyasend2 title="Permanent link">~</a></h4> <p>Sends integer or 4 byte (Type 2) data to dpId (Max data length 4 bytes)</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaSend2 14,100</code> sends value <code>100</code> to dpId=14 setting timer to 100 minutes</p> </div> <h4 id=tuyasend3><code>TuyaSend3</code><a class=headerlink href=#tuyasend3 title="Permanent link">~</a></h4> <p>Sends an ASCII string (Type 3) data to dpId (Max data length? Not known at this time). </p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Note that when sending color values, the MCU may interpret lower case and upper case hex codes differently. You may need to test with your specific MCU to ensure that the values sent properly render the color you desire. </p> </div> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaSend3 108,ff0000646464ff</code> sends a 14 char hex string to dpId=108 (Type 3) containing RGBHSV values to control a light</p> </div> <h4 id=tuyasend4><code>TuyaSend4</code><a class=headerlink href=#tuyasend4 title="Permanent link">~</a></h4> <p>Sends enum (Type 4) data (<code>0/1/2/3/4/5</code>) to dpId (Max data length 1 bytes)</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaSend4 103,2</code> sends value <code>2</code> to dpId=103 to set fan speed to high</p> </div> <h4 id=tuyasend5><code>TuyaSend5</code><a class=headerlink href=#tuyasend5 title="Permanent link">~</a></h4> <p>Sends an HEX string (Type 3) data to dpId (Max data length? Not known at this time). Does NOT require <code>0x</code> prefix.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaSend5 108, ABCD</code> sends a string of 2 bytes defined by hex codes to dpId=108</p> </div> <p>Differences between <code>TuyaSend3</code> and <code>TuyaSend5</code>:</p> <ul> <li><code>TuyaSend3 108, ABCD</code> sends <code>55aa000600086c030004414243448a</code> where the payload is <code>41424344</code> which is the ASCII bytes representing the string <code>ABCD</code></li> <li><code>TuyaSend5 108, ABCD</code> sends <code>55aa000600066c030002abcdf4</code> where the payload is a <code>abcd</code> which is a string of 2 bytes 0xAB and 0xCD </li> </ul> <h4 id=tuyasend6><code>TuyaSend6</code><a class=headerlink href=#tuyasend6 title="Permanent link">~</a></h4> <p>Sends payload with raw data <strong>(type 0)</strong> to dpId (Max data length? Not known at this time). Does NOT require <code>0x</code> prefix.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>TuyaSend6 37, 060000DC08000096</code> sends raw data defined by hex codes to dpId=37</p> </div> <p>Differences between <code>TuyaSend3</code>, <code>TuyaSend5</code> and <code>TuyaSend6</code>: * <code>TuyaSend3 and TuyaSend5</code> sends payload with the <strong>data type 0x03 = string</strong> * <code>TuyaSend6</code> sends payload with the <strong>data type 0x00 = raw</strong> </p> <h4 id=tuyasend8><code>TuyaSend8</code><a class=headerlink href=#tuyasend8 title="Permanent link">~</a></h4> <p>Used without payload to get device information and dpId states. Replaces <code>SerialSend5 55aa000100000</code></p> <h4 id=tuyasend9><code>TuyaSend9</code><a class=headerlink href=#tuyasend9 title="Permanent link">~</a></h4> <p>Use without any payload to toggle a new <code>STAT</code> topic reporting changes to a dpId, for example:</p> <div class=highlight><pre><span></span><code><span class=mi>17</span><span class=kt>:</span><span class=mi>45</span><span class=kt>:</span><span class=mi>38</span><span class=w> </span><span class=kt>MQT:</span><span class=w> </span><span class=n>stat</span><span class=o>/</span><span class=kt>TuyaMCU</span><span class=o>/</span><span class=kt>DPTYPE1ID1</span><span class=w> </span><span class=ow>=</span><span class=w> </span><span class=mi>1</span>
</code></pre></div> <h2 id=tuyareceived>TuyaReceived<a class=headerlink href=#tuyareceived title="Permanent link">~</a></h2> <p>Every status message from the MCU gets a JSON response named <code>TuyaReceived</code> which contains the MCU protocol status message inside key/value pairs which are hidden from the user by default.</p> <p>To publish them to a MQTT Topic of <code>tele/%topic%/RESULT</code> you need to enable <code>SetOption66 1</code>.</p> <p>To avoid some cyclic MCU &lt;-&gt; ESP messages published via MQTT to the topic <code>tele/%topic%/RESULT</code> you need to enable <code>SetOption137 1</code>.</p> <p>If <code>SetOption137</code> set to <code>1</code> the following cmds will not forwarded: - the heartbeat between the MCU &lt;-&gt; ESP (every 10 seconds, <code>TUYA_CMD_HEARTBEAT</code>) - the Wifi-State between the MCU &lt;-&gt; ESP (during start-up and wifi events, <code>TUYA_CMD_WIFI_STATE</code>) - the local time info query of the MCU (every minute, <code>TUYA_CMD_SET_TIME</code>) - the received update package info from MCU (during firmware update of Tuya MCU, <code>TUYA_CMD_UPGRADE_PACKAGE</code>)</p> <p>If <code>SetOption137</code> set to <code>0</code> all received Tuya MCU messages will be published. <code>SetOption137</code> is very useful to reduce the MQTT-traffic.</p> <h4 id=example>Example<a class=headerlink href=#example title="Permanent link">~</a></h4> <p>After issuing serial command <code>55aa0006000501010001010e</code> (Device power (dpId=1) is mapped to Relay1 (fnId=11)) we get the following console output (with <code>weblog 4</code>):</p> <p><div class=highlight><pre><span></span><code>19:54:18 TYA: Send &quot;55aa0006000501010001010e&quot;
19:54:18 MQT: stat/GD-30W/STATE = {&quot;Time&quot;:&quot;2019-10-25T19:54:18&quot;,&quot;Uptime&quot;:&quot;0T01:45:51&quot;,&quot;UptimeSec&quot;:6351,&quot;Heap&quot;:27,&quot;SleepMode&quot;:&quot;Dynamic&quot;,&quot;Sleep&quot;:0,&quot;LoadAvg&quot;:999,&quot;MqttCount&quot;:1,&quot;POWER1&quot;:&quot;ON&quot;,&quot;POWER2&quot;:&quot;OFF&quot;,&quot;POWER3&quot;:&quot;ON&quot;,&quot;POWER4&quot;:&quot;OFF&quot;,&quot;POWER5&quot;:&quot;ON&quot;,&quot;Dimmer&quot;:100,&quot;Fade&quot;:&quot;OFF&quot;,&quot;Speed&quot;:1,&quot;LedTable&quot;:&quot;OFF&quot;,&quot;Wifi&quot;:{&quot;AP&quot;:1,&quot;SSId&quot;:&quot;HTPC&quot;,&quot;BSSId&quot;:&quot;50:64:2B:5B:41:59&quot;,&quot;Channel&quot;:10,&quot;RSSI&quot;:24,&quot;LinkCount&quot;:1,&quot;Downtime&quot;:&quot;0T00:00:08&quot;}}
19:54:18 MQT: stat/GD-30W/RESULT = {&quot;POWER1&quot;:&quot;ON&quot;}
19:54:18 MQT: stat/GD-30W/POWER1 = ON
19:54:18 MQT: stat/GD-30W/RESULT = {&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0007000501010001010F&quot;,&quot;ChkSum&quot;:&quot;0x0F&quot;,&quot;Cmnd&quot;:7,&quot;CmndDataLen&quot;:5,&quot;CmndData&quot;:&quot;0101000101&quot;,&quot;DpId&quot;:1,&quot;DpIdType&quot;:1,&quot;DpIdLen&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}
19:54:18 TYA: fnId=11 is set for dpId=1
19:54:18 TYA: RX Relay-1 --&gt; MCU State: On Current State:On
</code></pre></div> Above <code>TYA: fnId=11 is set for dpId=1</code> you can see the JSON response for that dpId. This JSON string displays the response MCU gave to our command.</p> <p>"Data" field contains the complete response and the rest of the key/value pairs show the protocol broken into parts. "DpId", "DpIdData" and "DpIdType" are the ones we're most interested in since we can use them for <code>TuyaSend</code>.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Use command <code>TuyaSend8</code> and/or <code>TuyaSend0</code> at any time to request statuses of all dpId's from the MCU. </p> </div> <h4 id=use-in-rules>Use in Rules<a class=headerlink href=#use-in-rules title="Permanent link">~</a></h4> <p>This data can also be used as a trigger for rules using <code>TuyaReceivedData#Data=hex_string</code></p> <p><div class=highlight><pre><span></span><code><span class=kt>Rule1</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=kt>TuyaReceived</span><span class=o>#</span><span class=kt>Data</span><span class=ow>=</span><span class=mi>55</span><span class=kt>AA000700056E040001007E</span><span class=w> </span><span class=kr>do</span><span class=w> </span><span class=n>publish2</span><span class=w> </span><span class=n>stat</span><span class=o>/</span><span class=n>tuya_light</span><span class=o>/</span><span class=n>effect</span><span class=w> </span><span class=n>rgb_cycle</span><span class=w> </span><span class=n>endon</span>
</code></pre></div> will publish a status message to a custom topic when <code>55AA000700056E040001007E</code> appears in "Data" field of the response.</p> <h2 id=device-configurations>Device Configurations<a class=headerlink href=#device-configurations title="Permanent link">~</a></h2> <p>Before proceeding identify dpId's and their function.</p> <h3 id=dimmer>Dimmer<a class=headerlink href=#dimmer title="Permanent link">~</a></h3> <p>We need to configure four functions of a dimmer: </p> <ol> <li>Dimming dpId </li> <li>Dimming Range </li> <li>Dimming less than 10% </li> </ol> <h4 id=dimming-dpid>Dimming dpId<a class=headerlink href=#dimming-dpid title="Permanent link">~</a></h4> <p>The dimmer FunctionId is <code>21</code>. On a dimmer dpId generally is <code>2</code> or <code>3</code>. Try both. </p> <ol> <li>Go to the Tasmota Console and type <code>TuyaMCU 21,2</code> and wait for it to reboot. </li> <li>Enter <code>Backlog Dimmer 10; Dimmer 100</code> in the Console. </li> <li>If your bulb responds to <code>Dimmer</code> commands, you have successfully configured the dimmer FunctionId. Make note of it. </li> <li>If not try id <code>3</code> and if even <code>3</code> doesn't work keep trying Ids from all unknown Ids from the log until one works. </li> </ol> <h4 id=dimming-range>Dimming Range<a class=headerlink href=#dimming-range title="Permanent link">~</a></h4> <p>Once you have figured out the dimming functionId, we need to find the maximum dimming range. Once the dimming Id is set, the logs will continue </p> <div class=highlight><pre><span></span><code>TYA: Heartbeat  
TYA: RX Packet: &quot;55aa03070005010100010011&quot;  
TYA: RX Relay-1 --&gt; MCU State: Off Current State:Off    
TYA: RX Packet: &quot;55aa03070008020200040000000720&quot;    
TYA: FnId=21 is set for dpId=2  
TYA: RX Dim State=7 
</code></pre></div> <p>Now using the hardware buttons increase the dimmer to its maximum and observe the log. The <code>Dim State=XXX</code> shows the current dimmer level reported by MCU. Once the dimmer is at max, note this number. Again using hardware buttons decrease dimmer to minimum and note the number for minimum. <br> Now we need to tell Tasmota to use maximum and minimum values. This controlled by <a href=../Commands/#dimmerrange>DimmerRange</a> command. We can set it using <code>DimmerRange &lt;Min&gt;,&lt;Max&gt;</code> where <code>&lt;Min&gt;</code> is the minimum dimmer state and <code>&lt;Max&gt;</code> maximum dimmer state reported in logs. </p> <p>Once set, try <code>dimmer 100</code> in the Console and check if the brightness of bulb is same is the same as when the maximum was set using hardware buttons. </p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Some Tuya devices automatically send the state of a dimmer after a power off. Tasmota could misunderstand the command and try to turn on the light even with <code>SetOption20</code> and <code>SetOption54</code> enabled.</p> </div> <h3 id=dual-dimmer>Dual Dimmer<a class=headerlink href=#dual-dimmer title="Permanent link">~</a></h3> <p>To enable a dual dimmer setup assign fnId's:</p> <ul> <li><code>21</code> as Dimmer1</li> <li><code>22</code> as Dimmer2</li> <li><code>11</code> as Relay1</li> <li><code>12</code> as Relay2</li> </ul> <p>Tasmota will automatically enable <code>SetOption68</code> and the dimmers will respond to <code>Channel1</code> and <code>Channel2</code> commands.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The use of SetOption68 is limited to two channels and will be automatically disabled if any other combination of lights is used.</p> </div> <h3 id=lights>Lights<a class=headerlink href=#lights title="Permanent link">~</a></h3> <h4 id=cct-light>CCT Light<a class=headerlink href=#cct-light title="Permanent link">~</a></h4> <p>To enable a CCT light assign fnId's:</p> <ul> <li><code>21</code> as Dimmer1</li> <li><code>11</code> as Relay1</li> <li><code>23</code> as CT channel</li> </ul> <h4 id=rgb-light>RGB Light<a class=headerlink href=#rgb-light title="Permanent link">~</a></h4> <p>To enable an RGB light assign fnId's:</p> <ul> <li><code>21</code> as Dimmer1</li> <li><code>11</code> as Relay1</li> <li><code>24</code> as RGB controller</li> </ul> <p>TuyaMCU uses different types of RGB Hex format where the most recent is <code>0HUE0SAT0BRI0</code> (type 1) and the older being <code>RRGGBBFFFF6464</code> (type 2). Depending on the MCU, code can be case sensitive.</p> <p>After enabling the RGB function check the TuyaReceived information and use <code>TuyaRGB</code> to configure and store the correct (or the closest) format:</p> <ul> <li><code>TuyaRGB 0</code> - Type 1, 12 characters uppercase. Example: <code>00DF00DC0244</code> <em>(default)</em></li> <li><code>TuyaRGB 1</code> - Type 1, 12 characters lowercase. Example: <code>008003e8037a</code></li> <li><code>TuyaRGB 2</code> - Type 2, 14 characters uppercase. Example: <code>00FF00FFFF6464</code></li> <li><code>TuyaRGB 3</code> - Type 2, 14 characters lowercase. Example: <code>00e420ffff6464</code></li> </ul> <p><code>TuyaRGB</code> without payload will return the actual configured format.</p> <h4 id=rgbx-light>RGB+X Light<a class=headerlink href=#rgbx-light title="Permanent link">~</a></h4> <p>To enable an RGB+W light use RGB Light configuration and assign fnId <code>25</code> as white color.</p> <p>To enable an RGB+CCT light use RGB Light configuration and assign fnId <code>23</code> as CT channel.</p> <h4 id=light-mode-selector>Light mode selector<a class=headerlink href=#light-mode-selector title="Permanent link">~</a></h4> <p>The majority of  TuyaMCU devices with an RGB+W or an RGB+CCT light have a button or app function to switch between White and Colored light. </p> <p>To do the same in Tasmota, assign function (fnId) <code>26</code> to the mode select dpId. The possible values are 0 (white) and 1 (colorful). A button on the WebUI will be available once configured.</p> <p>When the ModeSet function is enabled it is not possible to update both lights at the same time. Only the currently selected light mode will be updated. </p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Use of <code>SetOption68</code> for more than two channels and the light split option (<code>SetOption37 &gt;= 128</code>) are not supported in TuyaMCU mode.</p> </div> <h3 id=enums>Enums<a class=headerlink href=#enums title="Permanent link">~</a></h3> <p>Better control over Type4 or enum dpId's. Up to four can be added, with a range from 0 to 31.</p> <ul> <li><code>61</code> as Enum1</li> <li><code>62</code> as Enum2</li> <li><code>63</code> as Enum3</li> <li><code>64</code> as Enum4</li> </ul> <p>After an enum is configured, use <code>TuyaEnumList</code> to declare the range it must respect (note <code>0</code> is always the first item in range).</p> <p><code>TuyaEnumlist &lt;enum&gt;,&lt;range&gt;</code> where <code>&lt;enum&gt;</code> is declared using <code>TuyaMCU</code> and <code>&lt;range&gt;</code> is <code>0..31</code>.</p> <p>Example: configure Enum 1 with a range from 0 to 8. <div class=highlight><pre><span></span><code><span class=mi>21</span><span class=p>:</span><span class=mi>14</span><span class=p>:</span><span class=mi>52</span> <span class=n>CMD</span><span class=p>:</span> <span class=n>tuyaenumlist</span> <span class=mi>1</span><span class=p>,</span><span class=mi>8</span>
<span class=mi>21</span><span class=p>:</span><span class=mi>14</span><span class=p>:</span><span class=mi>52</span> <span class=n>MQT</span><span class=p>:</span> <span class=n>stat</span><span class=o>/</span><span class=n>TuyaMCU</span><span class=o>/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;TuyaEnumList&quot;</span><span class=p>:{</span><span class=s2>&quot;Enum1&quot;</span><span class=p>:</span><span class=mi>8</span><span class=p>,</span><span class=s2>&quot;Enum2&quot;</span><span class=p>:</span><span class=mi>9</span><span class=p>,</span><span class=s2>&quot;Enum4&quot;</span><span class=p>:</span><span class=mi>1</span><span class=p>}}</span>
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>Entering a value greater than <code>31</code> will return an error</p> </div> <p><code>TuyaEnumList</code> without payload will return the configuration of all the enums enabled in the list.</p> <p>To update an enum use the command <code>TuyaEnum</code>:</p> <p>Usage <code>TuyaEnum [1|2|3|4],[TuyaEnumList range]</code></p> <p>Example: update Enum 2 to 4. <div class=highlight><pre><span></span><code><span class=mi>21</span><span class=p>:</span><span class=mi>14</span><span class=p>:</span><span class=mi>12</span> <span class=n>CMD</span><span class=p>:</span> <span class=n>tuyaenum2</span> <span class=mi>4</span>
<span class=mi>21</span><span class=p>:</span><span class=mi>14</span><span class=p>:</span><span class=mi>12</span> <span class=n>MQT</span><span class=p>:</span> <span class=n>stat</span><span class=o>/</span><span class=n>TuyaMCU</span><span class=o>/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;TuyaEnum2&quot;</span><span class=p>:</span><span class=mi>4</span><span class=p>}</span>
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>Entering a value not in range will return an error</p> </div> <p><code>TuyaEnum</code> without payload will return the state of all the enums configured.</p> <h3 id=sensors>Sensors<a class=headerlink href=#sensors title="Permanent link">~</a></h3> <p>These are the currently available sensors:</p> <ul> <li><code>71</code> as Temperature Sensor</li> <li><code>73</code> as Humidity Sensor</li> <li><code>75</code> as Illuminance Sensor</li> <li><code>76</code> as TVOC Sensor</li> <li><code>77</code> as CO<sub>2</sub> Sensor</li> <li><code>78</code> as ECO<sub>2</sub> Sensor</li> <li><code>79</code> as %LEL gas Sensor</li> </ul> <p>If your device has a dpId for setting a specific Temperature and/or Humidity:</p> <ul> <li><code>72</code> for Temperature Set</li> <li><code>74</code> for Humidity Set</li> </ul> <p>Use <code>TuyaSend2</code> to manage them.</p> <p>Temperature and Temperature Set default to <code>°C</code>. If you need <code>°F</code> change <code>SetOption8</code> to <code>1</code>.</p> <p>The TuyaMCU driver sends the temperature as a byte integer. As of 9.3.x, the integer is converted by Tasmota to a float based on the "TempRes" setting which indicates the number of places after the decimal. The TempRes setting is by default "1" which means a device which sends 101 will be interpreted as 10.1. If your device normally returns an integer temperature, you may need to set TempRes to "0".</p> <p>If your device requires the temperature to be divided (eg. increases in .5° increments), you may need to use the <a href=../Rules/#adjust-a-value-and-send-it-over-mqtt>rules</a> functionality to convert the temperature value.</p> <p>Please note this will not update the value sent by the MCU but will just change the unit of measure reported on <code>/SENSOR</code> topic. You have to find a dpid to set the correct unit and change reported values (if it exists) or perhaps use the <a href=../Rules/#adjust-a-value-and-send-it-over-mqtt>rules</a> functionality to do the conversion.</p> <h3 id=timers>Timers<a class=headerlink href=#timers title="Permanent link">~</a></h3> <p>4 Type2 (integer) timers can be managed directly from Tasmota</p> <ul> <li><code>81</code> as Timer1</li> <li><code>82</code> as Timer2</li> <li><code>83</code> as Timer3</li> <li><code>84</code> as Timer4</li> </ul> <p>Timers can be managed with <code>TuyaSend2</code> and are visible in the WebUI.</p> <h3 id=covers>Covers<a class=headerlink href=#covers title="Permanent link">~</a></h3> <p>Single shutter or double shutters devices can be managed with a dimmer setup For devices that are reporting position to another dpId assign fnId's:</p> <ul> <li><code>27</code> to report the state of Dimmer1</li> <li><code>28</code> to report the state of Dimmer2</li> </ul> <p>If your cover device has a motor direction change option assign fnId <code>97</code> for motor direction.</p> <h3 id=switches>Switches<a class=headerlink href=#switches title="Permanent link">~</a></h3> <p>There is currently no way to detect the number of relays present in an MCU based switch. We need to tell the number of relays to Tasmota using FunctionIDs 12 to 18 for Relay2 to Relay4.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p>For a 4 gang switch set <code>TuyaMCU 12,2</code>, <code>TuyaMCU 13,3</code> and <code>TuyaMCU 14,4</code> if the dpIds for Relays 2-4 are <code>2</code>,<code>3</code>,<code>4</code>. </p> </div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You can configure all at once by using <code>Backlog TuyaMCU 12,2; TuyaMCU 13,3; TuyaMCU 14,4</code> </p> </div> <!--
### Curtain Motors  
The Zemismart WiFi curtain motor uses a Tuya TYWE1S inside the little white dongle as a radio modem.    
`U1TX` is connected to "USB D+", `U1RX` is connected to "USB D-", and there is a blue LED in the dongle connected to "USB3 R-" controlled by the MCU. To flash Tasmota, we need `U0RX`, `U0TX`, and `GPIO0`. None of which are broken out on the PCB, so soldering or Tuya-Convert are necessary.   

The stock Tuya App communicates with the PIC Micro inside the motor housing at 9600 8N1.    

* `dpId 101` is the "partial open/partial close" command with a 4 byte field of 0-100%.     
* `dpId 102` is a "fully open/fully close" command with a 1-byte Boolean field.     
* `dpId 103` is unknown.    

#### Debugging  
<div class="highlight"><pre><span></span><code>55 aa 00 06 &quot;deliver dp&quot; 0005 &quot;len=5&quot; 66 04 00 01 &lt;00=close100%,01=open0%&gt; &lt;chksum&gt; is the fully open/close command 
07 &quot;report dp&quot; 0005 (len) 66 04 00 01 &lt;00 or 01&gt; &lt;chksum&gt; is the reply. 
55 aa 00 06 &quot;deliver dp&quot; 0008 (len=8) 65 02 00 04  &lt;value.32 &lt;chksum&gt; is the move partial command   
55 aa 00 07 &quot;report dp&quot; 0008 (len=8) 65 02 00 04 &lt;value.32&gt; &lt;chksum&gt; is the reply.  
</code></pre></div>

There may first be a reply of 65 02 00 04 <oldvalue.32> <chksum> before the motor engages   

#### dpId Configuration 
1. `module 54` # TuyaMCU (will reboot)  
2. `backlog gpio1 0; gpio3 0; gpio15 107; gpio13 108` # change GPIO assignments. The dongle uses gpio15 for U1TX and gpio13 for U1RX (will reboot)  
3. `tuyamcu 21,101` # declare curtain as a dimmer (will reboot) 
4. \# no idea what a good tuyamcu xx,102 is 
5. \# no idea what a good tuyamcu xx,103 is 
6. `setoption 69 0` # allow dimmer below 25% or 10%. (won't reboot) 

With these settings, the `dimmer` command can adjust the curtain from 100% (closed) to 1% (almost fully open, 0% is the motor limit, but 1% is the Tasmota limit?)  

#### Things That Did Not Work   
<div class="highlight"><pre><span></span><code><span class="n">tuyamcu</span> <span class="mi">1</span><span class="p">,</span><span class="mi">102</span> <span class="o">#</span> <span class="n">make</span> <span class="mh">0x66</span> <span class="n">a</span> <span class="n">button</span>  
<span class="n">tuyamcu</span> <span class="mi">1</span><span class="p">,</span><span class="mi">103</span> <span class="o">#</span> <span class="n">make</span> <span class="mh">0x67</span> <span class="n">a</span> <span class="n">button</span>  
</code></pre></div>
Having 0x66 declared a button caused the motor to oscillate - open part way and then close again. Like Tasmota was sending the "fully open" command and then immediately cancelling it with a "partial close" command.  
<div class="highlight"><pre><span></span><code><span class="n">tuyamcu</span> <span class="mi">11</span><span class="p">,</span><span class="mi">102</span> <span class="o">#</span> <span class="n">make</span> <span class="mh">0x66</span> <span class="n">a</span> <span class="n">relay</span>  
<span class="n">tuyamcu</span> <span class="mi">11</span><span class="p">,</span><span class="mi">103</span> <span class="o">#</span> <span class="n">make</span> <span class="mh">0x67</span> <span class="n">a</span> <span class="n">relay</span>  
</code></pre></div>
Does not appear to have any impact on the curtain. 

### Aromatherapy Diffuser
Applies to devices using the PCB marked GD-HDFW05-v1.0. 

![image](https://user-images.githubusercontent.com/5904370/67526288-c4559500-f6b4-11e9-867f-2b3ae0b82437.png ":size=100")

This diffuser uses the same dpId scheme as the [example protocol](#aromatherapy-machine-oil-diffuser)

#### Functions
`dpID 1` device power: 0 = off / 1 = on    
`dpID 11` led power: 0 = off / 1 = on    
`dpID 12` error notification: 0 = ok / 1 = error  
`dpID 13` countdown mode options: 0 = off / 1 = 1hr / 2 = 3hr *not needed with Tasmota*    
`dpID 14` countdown status: reports value of 0...360 minutes *not needed with Tasmota*    
`dpID 103` mist strength: 0 = low / 1 = high    
`dpID 108` led color: 14 char value in hex (can define only RGB and send HSV value as max: `RRGGBBffff6464`)    
`dpID 110` led mode: 0 = rgb_cycle / 1 = color / 2 = white    
`dpID 110` led dimmer **color and white modes only** *it is important to define 'DimmerRange 1,255'*

#### Configuration

After applying the template and configuring Wi-Fi and MQTT issue

<div class="highlight"><pre><span></span><code><span class="n">Backlog</span> <span class="n">SetOption66</span> <span class="mi">1</span><span class="p">;</span> <span class="n">TuyaMCU</span> <span class="mi">21</span><span class="p">,</span><span class="mi">111</span><span class="p">;</span> <span class="n">TuyaMCU</span> <span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span> <span class="n">TuyaMCU</span> <span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">;</span> <span class="n">TuyaMCU</span> <span class="mi">13</span><span class="p">,</span><span class="mi">103</span><span class="p">;</span> <span class="n">TuyaMCU</span> <span class="mi">14</span><span class="p">,</span><span class="mi">12</span><span class="p">;</span> <span class="n">TuyaMCU</span> <span class="mi">15</span><span class="p">,</span><span class="mi">110</span><span class="p">;</span> <span class="n">DimmerRange</span> <span class="mi">1</span><span class="p">,</span><span class="mi">255</span><span class="p">;</span> <span class="n">SetOption59</span> <span class="mi">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">Rule1</span> <span class="n">on</span> <span class="n">TuyaReceived</span><span class="o">#</span><span class="n">data</span><span class="o">=</span><span class="mi">55</span><span class="n">AA000700056E040001007E</span> <span class="kr">do</span> <span class="n">publish2</span> <span class="n">stat</span><span class="o">/</span><span class="n">GD</span><span class="o">-</span><span class="mi">30</span><span class="n">W</span><span class="o">/</span><span class="n">EFFECT</span> <span class="n">rgb_cycle</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">TuyaReceived</span><span class="o">#</span><span class="n">data</span><span class="o">=</span><span class="mi">55</span><span class="n">AA000700056E040001017F</span> <span class="kr">do</span> <span class="n">publish2</span> <span class="n">stat</span><span class="o">/</span><span class="n">GD</span><span class="o">-</span><span class="mi">30</span><span class="n">W</span><span class="o">/</span><span class="n">EFFECT</span> <span class="n">color</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">event</span><span class="o">#</span><span class="n">rgb_cycle</span> <span class="kr">do</span> <span class="n">tuyasend4</span> <span class="mi">110</span><span class="p">,</span><span class="mi">0</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">event</span><span class="o">#</span><span class="n">color</span> <span class="kr">do</span> <span class="n">tuyasend4</span> <span class="mi">110</span><span class="p">,</span><span class="mi">1</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">event</span><span class="o">#</span><span class="n">ON</span> <span class="kr">do</span> <span class="n">backlog</span> <span class="n">tuyasend4</span> <span class="mi">110</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span> <span class="n">tuyasend</span> <span class="mi">11</span><span class="p">,</span><span class="mi">1</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">event</span><span class="o">#</span><span class="n">off</span> <span class="kr">do</span> <span class="n">tuyasend1</span> <span class="mi">11</span><span class="p">,</span><span class="mi">0</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">power3</span><span class="o">#</span><span class="n">state</span><span class="o">=</span><span class="mi">1</span> <span class="kr">do</span> <span class="n">tuyasend4</span> <span class="mi">103</span><span class="p">,</span><span class="mi">1</span> <span class="n">endon</span> <span class="n">on</span> <span class="n">power3</span><span class="o">#</span><span class="n">state</span><span class="o">=</span><span class="mi">0</span> <span class="kr">do</span> <span class="n">tuyasend4</span> <span class="mi">103</span><span class="p">,</span><span class="mi">0</span> <span class="n">endon</span>
<span class="n">Rule1</span> <span class="mi">1</span>
</code></pre></div>

*Optional rule used to prevent the device going into countdown mode (i.e. using on device controls) and complete MCU status update on restart*

<div class="highlight"><pre><span></span><code><span class="kt">Rule3</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="kt">TuyaReceived</span><span class="o">#</span><span class="kr">data</span><span class="ow">=</span><span class="mi">55</span><span class="kt">AA000700050D040001011E</span><span class="w"> </span><span class="kr">do</span><span class="w"> </span><span class="n">tuyasend4</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="n">endon</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="kt">TuyaReceived</span><span class="o">#</span><span class="kr">data</span><span class="ow">=</span><span class="mi">55</span><span class="kt">AA000700050D040001021F</span><span class="w"> </span><span class="kr">do</span><span class="w"> </span><span class="n">tuyasend4</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="n">endon</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">mqtt</span><span class="o">#</span><span class="n">connected</span><span class="w"> </span><span class="kr">do</span><span class="w"> </span><span class="n">serialsend5</span><span class="w"> </span><span class="mi">55</span><span class="n">aa0001000000</span><span class="w"> </span><span class="n">endon</span>
<span class="kt">Rule3</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
[All commands in .txt](https://gist.github.com/blakadder/2d112b50edd8f75f2d7fb0dddd9310c4)

#### What you get
- Relay1 turns the diffuser on or off in stored mist strength mode, turns led on or off in stored mode and serves as device power status
- Relay2 turns light on or off and serves as light power status.
- Relay3 mist strength status and control using `Rule1`
- Relay4 is used for error status (ON = error), no control
- Relay5 is used for light mode status (0 = rgb_cycle, 1 = color), no control

LED mode status is reported to mqtt topic `stat/GD-30W/EFFECT` and command [`Event`](Commands.md#event) is used to control some functions using [`TuyaSend4`](Commands.md#tuyasend4) command. All this is defined in `Rule1`

Color can be changed using `TuyaSend3 108,RRGGBB64646464` (RR, GG and BB are hex value) only in color mode.

Dimming works using slider and `Dimmer` command but only when in color mode, in rgb_cycle there are no brightness controls.

Long press on device's power button initiates Tasmota's Wi-Fi config --> <h3 id=power-metering>Power Metering<a class=headerlink href=#power-metering title="Permanent link">~</a></h3> <p>Some Tuya MCU devices support Power measurement support over serial. For this it is better to use a bulb with known wattage rating. </p> <p>Observe the logs in the Console </p> <div class=highlight><pre><span></span><code>TYA: Heartbeat
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000501010001000F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0101000100&quot;,&quot;DpType1Id1&quot;:0,&quot;1&quot;:{&quot;DpId&quot;:1,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=11 is set for dpId=1
TYA: RX Relay-1 --&gt; MCU State: Off Current State:Off
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005020100010111&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0201000101&quot;,&quot;DpType1Id2&quot;:1,&quot;2&quot;:{&quot;DpId&quot;:2,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}}
TYA: fnId=0 is set for dpId=2
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005030100010011&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0301000100&quot;,&quot;DpType1Id3&quot;:0,&quot;3&quot;:{&quot;DpId&quot;:3,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=0 is set for dpId=3
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005040100010113&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0401000101&quot;,&quot;DpType1Id4&quot;:1,&quot;4&quot;:{&quot;DpId&quot;:4,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}}
TYA: fnId=0 is set for dpId=4
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000807020004000000001C&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0702000400000000&quot;,&quot;DpType2Id7&quot;:0,&quot;7&quot;:{&quot;DpId&quot;:7,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=7
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000808020004000000001D&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0802000400000000&quot;,&quot;DpType2Id8&quot;:0,&quot;8&quot;:{&quot;DpId&quot;:8,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=8
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000809020004000000001E&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0902000400000000&quot;,&quot;DpType2Id9&quot;:0,&quot;9&quot;:{&quot;DpId&quot;:9,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=9
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA010700080A020004000000001F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0A02000400000000&quot;,&quot;DpType2Id10&quot;:0,&quot;10&quot;:{&quot;DpId&quot;:10,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=10
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000865020004000000007A&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6502000400000000&quot;,&quot;DpType2Id101&quot;:0,&quot;101&quot;:{&quot;DpId&quot;:101,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=101
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070008660200040000009813&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6602000400000098&quot;,&quot;DpType2Id102&quot;:152,&quot;102&quot;:{&quot;DpId&quot;:102,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000098&quot;}}}
TYA: fnId=0 is set for dpId=102
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070008670200040000017EFB&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;670200040000017E&quot;,&quot;DpType2Id103&quot;:382,&quot;103&quot;:{&quot;DpId&quot;:103,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;0000017E&quot;}}}
TYA: fnId=0 is set for dpId=103
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000868020004000009951B&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6802000400000995&quot;,&quot;DpType2Id104&quot;:2453,&quot;104&quot;:{&quot;DpId&quot;:104,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000995&quot;}}}
TYA: fnId=0 is set for dpId=104
</code></pre></div> <p>In the <code>TuyaReceived</code> we are interested in <code>DpIdData</code>. For example: <code>00000995</code> is the second last entry. </p> <ul> <li>Make sure the bulb if off. </li> <li>Find out the voltage standard of your country (generally 220, 240, 120v) from this <a href=https://www.worldstandards.eu/electricity/plug-voltage-by-country/ >table</a>. </li> <li>Multiply that number by 10 (2400) and Convert that number (2400) to Hex using any <a href=https://www.binaryhexconverter.com/decimal-to-hex-converter>hex converter</a> (2400 = 0x960) </li> <li>Now look for the number nearest to <code>960</code> in the logs. In our case it is <code>00000995</code>. So we expect that's the voltage which is <code>"DpId":104</code> in our example.</li> <li>Set voltage functionId <code>33</code> by entering <code>TuyaMCU 33,104</code>. </li> <li>Now set dimmer to 100% using the <code>dimmer 100</code> command, or power on using <code>power1 on</code> (depending on the device) and observe the logs. </li> <li>Now we need the power rating of your bulb, for example <code>40W</code>. Multiply by 10 (400) and convert to hex which gives us 0x190. Check which unknown ID is close to <code>190</code>. I this example it is <code>17E</code> for <code>"DpId":103</code>. This is the Id of <code>Active Power</code> function. </li> <li>Set the active power functionId <code>31</code> by entering <code>TuyaMCU 31,103</code>. </li> <li>Once Power and Voltage are set you should see something such as this in the logs: <div class=highlight><pre><span></span><code>TYA: Heartbeat
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000501010001000F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0101000100&quot;,&quot;DpType1Id1&quot;:0,&quot;1&quot;:{&quot;DpId&quot;:1,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=11 is set for dpId=1
TYA: RX Relay-1 --&gt; MCU State: Off Current State:Off
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005020100010111&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0201000101&quot;,&quot;DpType1Id2&quot;:1,&quot;2&quot;:{&quot;DpId&quot;:2,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}}
TYA: fnId=0 is set for dpId=2
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005030100010011&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0301000100&quot;,&quot;DpType1Id3&quot;:0,&quot;3&quot;:{&quot;DpId&quot;:3,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=0 is set for dpId=3
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005040100010113&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0401000101&quot;,&quot;DpType1Id4&quot;:1,&quot;4&quot;:{&quot;DpId&quot;:4,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}}
TYA: fnId=0 is set for dpId=4
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000807020004000000001C&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0702000400000000&quot;,&quot;DpType2Id7&quot;:0,&quot;7&quot;:{&quot;DpId&quot;:7,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=7
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000808020004000000001D&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0802000400000000&quot;,&quot;DpType2Id8&quot;:0,&quot;8&quot;:{&quot;DpId&quot;:8,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=8
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000809020004000000001E&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0902000400000000&quot;,&quot;DpType2Id9&quot;:0,&quot;9&quot;:{&quot;DpId&quot;:9,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=9
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA010700080A020004000000001F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0A02000400000000&quot;,&quot;DpType2Id10&quot;:0,&quot;10&quot;:{&quot;DpId&quot;:10,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=10
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000865020004000000007A&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6502000400000000&quot;,&quot;DpType2Id101&quot;:0,&quot;101&quot;:{&quot;DpId&quot;:101,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=101
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070008660200040000009712&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6602000400000097&quot;,&quot;DpType2Id102&quot;:151,&quot;102&quot;:{&quot;DpId&quot;:102,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000097&quot;}}}
TYA: fnId=0 is set for dpId=102
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070008670200040000017BF8&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;670200040000017B&quot;,&quot;DpType2Id103&quot;:379,&quot;103&quot;:{&quot;DpId&quot;:103,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;0000017B&quot;}}}
TYA: fnId=31 is set for dpId=103
TYA: Rx ID=103 Active_Power=379
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000868020004000009961C&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6802000400000996&quot;,&quot;DpType2Id104&quot;:2454,&quot;104&quot;:{&quot;DpId&quot;:104,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000996&quot;}}}
TYA: fnId=33 is set for dpId=104
TYA: Rx ID=104 Voltage=2454
</code></pre></div></li> <li>To get the Id for the current, calculate Current = Power / Voltage ( 37.9 / 245.4 ) = ~0.1544 (Remember to divide each value by 10). Multiply this by 1000 = 154. Now convert 154 to hex which is 0x9A. This is closest to <code>97</code> which is Id <code>"DpId":102</code>. </li> <li>Set the current FunctionId <code>32</code> using command <code>TuyaMCU 32,102</code>. </li> <li>Observe the logs should start showing Current in addition to Active_Power and Voltage <div class=highlight><pre><span></span><code>TYA: Heartbeat
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000501010001000F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0101000100&quot;,&quot;DpType1Id1&quot;:0,&quot;1&quot;:{&quot;DpId&quot;:1,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=11 is set for dpId=1
TYA: RX Relay-1 --&gt; MCU State: Off Current State:Off
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005020100010111&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0201000101&quot;,&quot;DpType1Id2&quot;:1,&quot;2&quot;:{&quot;DpId&quot;:2,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}}
TYA: fnId=0 is set for dpId=2
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005030100010011&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0301000100&quot;,&quot;DpType1Id3&quot;:0,&quot;3&quot;:{&quot;DpId&quot;:3,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;00&quot;}}}
TYA: fnId=0 is set for dpId=3
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070005040100010113&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0401000101&quot;,&quot;DpType1Id4&quot;:1,&quot;4&quot;:{&quot;DpId&quot;:4,&quot;DpIdType&quot;:1,&quot;DpIdData&quot;:&quot;01&quot;}}}
TYA: fnId=0 is set for dpId=4
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000807020004000000001C&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0702000400000000&quot;,&quot;DpType2Id7&quot;:0,&quot;7&quot;:{&quot;DpId&quot;:7,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=7
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000808020004000000001D&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0802000400000000&quot;,&quot;DpType2Id8&quot;:0,&quot;8&quot;:{&quot;DpId&quot;:8,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=8
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000809020004000000001E&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0902000400000000&quot;,&quot;DpType2Id9&quot;:0,&quot;9&quot;:{&quot;DpId&quot;:9,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=9
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA010700080A020004000000001F&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;0A02000400000000&quot;,&quot;DpType2Id10&quot;:0,&quot;10&quot;:{&quot;DpId&quot;:10,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=10
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000865020004000000007A&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6502000400000000&quot;,&quot;DpType2Id101&quot;:0,&quot;101&quot;:{&quot;DpId&quot;:101,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000000&quot;}}}
TYA: fnId=0 is set for dpId=101
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070008660200040000009712&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6602000400000097&quot;,&quot;DpType2Id102&quot;:151,&quot;102&quot;:{&quot;DpId&quot;:102,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000097&quot;}}}
TYA: fnId=32 is set for dpId=102
TYA: Rx ID=102 Current=151
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA01070008670200040000017BF8&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;670200040000017B&quot;,&quot;DpType2Id103&quot;:379,&quot;103&quot;:{&quot;DpId&quot;:103,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;0000017B&quot;}}}
TYA: fnId=31 is set for dpId=103
TYA: Rx ID=103 Active_Power=379
{&quot;TuyaReceived&quot;:{&quot;Data&quot;:&quot;55AA0107000868020004000009961C&quot;,&quot;Cmnd&quot;:7,&quot;CmndData&quot;:&quot;6802000400000996&quot;,&quot;DpType2Id104&quot;:2454,&quot;104&quot;:{&quot;DpId&quot;:104,&quot;DpIdType&quot;:2,&quot;DpIdData&quot;:&quot;00000996&quot;}}}
TYA: fnId=33 is set for dpId=104
TYA: Rx ID=104 Voltage=2454
</code></pre></div></li> <li>Power and current should change on dimming high / low or turning the device on and off. The Tasmota web UI should show power values now on the home page.</li> </ul> <h3 id=battery-powered-sensors>Battery Powered Sensors<a class=headerlink href=#battery-powered-sensors title="Permanent link">~</a></h3> <ul> <li><a href=https://templates.blakadder.com/TYMC-1.html>TYMC-1 Door/Window Sensor</a></li> <li><a href=https://templates.blakadder.com/TY01.html>TY-01 Door/Window Sensor</a></li> <li><a href=https://templates.blakadder.com/PA-210WYS.html>Gas Sensor</a></li> <li><a href=https://templates.blakadder.com/YG400A.html>Smoke Sensor</a></li> <li><a href=https://templates.blakadder.com/lenovo_ZG38C02927.html>PIR Sensor</a></li> </ul> <h3 id=specific-devices>Specific Devices<a class=headerlink href=#specific-devices title="Permanent link">~</a></h3> <ul> <li><a href=https://templates.blakadder.com/blitzwolf_BW-FUN3.html>Aromatherapy Diffuser</a></li> <li><a href=https://templates.blakadder.com/proficook_PC-WKS_1167.html>Water Kettle</a></li> <li><a href=https://templates.blakadder.com/alfawise_P2.html>Air Purifier</a></li> <li><a href=https://templates.blakadder.com/neo_coolcam_NAS-MA01W.html>Mouse Trap</a></li> <li><a href=https://templates.blakadder.com/proscenic_807C.html>Humidifer</a></li> </ul> <h2 id=tuya-protocols>Tuya Protocols<a class=headerlink href=#tuya-protocols title="Permanent link">~</a></h2> <p>The MCU communicates with the Wi-Fi module through the serial port with a Tuya specified protocol. Those are classified into basic and functional protocols. </p> <h2 id=basic-protocols>Basic protocols<a class=headerlink href=#basic-protocols title="Permanent link">~</a></h2> <p>They are common protocols integrated in Tasmota's TuyaMCU module. They stay the same for each product and are mandatory for Tuya module to work correctly. </p> <h2 id=functional-protocols>Functional protocols<a class=headerlink href=#functional-protocols title="Permanent link">~</a></h2> <p>Functional protocols are used for delivering and reporting data of functions. These protocols differ between devices and manufacturers and might require configuration in Tasmota using <a href=#tuyamcu><code>TuyaMCU</code></a> command or with <a href=#tuyasend><code>TuyaSend&lt;x&gt;</code></a> command.</p> <h2 id=anatomy-of-tuya-protocol>Anatomy of Tuya Protocol<a class=headerlink href=#anatomy-of-tuya-protocol title="Permanent link">~</a></h2> <table> <thead> <tr> <th>Name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Frame Header Version</td> <td>Fixed value of 0x55aa</td> </tr> <tr> <td>Command Word</td> <td><code>0x06</code> - send commands<br><code>0x07</code> - report status</td> </tr> <tr> <td>Data Length</td> <td>defines expected length of data</td> </tr> <tr> <td>dpID</td> <td>numbered ID of a function (DP = Data Point or Define Product)</td> </tr> <tr> <td>Data Type</td> <td><a href=#data-type-table>see Data Type table below</a></td> </tr> <tr> <td>Function Length</td> <td>length of command</td> </tr> <tr> <td>Function Command</td> <td>formatted according to Data Type</td> </tr> <tr> <td>Verification Method</td> <td>checksum = remainder of the byte sum starting from Frame Header to 256</td> </tr> </tbody> </table> <p><a id=data-type-table></a></p> <h4 id=data-type>Data Type<a class=headerlink href=#data-type title="Permanent link">~</a></h4> <table> <thead> <tr> <th>Hex</th> <th>Tasmota Command</th> <th>Description</th> <th>Max length</th> </tr> </thead> <tbody> <tr> <td>0x00</td> <td>TuyaSend6</td> <td>raw data</td> <td>unknown</td> </tr> <tr> <td>0x01</td> <td>TuyaSend1</td> <td>boolean data <code>0/1</code></td> <td>1 byte</td> </tr> <tr> <td>0x02</td> <td>TuyaSend2</td> <td>value data. If a value contains less than 4 bytes, 0 is supplemented before</td> <td>4 bytes</td> </tr> <tr> <td>0x00</td> <td>TuyaSend3</td> <td>string data</td> <td>unknown</td> </tr> <tr> <td>0x04</td> <td>TuyaSend4</td> <td>enum data <code>0/1/2/3/4/5</code></td> <td>1 byte</td> </tr> <tr> <td>0x05</td> <td>###</td> <td>fault data, report only</td> <td>8 bytes</td> </tr> </tbody> </table> <p>Let's dissect and explain the MCU protocol using serial command <code>55aa0006000501010001010e</code>:</p> <table> <thead> <tr> <th align=center>Frame Header Version</th> <th align=center>Command Word</th> <th align=center>Data Length</th> <th align=center>dpID</th> <th align=center>Data Type</th> <th align=center>Function Length</th> <th align=center>Function Command</th> <th align=center>Verification Method</th> </tr> </thead> <tbody> <tr> <td align=center>55aa00</td> <td align=center>06</td> <td align=center>0005</td> <td align=center>01</td> <td align=center>01</td> <td align=center>0001</td> <td align=center>01</td> <td align=center>0e</td> </tr> </tbody> </table> <p>This is the command which powers on the device sending Function Command = <code>1</code> to dpID 1 (Switch): </p> <ul> <li>Frame Header Version = <code>0x55aa00</code> which is a fixed value and always the same</li> <li>Command Word = <code>0x06</code> because we're sending a command</li> <li>Data Type = <code>0x01</code> since the command sent is a 1 byte boolean</li> <li>Function Length = <code>0x001</code> instruct 1 character only for function command length</li> <li>Function Command = <code>0x01</code> in hex which equals <code>1</code> in int</li> <li>Verification Method = <code>0e</code> is calculated</li> </ul> <h4 id=protocol-flow>Protocol flow<a class=headerlink href=#protocol-flow title="Permanent link">~</a></h4> <p>On device boot, TuyaMCU executes the required basic protocols and reads the functional protocol data received, which are used to update status of components mapped in TuyaMCU (Relays, dimmer, power monitoring data).</p> <p>After receiving a command from Tasmota (Command Word <code>0x06</code>), the MCU performs corresponding logical control. When the dpID status is changed, the MCU reports the data (Command Word <code>0x07</code>) to TuyaMCU component. </p> <h2 id=dpid-function-tables>dpId Function Tables<a class=headerlink href=#dpid-function-tables title="Permanent link">~</a></h2> <div class="admonition warning"> <p class=admonition-title>This information is just for orientation. Functions are assigned by the manufacturer and can be on different dpId's</p> </div> <ul> <li>DP ID: dpId.</li> <li>Function Point：Used to describe the product function.</li> <li>Identifier: Function codename. Can only be letters, numbers and underscores</li> <li>Data type：</li> <li>Issue and report: command data can be sent and status data can be reported back to the Wi-Fi module</li> <li> <p>Report only: supports only status reporting, no control options</p> </li> <li> <p>Function Type (Referred as Data Type):</p> </li> <li>Boolean (bool): non-true or false binary variable, such as: switch function, on / off</li> <li>Value (value): suitable for linear adjustment of the type of data, such as: temperature regulation, temperature range 20-40 ℃</li> <li>Enum (enum): custom finite set value, such as: working levels, low / mid / high</li> <li>Fault (fault): dedicated to reporting and statistical failure of the function points. Support multi-fault, the data is reported only</li> <li>Integer（integer）: transmitted as integer</li> <li>Transparent (raw): data in binary </li> </ul> <h3 id=switches-or-plugspower-strips>Switches or Plugs/Power Strips<a class=headerlink href=#switches-or-plugspower-strips title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>switch_1</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>switch_2</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>3</td> <td>switch_3</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>4</td> <td>switch_4</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>5</td> <td>switch_5</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>9</td> <td>countdown_1</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-86400, undefined1, Scale0, Unit:s</td> </tr> <tr> <td>10</td> <td>countdown_2</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-86400, undefined1, Scale0, Unit:s</td> </tr> <tr> <td>11</td> <td>countdown_3</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-86400, undefined1, Scale0, Unit:s</td> </tr> <tr> <td>12</td> <td>countdown_4</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-86400, undefined1, Scale0, Unit:s</td> </tr> <tr> <td>13</td> <td>countdown_5</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-86400, undefined1, Scale0, Unit:s</td> </tr> </tbody> </table> <h3 id=aromatherapy-machine-oil-diffuser>Aromatherapy Machine (Oil Diffuser)<a class=headerlink href=#aromatherapy-machine-oil-diffuser title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>Power</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>6</td> <td>Amount of fog</td> <td>fog</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:small, large</td> </tr> <tr> <td>11</td> <td>Light</td> <td>Light</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>12</td> <td>Fault alarm</td> <td>fault</td> <td>Only report</td> <td>Fault</td> <td>Barrier values:1</td> </tr> <tr> <td>13</td> <td>Countdown</td> <td>countdown</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values: 0, 1, 2, 3</td> </tr> <tr> <td>14</td> <td>Countdown remaining time</td> <td>countdown_left</td> <td>Only report</td> <td>Integer</td> <td>Values range: 0-360, Pitch1, Scale0, Unit:min</td> </tr> <tr> <td>101</td> <td>Light mode</td> <td>work_mode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values: white, colour, scene, scene1, scene2, scene3, scene4</td> </tr> <tr> <td>102</td> <td>Color value</td> <td>colour_data</td> <td>Issue and report</td> <td>Char type</td> <td>*see below</td> </tr> <tr> <td>103</td> <td>Light mode</td> <td>lightmode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values: 1, 2, 3</td> </tr> <tr> <td>104</td> <td>Brightness setting</td> <td>setlight</td> <td>Issue and report</td> <td>Integer</td> <td>Values range: 0-255, Pitch1, Scale0, Unit:\%</td> </tr> </tbody> </table> <blockquote> <p><code>colour_data</code> format of the lights is a string of 14 characters, for example, 00112233334455, where 00 indicates R, 11 indicates G, 22 indicates B, 3333 indicates the hue, 44 indicates the saturation, and 55 indicates the value. The initial value is saved by default. If you do not want to adjust the light, set the data to the maximum value 100% (0x64). The last four characters have fixed values.</p> </blockquote> <h3 id=curtain-motor>Curtain Motor<a class=headerlink href=#curtain-motor title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Percentage</td> <td>percent_state</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> <tr> <td>2</td> <td>Motor Direction</td> <td>control_back</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>3</td> <td>Auto Power</td> <td>auto_power</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>4</td> <td>Left time</td> <td>countdown</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:cancel, 1, 2, 3, 4</td> </tr> <tr> <td>5</td> <td>Total Time</td> <td>time_total</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-120000, Pitch1, Scale0, Unit:m</td> </tr> </tbody> </table> <blockquote> <p><a href=https://github.com/arendst/Tasmota/files/3658412/protocol_CurtainM_20190926.pdf>Complete document on protocols</a></p> </blockquote> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Control (required)</td> <td>control</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:open, stop, close, continue</td> </tr> <tr> <td>2</td> <td>Curtain position setting</td> <td>percent_control</td> <td>Issue and report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> <tr> <td>3</td> <td>Current curtain position</td> <td>percent_state</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> <tr> <td>4</td> <td>Mode</td> <td>mode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:morning, night</td> </tr> <tr> <td>5</td> <td>Motor Direction</td> <td>control_back</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:forward, back</td> </tr> <tr> <td>6</td> <td>Auto Power</td> <td>auto_power</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>7</td> <td>Work State (required)</td> <td>work_state</td> <td>Only report</td> <td>Enum</td> <td>Enumerated values:opening, closing</td> </tr> <tr> <td>11</td> <td>Situation_set</td> <td>situation_set</td> <td>Only report</td> <td>Enum</td> <td>Enumerated values:fully_open, fully_close</td> </tr> <tr> <td>12</td> <td>Fault (required)</td> <td>fault</td> <td>Only report</td> <td>Fault</td> <td>Barrier values:motor_fault</td> </tr> </tbody> </table> <h3 id=power-monitoring-plug>Power Monitoring Plug<a class=headerlink href=#power-monitoring-plug title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>switch_1</td> <td>switch_1</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>9</td> <td>countdown_1</td> <td>countdown_1</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-86400, undefined1, Scale0, Unit:s</td> </tr> <tr> <td>17</td> <td>statistics Function</td> <td>add_ele</td> <td>Control and report</td> <td>Integer</td> <td>undefined0-50000, undefined100, Scale3, Unit:</td> </tr> <tr> <td>18</td> <td>current</td> <td>cur_current</td> <td>Data report</td> <td>Integer</td> <td>undefined0-30000, undefined1, Scale0, Unit:mA</td> </tr> <tr> <td>19</td> <td>power</td> <td>cur_power</td> <td>Data report</td> <td>Integer</td> <td>undefined0-50000, undefined1, Scale1, Unit:W</td> </tr> <tr> <td>20</td> <td>voltage</td> <td>cur_voltage</td> <td>Data report</td> <td>Integer</td> <td>undefined0-5000, undefined1, Scale1, Unit:V</td> </tr> <tr> <td>21</td> <td>test flag</td> <td>test_bit</td> <td>Data report</td> <td>Integer</td> <td>undefined0-5, undefined1, Scale0, Unit:</td> </tr> <tr> <td>22</td> <td>voltage coefficient</td> <td>voltage_coe</td> <td>Data report</td> <td>Integer</td> <td>undefined0-1000000, undefined1, Scale0, Unit:</td> </tr> <tr> <td>23</td> <td>current coefficient</td> <td>electric_coe</td> <td>Data report</td> <td>Integer</td> <td>undefined0-1000000, undefined1, Scale0, Unit:</td> </tr> <tr> <td>24</td> <td>power coefficient</td> <td>power_coe</td> <td>Data report</td> <td>Integer</td> <td>undefined0-1000000, undefined1, Scale0, Unit:</td> </tr> <tr> <td>25</td> <td>statistics coefficient</td> <td>electricity_coe</td> <td>Data report</td> <td>Integer</td> <td>undefined0-1000000, undefined1, Scale0, Unit:</td> </tr> <tr> <td>26</td> <td>warning</td> <td>fault</td> <td>Data report</td> <td>Fault</td> <td>Barrier values:ov_cr</td> </tr> </tbody> </table> <h3 id=dehumidifier>Dehumidifier<a class=headerlink href=#dehumidifier title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>Switch</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>PM2.5</td> <td>PM25</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-999, Pitch1, Scale0, Unit:</td> </tr> <tr> <td>3</td> <td>Work mode</td> <td>Mode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:Manual, Auto, Sleep</td> </tr> <tr> <td>4</td> <td>Wind speed</td> <td>Speed</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:speed1, speed2, speed3, speed4, speed5</td> </tr> <tr> <td>5</td> <td>Filter usage</td> <td>Filter</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> <tr> <td>6</td> <td>Fresh</td> <td>Anion</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>7</td> <td>Child lock</td> <td>Lock</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>9</td> <td>UV light</td> <td>UV</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>11</td> <td>Filter reset</td> <td>FilterReset</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>12</td> <td>indoor temp</td> <td>Temp</td> <td>Only report</td> <td>Integer</td> <td>Values range:-20-50, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>13</td> <td>Indoor humidity</td> <td>Humidity</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> </tbody> </table> <h3 id=lighting>Lighting<a class=headerlink href=#lighting title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>led_switch</td> <td>Control and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>Mode</td> <td>work_mode</td> <td>Control and report</td> <td>Enum</td> <td>Enumerated values:white, colour, scene, scene_1, scene_2, scene_3, scene_4</td> </tr> <tr> <td>3</td> <td>Bright</td> <td>bright_value</td> <td>Control and report</td> <td>Integer</td> <td>undefined25-255, undefined1, Scale0, Unit:</td> </tr> <tr> <td>5</td> <td>Colour mode</td> <td>colour_data</td> <td>Control and report</td> <td>Char type</td> <td></td> </tr> <tr> <td>6</td> <td>Scene</td> <td>scene_data</td> <td>Control and report</td> <td>Char type</td> <td></td> </tr> <tr> <td>7</td> <td>Scene1</td> <td>flash_scene_1</td> <td>Control and report</td> <td>Char type</td> <td></td> </tr> <tr> <td>8</td> <td>Scene2</td> <td>flash_scene_2</td> <td>Control and report</td> <td>Char type</td> <td></td> </tr> <tr> <td>9</td> <td>Scene3</td> <td>flash_scene_3</td> <td>Control and report</td> <td>Char type</td> <td></td> </tr> <tr> <td>10</td> <td>Scene4</td> <td>flash_scene_4</td> <td>Control and report</td> <td>Char type</td> <td></td> </tr> </tbody> </table> <h3 id=contact-sensor>Contact Sensor<a class=headerlink href=#contact-sensor title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Door Sensor</td> <td>doorcontact_state</td> <td>Only report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>Battery Level</td> <td>battery_percentage</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> <tr> <td>3</td> <td>Battery Level</td> <td>battery_state</td> <td>Only report</td> <td>Enum</td> <td>Enumerated values:low, middle, high</td> </tr> <tr> <td>4</td> <td>Anti-remove Alarm</td> <td>temper_alarm</td> <td>Only report</td> <td>Boolean</td> <td></td> </tr> </tbody> </table> <h3 id=air-purifier>Air purifier<a class=headerlink href=#air-purifier title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>Switch</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>PM2.5</td> <td>PM25</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-999, Pitch1, Scale0, Unit:</td> </tr> <tr> <td>3</td> <td>Work mode</td> <td>Mode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:Manual, Auto, Sleep</td> </tr> <tr> <td>4</td> <td>Wind speed</td> <td>Speed</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:speed1, speed2, speed3, speed4, speed5</td> </tr> <tr> <td>5</td> <td>Filter usage</td> <td>Filter</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> <tr> <td>6</td> <td>Fresh</td> <td>Anion</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>7</td> <td>Child lock</td> <td>Lock</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>9</td> <td>UV light</td> <td>UV</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>11</td> <td>Filter reset</td> <td>FilterReset</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>12</td> <td>indoor temp</td> <td>Temp</td> <td>Only report</td> <td>Integer</td> <td>Values range:-20-50, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>13</td> <td>Indoor humidity</td> <td>Humidity</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-100, Pitch1, Scale0, Unit:%</td> </tr> </tbody> </table> <h3 id=heater>Heater<a class=headerlink href=#heater title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>Power</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>Target temperature</td> <td>TempSet</td> <td>Issue and report</td> <td>Integer</td> <td>Values range:0-37, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>3</td> <td>Current Temperature</td> <td>TempCurrent</td> <td>Only report</td> <td>Integer</td> <td>Values range:-9-99, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>4</td> <td>Mode</td> <td>Mode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:m, p</td> </tr> <tr> <td>5</td> <td>Fault alarm</td> <td>Fault</td> <td>Only report</td> <td>Fault</td> <td>Barrier values:1, 2, 3</td> </tr> <tr> <td>6</td> <td>Gear position</td> <td>gear</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:low, mid, high, off</td> </tr> <tr> <td>7</td> <td>Conservation</td> <td>eco_mode</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> </tbody> </table> <h3 id=smart-fan>Smart fan<a class=headerlink href=#smart-fan title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>switch</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>Wind Speed Level</td> <td>fan_speed</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:1, 2, 3, 4</td> </tr> <tr> <td>3</td> <td>Left-and-Right Swing</td> <td>fan_horizontal</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:on, off</td> </tr> <tr> <td>4</td> <td>Up-and-Down Swing</td> <td>fan_vertical</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:on, off</td> </tr> <tr> <td>5</td> <td>Fault Alarm</td> <td>fault</td> <td>Only report</td> <td>Fault</td> <td>Barrier values:1, 2</td> </tr> <tr> <td>6</td> <td>Anion</td> <td>anion</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>7</td> <td>Humidify</td> <td>humidifier</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>8</td> <td>Oxygen</td> <td>oxygan</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>9</td> <td>Child Lock</td> <td>lock</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>10</td> <td>Cool</td> <td>fan_cool</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>11</td> <td>Set Temperate</td> <td>temp</td> <td>Issue and report</td> <td>Integer</td> <td>Values range:0-50, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>12</td> <td>Current Temperature</td> <td>temp_current</td> <td>Only report</td> <td>Integer</td> <td>Values range:0-50, Pitch1, Scale0, Unit:℃</td> </tr> </tbody> </table> <h3 id=kettle>Kettle<a class=headerlink href=#kettle title="Permanent link">~</a></h3> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Working switch</td> <td>start</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>Heat to target temperature shortcut (°C)</td> <td>temp_setting_quick_c</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:50, 65, 85, 90, 100</td> </tr> <tr> <td>3</td> <td>Heat to target temperature shortcut (°F)</td> <td>temp_setting_quick_f</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:122, 149, 185, 194, 212</td> </tr> <tr> <td>4</td> <td>Cool to the target temperature shortcut after boiling (°C)</td> <td>temp_boiling_quick_c</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:50, 65, 85, 90, 100</td> </tr> <tr> <td>5</td> <td>Cool to the target temperature shortcut after boiling (°F)</td> <td>temp_boiling_quick_f</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:122, 149, 185, 194, 212</td> </tr> <tr> <td>6</td> <td>Temperature scale switching</td> <td>temp_unit_convert</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:c, f</td> </tr> <tr> <td>7</td> <td>Insulation switch</td> <td>switch_keep_warm</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>8</td> <td>Holding time setting</td> <td>keep_warm_setting</td> <td>Issue and report</td> <td>Integer</td> <td>Values range:0-360, Pitch1, Scale0, Unit:min</td> </tr> <tr> <td>9</td> <td>Mode</td> <td>work_type</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values: setting_quick, boiling_quick, temp_setting, temp_</td> </tr> </tbody> </table> <h3 id=becathermostat>BecaThermostat<a class=headerlink href=#becathermostat title="Permanent link">~</a></h3> <div class="admonition warning"> <p class=admonition-title>Work in progress</p> </div> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Switch</td> <td>Power</td> <td>Issue and report</td> <td>Boolean</td> <td></td> </tr> <tr> <td>2</td> <td>Target temperature</td> <td>TempSet</td> <td>Issue and report</td> <td>Integer</td> <td>Values range:0-37, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>3</td> <td>Current Temperature</td> <td>TempCurrent</td> <td>Only report</td> <td>Integer</td> <td>Values range:-9-99, Pitch1, Scale0, Unit:℃</td> </tr> <tr> <td>4</td> <td>Mode</td> <td>Mode</td> <td>Issue and report</td> <td>Enum</td> <td>Enumerated values:m, p (wip)</td> </tr> <tr> <td>102</td> <td>Floor Temperature</td> <td>FloorCurrent</td> <td>Issue and report</td> <td>Integer</td> <td>Values range:0-37, Pitch1, Scale0, Unit:℃</td> </tr> </tbody> </table> <h3 id=inkbird-itc-308-wifi>Inkbird ITC-308-Wifi<a class=headerlink href=#inkbird-itc-308-wifi title="Permanent link">~</a></h3> <p>Temperature controller with individual plug in sockets for heating/cooling</p> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>101</td> <td>Temperature unit</td> <td>Cf</td> <td>Issue and report</td> <td>Integer</td> <td>0=C, 1=F</td> </tr> <tr> <td>102</td> <td>Calibration</td> <td>Ca</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> <tr> <td>104</td> <td>Temperature sensor</td> <td></td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> <tr> <td>106</td> <td>Temperature set point</td> <td>Ts</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> <tr> <td>108</td> <td>Compressor delay time</td> <td>Pt</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is minutes</td> </tr> <tr> <td>109</td> <td>Alarm high temperature</td> <td>Ah</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> <tr> <td>110</td> <td>Alarm low temperature</td> <td>Al</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C, For negative values use -(0xFFFFFFFF - value)</td> </tr> <tr> <td>115</td> <td>Relay status</td> <td></td> <td>Only report</td> <td>Integer</td> <td>01=cool, 02=off, 03=heating</td> </tr> <tr> <td>116</td> <td>Temperature sensor</td> <td></td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1F</td> </tr> <tr> <td>117</td> <td>Heating differential value</td> <td>Hd</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> <tr> <td>118</td> <td>Cooling differential value</td> <td>Cd</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> </tbody> </table> <p>The unit will constantly be sending the temperature sensor value in celsius and fahrenheit: 104 and 116. To trigger the unit to send all settings, send any value to a non-used register, e.g. TuyaSend1 2,1</p> <p>Example:</p> <table> <thead> <tr> <th>Tasmota command</th> <th>Result</th> </tr> </thead> <tbody> <tr> <td>TuyaSend1 2,1</td> <td>Trigger the unit to reveal all settings</td> </tr> <tr> <td>TuyaSend2 106,250</td> <td>Change set-point to 25.0C</td> </tr> <tr> <td>TuyaSend2 101,1</td> <td>Change units to Fahrenheit</td> </tr> </tbody> </table> <h3 id=inkbird-ihc-200-wifi>Inkbird IHC-200-Wifi<a class=headerlink href=#inkbird-ihc-200-wifi title="Permanent link">~</a></h3> <p>Humidity controller with two relay sockets very similar to the ITC-308-WIFI This unit ships with a RTL based WR3 module which cannot be flashed with Tasmota, however the WR3 module is pin compatible with an ESP12-F module and is on a daughter board similar to the one in the ITC-308-WIFI</p> <table> <thead> <tr> <th>DP ID</th> <th>Function points</th> <th>Identifier</th> <th>Data type</th> <th>Function type</th> <th>Properties</th> </tr> </thead> <tbody> <tr> <td>104</td> <td>Humidity sensor</td> <td></td> <td>Only report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> <tr> <td>106</td> <td>Humidity set point</td> <td>HS</td> <td>Issue and report</td> <td>Integer</td> <td>Unit is 0.1C</td> </tr> </tbody> </table> <p>Dpid 102,108,109,110,106,117,118 return data and are not yet reverse engineered but are likely similar to ITC-308 but related to humidity. </p> <h2 id=further-reading>Further Reading<a class=headerlink href=#further-reading title="Permanent link">~</a></h2> <ul> <li><a href=../TuyaMCU-Devices/ >TuyaMCU Flashing and Device Configuration</a></li> </ul> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.4b2c34cd.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>